var MIN_PRICE=0.01,MAX_PRICE=50,MIN_PHRASE_RANK_WARNING=2,MAX_PHRASE_RANK_WARNING=7000,SITELINKS_MAX_LENGTH=66,SITELINKS_NUMBER=3,MAX_URL_LENGTH=1024,KAZ_LETTERS="ҰҒғӨҢҚҺҮұөңқһүҖҲҳҗӘә",RUS_LETTERS="абвгдеёжзийклмнопрстуфхцчшщъыьэюяАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ",UKR_NATIVE_LETTERS="ЄІЇєіїҐґ",ALLOW_LETTERS="abcdefghijklmonpqrstuvwxyzABCDEFGHIJKLMONPQRSTUVWXYZабвгдеёжзийклмнопрстуфхцчшщъыьэюяАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯЄІЇєіїҐґ'0123456789.",ADDRESS_STREET_PREFIXES=null;common=this.common||{};common.parse={number:function(a){a+="";a=a.replace(/[,\.юЮбБ]/gi,".").replace(/[^0-9\.\-]/,"");return a*1}};(function(){common.format={number:function(g,e,c,d){g=g||0;e=e||0;c=c||"";d=d||".";var b="";g=a(g,e).replace(".",d);while((b=g.replace(/(\d)(\d\d\d)($|\D)/,"$1"+c+"$2$3"))!=g){g=b}return g},href:function(c,d){if(!c||c.match(/^#/)){return c}if(!c.match(/^https?:\/\//)){c="http://"+c}if(d){var b=c.match(/\?/)?"&":"?";c=c.replace(/($|\#)/,b+"_openstat=dGVzdDsxOzE7$1")}return c},trim:function(c,b){if(c.length>b){return c.substr(0,b-1)+"\u2026"}return c}};function a(h,g){var e=Math.pow(10,g);h=Math.round(h*e)/e+"";if(g==0){return h}var j=h.indexOf(".");var d=0;if(j==-1){h+=".";d=g}else{d=g-(h.length-j-1)}for(var c=0,b=d;c<b;c++){h+="0"}return h}})();common.inflector=new function(){this.pluralize=function(c,b){var a=arguments,d=0;return c.replace(/(\%[df])(([^\{%]*)\{([^\{]+)\})?/,function(){d++;if(arguments[2]){return a[d]+arguments[3]+common.inflector.pluralizeWord(arguments[4].split("|"),a[arguments[1]=="%f"?++d:d])}else{return a[d]}})};if(window.Direct_lang=="ru"||window.Direct_lang=="ua"){this.pluralizeWord=function(a,b){b%=100;if(b>=5&&b<=20){return a[2]}b%=10;if(b==1){return a[0]}else{if(b<5&&b>0){return a[1]}}return a[2]}}else{if(window.Direct_lang=="en"){this.pluralizeWord=function(a,b){if(b==1){return a[0]}return a[1]}}}};common.loader={_loaded:{},_loading:{},_callbacks:[],_map:{},_queue:[],load:function(b,d){var c=[];for(var a=0;a<b.length;a++){c[a]=this._mapToUrl(b[a]);this._queue.push(c[a])}this._callbacks.push([c,d]);common.loader._notifyCallbacks();this._loadNext()},_notifyCallbacks:function(){var c=[];for(var b=0;b<this._callbacks.length;b++){var d=this._callbacks[b];for(var a=0;a<d[0].length;a++){if(!this._loaded[d[0][a]]){c.push(d);break}}if(a==d[0].length){d[1]&&d[1]()}}this._callbacks=c},_loadNext:function(){var a;do{a=this._queue.shift()}while(this._loaded[a]);if(!a||this._loading[a]){return}this._loading[a]=true;this._attach(a)},_attach:function(c){var b=document.createElement("script");b.type="text/javascript";b.charset="utf-8";b.setAttribute("async","async");var a=function(d){d=d||window.event;if(d.type==="load"||(/^(complete|loaded)$/).test(b.readyState)){setTimeout(function(){common.loader._loading[c]=undefined;common.loader._loaded[c]=true;b.removeEventListener?b.removeEventListener("load",a,false):b.detachEvent("onreadystatechange",a);b=a=null;common.loader._notifyCallbacks();common.loader._loadNext()},1)}};b.addEventListener?b.addEventListener("load",a,false):b.attachEvent("onreadystatechange",a);b.src=c;return common.loader._head.insertBefore(b,common.loader._head.firstChild)},_mapToUrl:function(a){return this._map[a]||a}};common.loader._head=document.getElementsByTagName("script")[0].parentNode;direct=window.direct||{};direct.utils={escapeHTMLRe:/[&<>\"\']/g,escapeHTMLReplacer:function(a){return"&#"+a.charCodeAt(0)+";"},unescapeHTMLRe:/(&(lt|gt|quot|apos|amp|#\d+);|.)/gi,unescapeHTMLHash:{lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},unescapeHTMLReplacer:function(a,e,b){return direct.utils.unescapeHTMLHash[b]||(b?String.fromCharCode(b.substring(1)):e)},validateHref:function(a){return a.match(/^\s*(http:\/\/)?([a-zа-я0-9-]+\.)+[a-zа-я]+(\s*$|\/|:\d+|\?|#)/i)},validateEmail:function(a){return a.match(/^\s*[a-z0-9_\.\-\+]+\@([a-z0-9][a-z0-9-]*\.)+[a-z0-9]{2,}\.?\s*$/i)},validateOGRN:function(o){var e=13,j=15,g=o*1,m=g+"";if(m.length!=e&&m.length!=j){return false}var d=(m.length==e)?"OGRN":"OGRNIP",q=m.length;var h=m.substring(0,1);var c=m.substring(q-1,q);var l=parseInt(m.substring(0,q-1),10);if(!h.match(/[1235]/)){return false}var n=l%(d=="OGRN"?11:13);if(n<10){var a=n}else{var b=n+"";var a=b.substring(b.length-1,b.length)}return !!(a==c)},extractDomain:function(a){return $.trim(a).replace(/http(s)?:\/\//,"").replace(/[\/\?].*/,"").replace(/\#.*/,"").replace(/\/$/,"")},generateId:function(a){return(a||"")+((new Date()).getTime()+Math.round(Math.random()*10000))},isEmpty:function(a){if(!a){return true}else{return a.match(/^\s*$/)}},isEqual:function(b,a){if(b&&a){return b==a}else{return !b&&!a}},escapeHTML:function(a){return(a||"").replace(this.escapeHTMLRe,this.escapeHTMLReplacer)},unescapeHTML:function(a){return(a||"").replace(this.unescapeHTMLRe,this.unescapeHTMLReplacer)},binarySearch:function(d,e){var a=0,c=e.length,b;while(a<c){b=(a+c)>>1;e[b]<d?a=b+1:c=b}return a},clone:function(b){if(!b||"object"!==typeof b){return b}var d=("function"===typeof b.pop?[]:{});var c;for(var a in b){if(b.hasOwnProperty(a)){c=b[a];if(c&&"object"===typeof c){d[a]=$.clone(c)}else{d[a]=c}}}return d},addWbrs:function(m,c,h){c=c||25;h=h||"<wbr />";var d=m.replace(/[\s\xA0]{2,}/g," ").replace(/([\s\.\-\/])/g,"$1\u0001").split("\u0001"),j=[],g,b,a,e;for(g=0,b=d.length;g<b;g++){a=d[g];while(a.length>c){e=Math.min(c,a.length/2);j.push(a.substring(0,e));a=a.substring(e)}j.push(a)}return j.join(h)},openWindow:function(b,a,e,g){var c=($(window).width()-e)>>1,d=($(window).height()-g)>>1,h=window.open(b,a,"width="+e+",height="+g+",top="+d+",left="+c+",resizable=yes,scrollbars=yes,status=0");h.focus()},range:function(d,c){var b=new Array(c-d);for(var a=0;d<=c;d++,a++){b[a]=d}return b}};$.extend(direct.utils);direct.autobroker=new function(){var b=0.01;function a(c){for(var d=c.length-1;d>=0;d--){c[d]=parseFloat(c[d],10)}return c}this.calcPrice=function(u,q,h,l,v,c){u=Math.floor(1000000*u+0.5);v=Math.floor(1000000*(v||0)+0.5);c=Math.floor(1000000*(c||0)+0.5);var j=c>0&&c<u?c:u,w,d,x,y,s,o,m=[],g=[],e;q=a(q.split(","));h=a(h.split(","));l=l.split("|");e=l[1]&&a(l[1].split(","))||[];l=l[0].split(",");for(o=0;o<l.length;o++){var n=l[o].split(":");if(n[1]){g[m.length]=n[1]/1000000}m[m.length]=n[0]}m=a(m);g=a(g);if(h.length&&j>=h[0]){y="premium"}else{if(q.length&&j>=q[q.length-1]){y="first"}else{if(q.length&&j>=q[0]){y="guarantee"}else{if(m.length&&j>=m[0]){y="bottom"}else{y="out"}}}}for(q=q.concat(h),o=q.length-1;o>-1;o--){s=q[o];if(s<=u&&s>j){w=1}else{if(s<=j){d=s;x=1;break}}}if(!d){x=this.calcCoverage(j,m,g);if(x){w=u>j?1:0;d=$.grep(e,function(z){return z<=j}).sort(function(A,z){return z-A})[0]||j}else{d=0}}d=d/1000000||b;return{price:d,coverage:x||0,truncated:w?1:0,place_name:y}};this.calcCoverage=function(d,h,m){if(h.length<2||h.length!=m.length||d<h[0]){return 0}var c=direct.utils.binarySearch(d,h),j,l,g,e;c=Math.min(h.length-1,c);c=Math.max(0,c-1);l=h[c];g=h[c+1]>=d?h[c+1]:d;e=(d-l)/((g-l)||1);return m[c]+e*(m[c+1]-m[c])};this.calcPriceByCoverage=function(d,c,e){return this.calcCoverage(d,e,c)}};direct.campaign={};common.Observable={bind:function(a,b){var c=this;$.each(a.split(" "),function(e,d){c._observersFor(d).push(b)});return this},unbind:function(a,b){var c=this;if(!this._observers){return this}$.each(a.split(" "),function(e,d){if(!b){c._observers[d]=undefined}else{c._observers[d]=$.grep(c._observersFor(d,true),function(g){return g!=b})}});return this},trigger:function(b){var a=Array.prototype.slice.call(arguments,1);$.each(this._observersFor(b,true),function(c,d){d.apply(this,a)});return this},_observersFor:function(a,b){if(b&&(!this._observers||!this._observers[a])){return[]}if(!this._observers){this._observers={}}if(!this._observers[a]){this._observers[a]=[]}return this._observers[a]}};(function(){common.Searchable=$.extend({},common.Observable,{chunkSize:20,chunkTimeout:20,search:function(c,d){this.stopSearch();this._query=c;var b=this.createIterator(c,d);this.trigger("search.start",b);a.call(this,b)},stopSearch:function(){if(this._searchTimer){clearTimeout(this._searchTimer);this._searchTimer=false}},matchRow:function(c,b){return false},createIterator:function(b,c){return{query:b,iteration:0,found:0,visible:[],visibleMap:{},callback:c}}});function a(c){var b=0,g=[],e=this,d;while(c.iteration<this.items.length){if(b==this.chunkSize){if(g.length){this.trigger("search.foundInChunk",g)}this._searchTimer=setTimeout(function(){a.call(e,c)},this.chunkTimeout);return}d=this.items[c.iteration];if(this.matchRow(d,c)){c.found++;g.push(d);c.visible.push(c.iteration);c.visibleMap[c.iteration]=true;this.trigger("search.found",d,c);if(c.callback){c.callback(d,c)}}else{this.trigger("search.missed",d,c)}c.iteration++;b++}if(g.length){this.trigger("search.foundInChunk",g)}this.stopSearch();this.trigger("search.finish",c)}})();common.Model=$.extend({},common.Observable,new function(){this.update=function(d,a){var c={},e=[];for(var b in d){if(!d.hasOwnProperty(b)){continue}if(this[b]!=d[b]||!d[b]&&this[b]!==d[b]){c[b]=[this[b],d[b]];e.push(b);this[b]=d[b]}}this._triggerChange({changes:c,fields:e,source:a,model:this})};this._triggerChange=function(a){this.trigger("change",a)}});common.model={};(function(){var a=direct.campaign.Model=function(b){b&&this.update(b)};a.prototype=$.extend({},common.Model,new function(){this.setDescription=function(b){this.searchIndex=this.searchIndex.substr(0,this.searchIndex.length-this.description.length)+b.toLowerCase();this.description=b}});a.fromRawData=function(b){if(b.searchIndex){b.searchIndex=b.searchIndex.toLowerCase()}return new a(b)}})();(function(){var c=["clicks","shows","showsLeft","sumRest","sum"];var a=common.Searchable,b=direct.campaign.List=function(d){this.init(d)};b.prototype=$.extend({},a,{init:function(d){this.items=d||[]},search:function(d,e){d.text=d.text.toLowerCase();return common.Searchable.search.call(this,d,e)},matchRow:function(g,d){var e=g.searchIndex.indexOf(d.query.text)>-1&&(!d.query.onlyFavorites||g.favoriteCamp)&&(!d.query.onlyManagerFavorites||g.my);return e},getTotals:function(g,d){var e={};$.each(c,function(){e[this]=0});for(var h=0,j;h<g.length;h++){if(!d||d[g[h]]){j=this.items[g[h]];$.each(c,function(){e[this]+=j[this]*1})}}return e}});b.fromRawData=function(d){return new b(d.map(function(e){return direct.campaign.Model.fromRawData(e)}))}})();direct.client={};(function(){var a=direct.client.Model=function(b){this.children=[];b&&this.update(b);this.searchIndex=this.buildSearchIndex();this.actions=this.actions?this.actions.push("description")&&this.actions:["description"]};a.prototype=$.extend({},common.Model,new function(){this.buildSearchIndex=function(){return[this.login,this.fio,this.FIO,this.phone,this.email,this.clientid,this.agency_name,this.description].join("\n").toLowerCase()};this.matchIndex=function(c){for(var b=0;b<this.children.length;b++){if(this.children[b].matchIndex(c)){return"child"}}if(this.searchIndex.indexOf(c)>-1){return"parent"}return 0};this.setDescription=function(b){this.update({description:b});this.searchIndex=this.buildSearchIndex()};this.toTableRow=function(c){var d=new Array(c.length);for(var b=0;b<c.length;b++){d[b]=this[c[b]]}return d}});a.fromRawData=function(e){var d=e.children||[],b=new a(e);e.children=undefined;for(var c=0;c<d.length;c++){b.children[c]=a.fromRawData(d[c])}return b}})();(function(){var a=common.Searchable,b=direct.client.List=function(c){this.init(c)};b.prototype=$.extend({},a,new function(){this.chunkSize=50;this.chunkTimeout=80;this.init=function(c){this.items=c||[]};this.matchRow=function(e,d){var c=e.matchIndex(d.query.text);d.matchedParent=c=="parent";return !!c};this.search=function(c,d){c.text=c.text.toLowerCase();return a.search.call(this,c,d)}});b.fromRawData=function(c){return new b($.map(c,function(d){return direct.client.Model.fromRawData(d)}))}})();direct.UserOptions={set:function(a,c){var b={cmd:"ajaxUserOptions"};USER_OPTIONS[a]=b[a]=c;$.ajax({type:"POST",url:"/registered/main.pl",data:b,dataType:"json"})},remove:function(a){USER_OPTIONS[a]=null;$.ajax({type:"POST",url:"/registered/main.pl",data:{cmd:"ajaxUserOptions","delete":a},dataType:"json"})},get:function(a){return USER_OPTIONS[a]}};if(typeof(USER_OPTIONS)=="undefined"){USER_OPTIONS={}}direct.CampOptions={set:function(a,c,d){var b={cmd:"ajaxCampOptions",cid:CAMP_OPTIONS_CID};CAMP_OPTIONS[a]=b[a]=c;$.post("/registered/main.pl",b,d)},remove:function(a,b){CAMP_OPTIONS[a]=null;$.post("/registered/main.pl",{cmd:"ajaxCampOptions",cid:CAMP_OPTIONS_CID,"delete":a},b)},get:function(a){return CAMP_OPTIONS[a]}};if(typeof(CAMP_OPTIONS)=="undefined"){CAMP_OPTIONS={}}(function(b,a){if(!a){a=window.Lego={}}a.messages=a.messages||{};a.message=function(d,c){return a.params.locale=="ru"?c:(a.messages[d]||c)}})(jQuery,window.Lego);(function(a){if(!a){a=window.Lego={}}a.oframebust=function(d){if(location==top.location){return}var b=(location.search.match(/[&?]oframebust=([^&;]+)/)||[])[1];if(!b){top.location=location}if(d.hasOwnProperty(b)){var c=document.createElement("iframe");c.style.position="absolute";c.style.left="-999px";c.style.width="1px";c.src="//"+b+"/oframebust.html?"+encodeURIComponent(location.href);(function(){if(document.body&&document.body.firstChild){document.body.insertBefore(c,document.body.firstChild)}else{setTimeout(arguments.callee,0)}})();return}top.location=location}})(window.Lego);(function(b,a){a.block["b-domik"]=function(j){var e=b(this),d=false,l=b('<input type="hidden" name="timestamp"/>'),m=false;arguments.callee.isHTTPSSupported=false;e.append(l).bind("mouseover focus",function(){e.unbind("mouseover focus",arguments.callee);a.block["b-domik"].checkForHTTPS()}).submit(function(){if(d){return false}l.val(+new Date);a.block["b-domik"].isHTTPSSupported&&e.attr("action",e.attr("action").replace(/^http\:/,"https:"))});var g=e.find("input[name=login], input[name=passwd]"),c=e.find("input[type=submit]");g.change(function(){d=false;var s;g.each(function(){var v=b(this),u=b.trim(v.val());s=v.attr("name")=="login"&&u.indexOf("@")>-1?false:/[а-яА-Я]/.test(u);if(!u||s){return !(d=true)}});c.attr("disabled",d);s?h(a.message("b-domik:error","смените раскладку")):o()});g.change();var q;function h(s){!q&&(q=b('<div class="b-domik__error"/>').insertAfter(e.find(".b-domik__password")));q.text(s).show()}function o(){q&&q.hide()}function n(){var s=a.params["lego-static-host"];if(s){if(s.indexOf("https:")==0){return s}if(s.indexOf("http:")==0){return"https"+s.substr(4)}if(s.indexOf("//")==0){return"https:"+s}else{return"https://"+location.host+s}}else{return"https://"+location.host}}arguments.callee.checkForHTTPS=function(){if(m){return}m=true;b.ajax({url:n()+"/blocks/b-domik/check-https.js",cache:true,dataType:"script"})}}})(jQuery,window.Lego);(function(b,a){a.block["b-hint-input"]=function(){var l=b(this),e=b("#"+l.attr("for")),h=function(){l.hide()},d=function(){l.show()},c=function(){j||e.val()?h():d()},j=false;e.bind("focus blur",function(m){j=m.type=="focus";c()}).bind("change mouseover",c);l.click(function(){e.focus()});e.change();var g=e.val();(function(){if(e.val()!=g){b(e).trigger("change");g=e.val()}setTimeout(arguments.callee,200)})()}})(jQuery,window.Lego);(function(b,a){a.block["b-domik_type_popup"]=function(j){var g=b(this),d;b(".b-head-userinfo__entry .b-pseudo-link").click(function(){c();return false});function c(l){if(!d){h()}var m="&from="+a.params["passport-msg"]+"&retpath="+encodeURIComponent(l||a.params.retpath);g.attr("action",a.params["passport-host"]+"/passport?mode=auth"+m);d.find(".b-domik__register .b-domik__link").attr("href",a.params["passport-host"]+"/passport?mode="+(j.regMode||"register")+m);b(document).bind("keyup.b-domik",function(n){if(n.keyCode==27){e()}}).bind("click.b-domik",function(n){if(b(n.target).parents().andSelf().index(d)==-1||b(n.target).is("input[type=button]")){e()}});!d.hasClass("b-domik_position_popup-50-50")&&window.scrollTo(0,0);d.show().find("input[name=login]").focus();b(document).trigger("show.b-domik_type_popup")}function e(){b(document).unbind(".b-domik");d.hide()}function h(){d=b('<form class="'+g.attr("class").replace("g-hidden","")+'"><i class="b-domik__roof"></i><table class="b-domik__shadow"><tr><td class="b-domik__shadow__lt">&nbsp;</td><td class="b-domik__shadow__t"></td><td class="b-domik__shadow__rt">&nbsp;</td></tr><tr><td class="b-domik__shadow__l">&nbsp;</td><td class="b-domik__shadow__m"><div class="b-domik__form"><div class="b-domik__title">'+(j.title||a.message("b-domik:title","Вход"))+'</div><div class="b-domik__username"><label for="b-domik_popup-username" class="b-hint-input g-js" onclick="return {name:\'b-hint-input\'}">'+a.message("b-domik:login","логин")+'</label><div class="b-input"><input class="b-input__text" id="b-domik_popup-username" name="login" value="'+g.find("input[name=login]").val()+'" tabindex="11"/></div></div><div class="b-domik__password"><label for="b-domik_popup-password" class="b-hint-input g-js" onclick="return {name:\'b-hint-input\'}">'+a.message("b-domik:password","пароль")+'</label><div class="b-input"><input class="b-input__text" id="b-domik_popup-password" name="passwd" value="'+g.find("input[name=passwd]").val()+'" type="password" tabindex="11"/></div></div><div class="b-domik__permanent"><input class="b-domik__check" id="b-domik_popup-permanent" name="twoweeks" type="checkbox" value="yes" tabindex="11"/><label for="b-domik_popup-permanent">'+a.message("b-domik:permanent","запомнить меня")+'</label> <span class="b-domik__help">(<a class="b-domik__link" href="http://help.yandex.ru/passport/?id=922493" tabindex="12">'+a.message("b-domik:help","что&nbsp;это")+'</a>)</span></div><div class="b-domik__button"><input class="b-domik__submit" type="submit" value="'+a.message("b-domik:logon","Войти")+'" tabindex="11"/><input class="b-domik__submit" type="button" value="'+a.message("b-domik:cancel","Отмена")+'" tabindex="11"/></div><div class="b-domik__register"><a class="b-domik__link" href="" tabindex="11">'+(j.register||a.message("b-domik:register","Зарегистрироваться"))+'</a></div><div class="b-domik__remember"><a class="b-domik__remind" href="'+a.params["passport-host"]+'/passport?mode=remember" tabindex="11">'+a.message("b-domik:remember","Напомнить пароль")+'</a></div></div></td><td class="b-domik__shadow__r">&nbsp;</td></tr><tr><td class="b-domik__shadow__lb">&nbsp;</td><td class="b-domik__shadow__b"></td><td class="b-domik__shadow__rb">&nbsp;</td></tr></table><iframe class="b-popup-under" frameborder="0"></iframe></form>').submit(function(l){l.preventDefault();g.find("input[name=login]").val(d.find("input[name=login]").change().val()).end().find("input[name=passwd]").val(d.find("input[name=passwd]").change().val()).end().find("input[name=twoweeks]").attr("checked",d.find("input[name=twoweeks]").attr("checked")).end().append('<input type="hidden" name="timestamp" value="'+ +new Date+'"/>').attr("action",a.block["b-domik"].isHTTPSSupported?g.attr("action").replace(/^http/,"https"):g.attr("action")).submit()});if(a.block["b-domik"]){a.block["b-domik"].call(d)}b("body").append(d);a.blockInit(d)}arguments.callee.login=function(){var l=arguments;setTimeout(function(){c.apply(this,l)},0)}}})(jQuery,window.Lego);(function(b,a){a.block["b-dropdown"]=function(d){var g=b(this),j,l,h,n,c=false,m=false,o=function(){j=g.find(".b-dropdown__list");l=b('<div class="b-dropdown__popup"/>');h=b('<iframe class="b-dropdown__iframe" frameborder="0" src="javascript:\'<body style=\\\'background:none;overflow:hidden\\\'>\'"/>');n=j.clone(true).addClass("b-dropdown__list_clone").hide();j.before(l);l.after(n);e();b(document).keydown(function(q){if(q.keyCode==27&&!(q.metaKey||q.ctrlKey||q.altKey||q.shiftKey)){e()}}).click(function(q){if(!b(q.target).is(".b-dropdown *")){e()}}).bind("popupsClose.lego",e);m=true},e=(function(){if(c){return}l.css("visibility","hidden").before(j).hide();n.hide();c=true});g.find(".b-dropdown__or").click(function(s){s.preventDefault();if(!m){o()}if(g.hasClass("b-dropdown_state_disabled")){g.trigger("popupDisabled.lego");return}if(c){b(document).trigger("popupsClose.lego",{source:g[0]});var u=b.Event("popupOpen.lego");g.trigger(u);if(!u.isDefaultPrevented()){n.css("display","");l.append(j).css("visibility","");if(d.direction=="up"||g.hasClass("b-dropdown_direction_up")){var q=l.height()-n.height();l.css("margin-top",-(q-(parseInt(j.css("padding-bottom"),10)+parseInt(b(this).closest(".b-dropdown__item").css("padding-bottom"),10))))}l.prepend(h).css("display","");c=false}}else{e()}})}})(jQuery,window.Lego);(function(b,a){a.block["b-head-tabs"]=function(n){var d=b(this),A=b(".b-head-search"),j=A.find(".b-search .b-input input:first"),v=A.find(".b-search__advanced"),o=a.params.id,z=u(document.location.search),h={www:505,search:521,images:526}[o]||527,c=(function(){return{market:{cvredirect:"1",clid:h}}})(),x=(function(){return{news:{rpt:"nnews",grhow:"clutop"},yaca:{rpt:"rs2"},market:{cvredirect:"1",clid:h},blogs:{ft:"blog"}}})(),s=(function(){var B={www:["noreask"]};B.news=B.yaca=B.market=B.blogs=B.maps=B.adresa=B.video=B.fotki=B.slovari=B.auto=B.images=B.www;return B})(),w=b.grep(b.map(d.find(":not(strong)>a.b-head-tabs__link:not([href$=yandex.ru/all])"),function(B){var D=B.host.split(".")[0],F=u(b(B).attr("search"))["clid"]||"",E=y(e(D,F)),C=b(B);return{node:C,clid:F,toServiceId:D,path:a.block["b-head-tabs"].getHostToUrlMap()[D],host:C[0].host,searchHost:a.block["b-head-tabs"].getHostMap()[D],noSearchParamsUrl:E?"?"+E:"",searchParams:q(D,F)}}),function(B){return typeof B.path!="undefined"}),m;if(v.length){var g=u(v.attr("search")),l=v[0].pathname.replace(/^\/?(.*)/,"$1");g.text="";w.push({node:v,clid:g.clid,toServiceId:o,path:l,host:v[0].host,noSearchParamsUrl:l+"?"+y(g),searchParams:g})}setInterval((function(){var B=encodeURIComponent(b.trim(j.val())||n["default"]);if(m===B){return arguments.callee}m=B;b.each(w,function(){if(!!B){this.searchParams[a.block["b-head-tabs"].getSearchParamName(this.service)]=B}var C=!!B?(this.path+"?"+y(this.searchParams)):this.noSearchParamsUrl,E=this.node[0],D=(!!B&&this.searchHost)?this.searchHost:this.host;E.href=E.protocol+"//"+D+"/"+C});return arguments.callee})(),200);function e(B,C){var D=c[B]||{};if(!D.clid&&!!C){D.clid=C}return D}function q(B,C){var E=x[B]||{},D=[].concat(s[B]);if((B=="images"&&o=="www")||(B=="www"&&o=="images")){D.push("site")}b.each(D,function(F,G){if(z[G]){E[G]=z[G]}});if(!E.clid&&!!C&&B!="www"){E.clid=C}return E}function y(C){var B=[];b.each(C,function(D){B.push(D+"="+C[D])});return B.join("&")}function u(B){var C={};b.map(B.substr(1).split("&"),function(E){var D=E.split("=");D[0]&&(C[D[0]]=D[1])});return C}};a.block["b-head-tabs"].getHostToUrlMap=function(){var c={www:"yandsearch",market:"search.xml",maps:""};c.blogs=c.adresa=c.video=c.fotki=c.slovari=c.auto=c.market;c.news=c.yaca=c.images=c.www;return c};a.block["b-head-tabs"].getHostMap=function(){var c={};return c};a.block["b-head-tabs"].getSearchParamName=function(c){return"text"}})(jQuery,window.Lego);(function(c,a){var b=a.block["b-head-user"]=function(){var d=c(this);if(a.params.login!=""){c.getJSON(b.getApiUrl(),{locale:a.params.locale,login:"yes","current-login":a.params.login,yu:a.getCookie("yandexuid")},function(h){if(!h||!h.services){return}var e=b.getUserLogin(h),g='<div class="g-js b-dropdown" onclick="return {name:\'b-dropdown\'}"><ul class="b-dropdown__list"><li class="b-dropdown__item b-dropdown__visible"><a href="http://i.yandex.ru" class="b-dropdown__or"><span class="b-pseudo-link"><b class="b-user"><b class="b-user__first-letter">'+e.substring(0,1)+"</b>"+e.substring(1)+"</b></span></span></a></li>";c.each(h.services,function(){g+='<li class="b-dropdown__item">';if(a.params.id==this.id&&a.params.index){g+="<strong>"+this.title+"</strong>"}else{g+='<a class="b-dropdown__link"href="'+this.url+'"onmousedown="Lego.ch(\''+a.params.id+".login.myservices."+this.id+"',this)\">"+this.title+"</a>"}g+="</li>"});g+=b.getUserItems();g+="</ul></div>";d.find(".b-user").replaceWith(g);a.blockInit(d,".b-dropdown")})}};b.getApiUrl=function(){return a.params["pass-host"]+"/services?callback=?"};b.getUserItems=function(){return['<li class="b-dropdown__item b-dropdown__line">','<a class="b-dropdown__link" href="',a.params["passport-host"],'/">',a.message("b-head-userinfo.user:passport","Паспорт"),"</a>","</li>",'<li class="b-dropdown__item">','<a class="b-dropdown__link" ','href="',a.params["passport-host"],"/passport?mode=changepass&","&amp;retpath=",encodeURIComponent(a.params.retpath),'">',a.message("b-head-userinfo.user:change-password","Сменить пароль"),"</a>","</li>"].join("")};b.getUserLogin=function(d){return a.params.login||d.login}})(jQuery,window.Lego);(function(b,a){a.block["b-search__input"]=function(e){var g=b(this);var c=b.extend({focus:false,shortcut:false},e);if(c.focus||g.data("lego:focused")){if(!g.data("lego:focused")){var d=document.activeElement;(d&&"input textarea".indexOf(d.tagName.toLowerCase())>-1)||setTimeout(function(){g.focus();if(g[0].createTextRange){var j=g[0].createTextRange(),h=g.val().length;j.collapse();j.moveStart("character",h);j.moveEnd("character",h);j.select()}g.data("lego:focused",true)},0)}if(!!window.history.length&&!b.trim(g.val())){g.bind("keydown",function(h){if(h.keyCode==8){if(!b.trim(g.val())){return window.history.back()}}g.unbind("keydown",arguments.callee)})}g.blur(function(){g.data("lego:focused",false)}).focus(function(){g.data("lego:focused",true)})}if(c.shortcut){b(document).keydown(function(h){if(!h.ctrlKey||b(h.target).is("input, textarea")){return}if(h.keyCode==38){g.focus().select()}})}}})(jQuery,window.Lego);(function(c,b){var a=b.block["i-metrika"]=function(d){d.counter&&a.newCounter(d.counter)};a.counters=[];a.newCounter=function(d){a.counters.push(d)};a.callback=function(d){return function(){a.newCounter=function(h){var g=window["yaCounter"+h]=new Ya.Metrika(h);g.clickmap();g.trackLinks({external:true})};var e;while(e=a.counters.shift()){a.newCounter(e)}d&&d()}};!(window.Ya&&Ya.Metrika)&&c(function(){var g=document,e=g.createElement("script");e.type="text/javascript";e.src="//mc.yandex.ru/metrika/watch.js";e.setAttribute("async","true");window.yandex_metrika_callback=a.callback(window.yandex_metrika_callback);g.documentElement.firstChild.appendChild(e)})})(jQuery,window.Lego);Lego.block["i-flashcookie"]=function(c){var a=this,b=arguments.callee.load=function(){location.protocol.indexOf("https")<0&&a.replaceWith($('<iframe src="http://kiks.yandex.ru/su/" class="'+a.attr("class")+'"/>'))};a.hasClass("i-flashcookie_autoload_no")||b()};var key="",time="",is_mediaplan;var submit_flag=false;var SCRIPT="/registered/main.pl";var MAX_URL_LENGTH=1024;var MAX_AUTOBUDGET_BID=50;Array.prototype.__fftrap=function(){};function AdvqLite(m,c,g,j,u){var q=800,l=600;var s="";if(m){s=1}var n="";if(c){n=1}if(!g){g=""}if(document.all||document.layers){q=screen.availWidth;l=screen.availHeight}var a=700,o=600;var d=(q-a)/2,b=(l-o)/2;var e=document.location.host.replace(/forum./,"");WordsWin2=window.open(document.location.protocol+"//"+e+"/registered/main.pl?cmd=wordstat&text="+escape(g)+"&suffix="+escape(u==undefined?"":u)+"&key="+key+"&tm="+time+(j?"&geo="+j:""),"words_window","width="+a+",height="+o+",top="+b+",left="+d+",resizable=yes,scrollbars=yes,status=0");WordsWin2.focus();if(window.event){window.event.returnValue=false}}function AdvqLite_media(n,d,a,m,j){var s=800,l=600;var u="";if(n){u=1}var o="";if(d){o=1}if(document.all||document.layers){s=screen.availWidth;l=screen.availHeight}m=escape(mass[a][0]).replace(/\+/g,"%2B");var b=500,q=600;var g=(s-b)/2,c=(l-q)/2;var e="/registered/main.pl?cmd=wordstat&minus=1&name="+a+"&text="+m+"&geo="+j;WordsWin=window.open(e,"Words","width="+b+",height="+q+",top="+c+",left="+g+",resizable=yes,scrollbars=yes,status=0");if(navigator.appName=="Netscape"){WordsWin.focus()}}function winContactInfo(l,s,a){if(!s){if(document.forms.ad){exfrm=document.forms.ad}else{if(document.forms.saveBanner){exfrm=document.forms.saveBanner}else{if(document.forms.banners){exfrm=document.forms.banners}else{return false}}}var n="";if(l){n="-"+l}var o=document.createElement("form");o.action="/registered/main.pl";o.method="GET";o.target="ContactInfoPopup";var c={cmd:"showContactInfo",from:"edit",bid:l};for(var e in c){var m=document.createElement("input");m.type="hidden";m.name=e;m.value=c[e];o.appendChild(m)}var h=new Array("title","body","href","domain","city","country","name","street","house","build","apart","country_code","city_code","phone","ext","contactperson","im_login","im_client","extra_message","contact_email","worktime");for(var g=0;g<h.length;g++){var m=h[g];if(!o[m]){var q=document.createElement("input");q.type="hidden";q.name=m;q.value=exfrm[m+n].value;o.appendChild(q)}}document.getElementsByTagName("body")[0].appendChild(o);hwin=create_standard_window("","ContactInfoPopup");o.submit();document.getElementsByTagName("body")[0].removeChild(o)}else{if(l&&s){var b="";if(is_mediaplan){b="&media="+is_mediaplan}if(typeof(a)=="object"&&a.is_mediaplan){b="&media="+a.is_mediaplan}var d="/registered/main.pl?cmd=showContactInfo&bid="+l+b;create_standard_window(d,"_blank")}}return false}function create_standard_window(b,a,l,j){var l=800,j=600;if(document.all||document.layers){l=screen.availWidth;j=screen.availHeight}var c=700,m=700;var e=(l-c)/2,d=(j-m)/2;var g=window.open(b,a,"width="+c+",height="+m+",top="+d+",left="+e+",resizable=yes,scrollbars=yes,status=0");return g}function CheckAll(b,a){thisCheckBoxes=b.parentNode.parentNode.parentNode.getElementsByTagName("input");for(i=1;i<thisCheckBoxes.length;i++){if(thisCheckBoxes[i].name.substring(0,a.length)==a){thisCheckBoxes[i].checked=b.checked}}}function OpenWindow(e,c,g,b,a){var d=window.open(e,b,"width="+c+",height="+g+",status=yes,menubar=no,resizable=yes,scrollbars=1");if(a){d.focus()}if(window.event){window.event.returnValue=false}return false}function save(a){regions="";regions_id="";for(i=0;i<a.length;i++){if(a[i].type=="checkbox"&&a[i].checked){regions+=a[i].value+"\n";regions_id+=a[i].name+","}}opener.window.document.forms.geo.geo.value=regions_id;opener.window.document.forms.ad.geo.value=regions}function check_regions(b,c){var a;if(!c){c=0}for(a=c;a<f.length;a++){if(f[a].type=="checkbox"&&f[a].name!=b.name){if(Regions[f[a].name].arrayOfids[0]==b.name||Regions[f[a].name].arrayOfids[1]==b.name){f[a].disabled=b.checked;if(c>0){alert(f[a].disabled+" - "+f[a].value)}if(f[a].checked&&Regions[f[a].name].arrayOfids.length>0){check_regions(f[a],a+1)}}}}}function region(a){this.id=a;this.arrayOfids=a.split("_")}function RegionsCollection(){Regions=new Array();for(i=0;i<f.length;i++){if(f[i].type=="checkbox"){Regions[f[i].name]=new region(f[i].id)}}for(i=0;i<f.length;i++){if(f[i].type=="checkbox"){check_regions(f[i])}}}function WinAdvq(b){var a=640,g=480;if(document.all||document.layers){a=screen.availWidth;g=screen.availHeight}var e=580,j=480;var c=(a-e)/2,d=(g-j)/2;WordsWin=window.open(b,"Words","width="+e+",height="+j+",top="+d+",left="+c+",resizable=yes,scrollbars=yes,status=0");if(navigator.appName=="Netscape"){WordsWin.focus()}}function ClearGeo(){document.forms.ad.text_geo.value=iget("Все");document.forms.ad.geo.value="0";document.forms.geo.geo.value="0";show_cleargeo()}function settime(){document.forms.login.timestamp.value=new Date().getTime()}function rubrics_choose(a){var h=a?"-"+a:"";var e=document.ad?document.ad:document.banners;document.cc.ChoosedCategories.value=e["ChoosedCategories"+h].value;document.cc.UncheckedCategories.value=e["UncheckedCategories"+h].value;if(a){document.cc.bid.value=a}var g=new Array();if(e.phrases&&e.phrases.value){g[g.length]=e.phrases.value}if(e["new_phrases"+h]&&e["new_phrases"+h].value){g[g.length]=e["new_phrases"+h].value}var c=e.elements;var d=new RegExp("^ph"+h+"_\\d+$");for(var b=0;b<c.length;b++){if(c[b].name.match(d)){g[g.length]=c[b].value}}document.cc.phrases.value=g.join(", ");OpenWindow("/registered/main.pl?cmd=showRubrics&rubrics="+document.cc.ChoosedCategories.value,700,600,"catalog_choose");document.cc.submit()}function rubrics_clear(a){var c=a?"-"+a:"";var b=document.ad?document.ad:document.banners;b["UncheckedCategories"+c].value=b["UncheckedCategories"+c].value?b["UncheckedCategories"+c].value+","+b["ChoosedCategories"+c].value:b["ChoosedCategories"+c].value;b["ChoosedCategories"+c].value="";b["text_rubrics"+c].value="";document.getElementById("rubrics_clear_div"+c).style.display="none"}function autobudgetPriority(c,a){var b=document.getElementById(c+"_text");if(b==null){return}if(a==1){b.innerHTML='<span style="color: red">'+iget("низкий")+"</span>"}else{if(a==5){b.innerHTML='<span style="color: green">'+iget("высокий")+"</span>"}else{b.innerHTML="<span>"+iget("средний")+"</span>"}}}function get_number_word(d,b,a,g){d=d+"";var c=d.charAt(d.length-1);var e=g;if(d>=11&&d<=14){e=g}else{if(c==1){e=b}else{if(c>=2&&c<=4){e=a}}}return d+"&nbsp"+e}var elements_cache={};function getElement(a){if(!elements_cache[a]){elements_cache[a]=document.getElementById(a)}return elements_cache[a]}function getValue(a){var b=getElement(a);if(b.tagName.toLowerCase()=="select"){if(b.selectedIndex>=0){return b.options[b.selectedIndex].value}else{return""}}else{if(b.tagName.toLowerCase()=="input"&&b.type.toLowerCase()=="checkbox"){return b.checked?b.value:""}else{return b.value}}}function setValue(a,b){var d=getElement(a);if(d.tagName.toLowerCase()=="select"){d.selectedIndex=0;for(var c=0;c<d.options.length;c++){if(d.options[c].value==b){d.selectedIndex=c;break}}}else{if(d.tagName.toLowerCase()=="input"&&d.type.toLowerCase()=="checkbox"){d.checked=d.value==b}else{d.value=b}}}function getStyle(a){return getElement(a).style}function get_xml_value(b,a){return b.getElementsByTagName(a)[0].firstChild.data}function url_domain_warning(c){var g=c?document.banners:document.ad;var a=c?"-"+c:"";var h=g["domain"+a].value.replace(/^www\./,"");var e=g["domain_calc"+a].value.replace(/^www\./,"");var b=g["domain_ascii"+a].value.replace(/^www\./,"");document.getElementById("domain_warning"+a).style.display=(e==h||e==b)?"none":"block"}function change_strict_domain_status(e){var h=e?document.banners:document.ad;var d=e?"-"+e:"";var g=document.getElementById("tr_domain_strict"+d);var c=g.style.display=="none";g.style.display=c?"":"none";var b=document.getElementById("a_domain_strict"+d);b.innerHTML=c?"&ndash;":"+";b.blur()}function getElementPosition(a){var c=a.offsetLeft;var b=a.offsetTop;while(a.offsetParent!=null){a=a.offsetParent;c+=a.offsetLeft;b+=a.offsetTop}this.x=c;this.y=b;return this}function changeDisplayCI(c,b){if(b){bid_fix="-"+b}else{bid_fix=""}var a=$("#TB"+bid_fix);a.toggleClass("hidden");if(b){c.innerHTML=a.hasClass("hidden")?iget("показать адрес и телефон"):iget("скрыть адрес и телефон")}}function changevis(a,b){if(b){a.style.display=b;return 1}if(a.style.display=="none"||a.style.display==""){a.style.display="block"}else{a.style.display="none"}}function yasetCookie(b,d,c,e,a,g){document.cookie=b+"="+escape(d)+((c)?"; expires="+c:"")+((e)?"; path="+e:"")+((a)?"; domain="+a:"")+((g)?"; secure":"")}function yahide(){var b="directya";var d=1;var c=new Date();c.setYear(1900+c.getYear()+1);var a=$.extractDomain(document.location.host).replace(/:\d+/,"");yasetCookie(b,d,c,null,a);document.location.reload()}function yashow(){var b="directya";var d=0;var c=new Date(0);var a=$.extractDomain(document.location.host).replace(/:\d+/,"");yasetCookie(b,d,c,null,a);document.location.reload()}function yagetCookie(b){var a=document.cookie.split(/; */);for(var c=0;c<a.length;c++){var d=a[c].split("=");if(d[0]==b){return d[1]}}}function openWnd(b,a,c,d){if(top[a]!=null&&typeof(top[a])=="object"&&!top[a].closed&&top[a].load_flag==1){if(top[a].document.location.href!=b){top[a].document.location.href=b}top[a].focus()}else{top[a]=window.open(b,a,"width="+c+",height="+d+",status=yes,menubar=no,resizable=yes,scrollbars=yes,left="+String((screen.width-c)/2)+",top="+String((screen.height-d)/2))}}function format_href(b,c){if(!b||b.match(/^#/)){return b}if(!b.match(/^https?:\/\//)){b="http://"+b}if(c){var a=b.match(/\?/)?"&":"?";b=b.replace(/($|\#)/,a+"_openstat=dGVzdDsxOzE7$1")}return b}function push_i18n(a){window.i18n=window.i18n||{};for(var b in a){if(!a.hasOwnProperty(b)){continue}window.i18n[b]=a[b]}}function iget(){var c=Array.prototype.slice.call(arguments,1),b=window.i18n&&window.i18n[arguments[0]]?window.i18n[arguments[0]]:arguments[0];if(c.length>0){while(c.length!=0){var a=c.shift();b=b.replace(/%s/,a)}}return b}function switchPopup(c,a){var b=document.getElementById(c.toString());if(b){if(b.className=="popup"){if(a!=0){b.className="hidden"}}else{if(a!=1){b.className="popup"}}}}function mcb_theme_name(a){return a.parent_name+" / "+a.name}function r(c,b){if(c&&c.href){new Image().src=document.location.protocol+"//clck.yandex.ru/click/dtype="+b+"/*"+c.href}else{new Image().src=document.location.protocol+"//clck.yandex.ru/click/dtype="+b+"/*http://direct.yandex.ru/"}}function send_event(g,e){var d=new Image(1,1);d.src="/event?"+escape(g).replace(/\+/g,"%2B");if(e){return}var c=new Date();var h=c.getTime();for(var b=1;b>0;b++){if(b%1000==0){c=new Date;var a=c.getTime();if(a-h>500){break}}}}function autobroker_toggle(){var e=$(".b-banner-list");var b=$("#id_autobroker_toggler");if(!e.length||!b.length){return}if(e.hasClass("autobroker-hidden")){b[0].innerHTML=iget("Спрятать настройки автоброкера &larr;");direct.UserOptions.set("autobroker",1)}else{b[0].innerHTML=iget("Показать настройки автоброкера &rarr;");direct.UserOptions.remove("autobroker")}e.toggleClass("autobroker-hidden");if($.browser.msie){var d=e.hasClass("autobroker-hidden")?"none":"";$("td.autobroker").each(function(a,c){c.style.display=d})}}function adler32(h){var g=65521;var d=1,c=0;for(var e=0;e<h.length;e++){d=(d+h.charCodeAt(e))%g;c=(c+d)%g}return(c<<16)|d}function round2s(a){return a.toFixed(2)}function check_quick_moderate(cid){$.ajax({type:"GET",url:"/registered/main.pl",complete:function(req){var r=req.responseText;eval("var k = "+r);show_quick_moderate_result(k.result)},data:{cmd:"ajaxCheckPreModerate",cid:cid}});return 1}function show_quick_moderate_result(a){$("#quick_moderate").addClass("hidden");if($("#pay_camp_panel").length){$("#pay_camp_panel").toggleClass("hidden",!(a>0))}if(a>0){$("#post_moderate").removeClass("hidden")}else{$("#pre_moderate").removeClass("hidden")}return 1}function js_resend_moderate(a){if(!a){return}$.ajax({url:a,type:"GET",data:{},dataType:"text",success:function(b){if(b){alert(iget("Объявление успешно отправлено на модерацию"))}},error:function(c,d,b){alert(d)}});return}if(window.y5){y5.require("Strings",function(){var g=y5.Strings,d=y5.Types,e=/\s*;\s*/g,j=/\s*:\s*/,b=/[<>\s]/,l=/\d+px/,o=/z-?index|font-?weight|opacity|zoom|line-?height/i;function n(s,q,u){s.style[g.camelize(q)]=u;return s}function h(s,q){return y5.Elements.getStyle(s).getPropertyValue(g.dasherize(q))}y5.Elements={create:function(u,q,w){var s;if(!d.string(u)){q=u.attributes;u=u.tagName}if(!b.test(u)){if(g.compare(u,"style",true)==0){s=document.createElement("div");s.innerHTML="<p>x</p><style>"+(w||q.innerHTML||"")+"</style>";s=s.childNodes[1];w=undefined;delete q.innerHTML}else{try{if(y5.is_ie&&q&&q.name){s=document.createElement("<"+u+' name="'+q.name+'"/>');delete q.name}else{s=document.createElement(u)}}catch(v){}}}if(!s){s=document.createElement("div");if(g.startsWith(u,"<style",true)){s.innerHTML="<p>x</p>"+u;s=s.childNodes[1]}else{s.innerHTML=u;s=s.firstChild}}if(d.object(q)){this.setAttributes(s,q)}if(d.def(w)){this.setHTML(s,w)}return s},setAttributes:function(v,s){if(!s){return}var u,y,q,z,x,w;for(u in s){y=s[u];switch(u){case"style":case"cssText":if(v.style.cssText&&!(y.indexOf("opacity")!=-1&&y5.is_ie)){v.style.cssText=y}else{q=y.split(e);z=q.length;for(w=0;w<z;w++){x=q[w].split(j);n(v,x[0],x[1])}}break;case"class":case"className":v.className=y;break;case"innerHTML":v.innerHTML=y;break;default:v.setAttribute(u,y)}}},setHTML:function(q,s){q.innerHTML=s;return q},css:function(u,s,v){var q=s,w;if(d.string(s)){if(d.undef(v)){v=h(u,s);if(s=="opacity"){return parseFloat(v,10)}return l.test(v)?parseInt(v,10):v}else{q={};q[s]=v}}for(w in q){n(u,w,d.number(v=q[w])&&!o.test(w)?v+"px":v)}},getStyle:function(q){return document.defaultView.getComputedStyle(q,null)}};var a=y5.Elements;a.createElement=a.create;a.setElementAttributes=a.setAttributes;a.createElementWithName=a.createWithName;a.createElementFromHTML=a.create;a.createWithName=function(q,s){return a.create(q,{name:s})};a.createFromHTML=a.create;a.getPropertyValue=a.css;a.getPropertyValuePx=a.css;a.getPropertyValueFloat=a.css;a.setPropertyValue=a.css;a.setPropertyValuePx=a.css;if(d.undef(document.defaultView)){a.getStyle=function(q){return q.currentStyle||q.runtimeStyle};h=function(s,w){var q=g.camelize(w),u;switch(q){case"opacity":u=100;try{u=s.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(v){try{u=s.filters("alpha").opacity}catch(v){}}return(u/100).toString();case"float":q="styleFloat";break;case"width":case"height":case"top":case"right":case"bottom":case"left":var x=false;if(!s.style[q]){s.style[q]=a.getStyle(s)[q];x=true}u=s.style["pixel"+g.capitalize(q)];if(x){s.style[q]=null}return u}return a.getStyle(s)[q]};function m(q){return q.replace(/alpha\s*\([^\)]*\)/ig,"")}var c=n;n=function(s,w,v){switch(w){case"opacity":var q=h(s,"filter");var u=s.style;if(v==1){q=m(q);if(q){u.filter=q}else{u.removeAttribute("filter")}return s}else{if(v<0.00001){v=0}}if(!u.zoom){u.zoom=1}u.filter=m(q)+"alpha(opacity="+(v*100)+")";break;default:c(s,w,v)}return s}}y5.loaded("Elements")});y5.require("Events","Strings",function(){y5.Range=function(b){this.element=b;this.init()};y5.Range.prototype={init:y5.VOID,select:function(c,b){this.element.setSelectionRange(c,b||c)},collapse:function(b){this.select(b?this.getStart():this.getEnd())},replace:function(c,h){var b=this.getStart(),g=b+c.length,d=this.element,e=d.value;d.value=e.substring(0,b)+c+e.substring(this.getEnd(),e.length);d.focus();if(!h){b=g}this.select(b,g)},fill:function(b){this.replace(y5.Strings.repeat(b,this.getEnd()-this.getStart()),true)},extract:function(){return this.element.value.slice(this.getStart(),this.getEnd())},selectPattern:function(b,c,m){var h=this.element.value,e=h.length,l=typeof c=="number"?c:this.getStart();if(l>e){l=e}var j=l;function g(){var n=h.slice(l,j);return(b.test(n)&&n.lastIndexOf("\n")==-1)?n:null}do{l--}while(l>=0&&g());l++;do{j++}while(j<=e&&g());j--;var d=g();if(d){if(m){this.select(l,j)}return d}return null},charAtCaret:function(){var c=this.getStart(),b=this.getEnd();if(c==b){return this.element.value.slice(c,b+1)}return this.extract()},setCaret:function(b){this.select(b)},getStart:function(){return this.element.selectionStart},getEnd:function(){return this.element.selectionEnd},isSelected:function(){return this.getStart()!=this.getEnd()},handleCaretPosition:function(b){return y5.Events.observe(["click","keydown","keypress","keyup"],b,this.element,true,this)},handleClick:function(b){return y5.Events.observe("click",b,this.element,true,this)}};var a=y5.Range.prototype;if(!window.getSelection){a.init=function(){this.isTextarea=this.element.tagName.toLowerCase()=="textarea"};a.getRange=function(c){var b,d=this.element;if(this.isTextarea){b=c.duplicate();b.moveToElementText(d)}else{b=d.createTextRange()}return b};a.select=function(g,b){var d=this.element,e=d.value,c=d.createTextRange();if(g<0){g=0}if(b>e.length){b=e.length}b=b||g;b-=g+e.slice(g+1,b).split("\n").length-1;g-=e.slice(0,g).split("\n").length-1;c.move("character",g);c.moveEnd("character",b);c.select()};a.getStart=function(){var c=document.selection.createRange(),b=this.getRange(c);b.setEndPoint("EndToStart",c);return b.text.length};a.getEnd=function(){var c=document.selection.createRange(),b=this.getRange(c);b.setEndPoint("EndToStart",c);return b.text.length+c.text.length}}y5.loaded("Range")});y5.require("Utils","Dom","Styles","Template",function(){y5.Widget={widgets:{},widgetsQuery:{},make:function(d,b,e){var g=this.getId(d);var a=this.getById(g);if(a){a.make(e)}else{if(this.widgetsQuery[g]){return d}this.widgetsQuery[g]=true;var c;if(y5.Types.element(d)){c=y5.Dom.getChildren(d);y5.Dom.clearNode(d)}this.add(d,c,b,e)}return d},kill:function(b){var a=this.get(b);if(a){a.kill()}else{y5.Console.warn("Unknown widget: "+b,["y5.Widget"])}},get:function(a){return this.getById(this.getId(a))},getId:function(a){return y5.Types.string(a)?a:y5.Utils.getUniqueId(a)},getById:function(a){return this.widgets[a]||null},add:function(c,b,a,d){var g=this.getId(c),e=this;y5.require(a,function(){var h=new (y5.moduleObject(a))(c,b,d);y5.GC.collect(h);e.widgets[g]=h})}};y5.Widget.Templates={templates:{},add:function(c,b,a){if(!this.templates[c]){this.templates[c]={}}this.templates[c][b]=a},get:function(b,a){try{return this.templates[b][a]}catch(c){return null}}};y5.Widget.Template=function(c,a,b){b=b||"default";this.frame="";this.body="";this.header="";this.footer="";if(a){a=y5.Widget.Templates.get(a,b);this.frame=a.frame;this.body=a.body;this.header=a.header;this.footer=a.footer}y5.Widget.Templates.add(c,b,this)};y5.Widget.Template.prototype={loadCSS:function(a){return y5.Styles.createStyle(a)},loadCSSModule:function(a){return y5.Styles.loadModule(a)},setFrame:function(a){this.setPart(a,"frame")},setBody:function(a){this.setPart(a,"body")},setHeader:function(a){this.setPart(a,"header")},setFooter:function(a){this.setPart(a,"footer")},setPart:function(a,b){if(y5.Types.element(a)){a=a.innerHTML}this[b]=a},getHTML:function(){return y5.T(this.frame,{content:this.header+this.body+this.footer})}};y5.loaded("Widget")});y5.ObjectMove=function(d,e,a,b,c){this.object=d;this.region=e;this.callbacks=a;this.clickListener=b;this.context=c||this;this.initCallbacks();this.moved=false;this.startPoint=null;this.clickPoint=null;this.oldSelectStart=null;this.oldMouseDown=null;this.aClickListener=(this.clickListener instanceof y5.AEventListener);this.downListener=new y5.AEventListener("mousedown",this.down,this.object,false,this);this.moveListener=new y5.AEventListener("mousemove",this.move,document,false,this);this.upListener=new y5.AEventListener("mouseup",this.up,document,false,this);this.start()};y5.ObjectMove.prototype={start:function(){this.downListener.add()},stop:function(){this.downListener.remove();this.moveListener.remove();this.upListener.remove()},down:function(a){if(!a.buttonL){return true}this.moveListener.add();this.upListener.add();this.disableEvents(a);this.startPoint=y5.Dom.getOffset(this.object);this.clickPoint=[a.pageX,a.pageY];this.callbacks.down.call(this.context,this.object,a,this.startPoint,this.clickPoint);return false},move:function(b){var a=[this.startPoint[0]+(b.pageX-this.clickPoint[0]),this.startPoint[1]+(b.pageY-this.clickPoint[1])];if(!this.moved){this.callbacks.start.call(this.context,this.object,b,a,this.startPoint,this.clickPoint)}this.moved=true;this.callbacks.move.call(this.context,this.object,b,a,this.startPoint,this.clickPoint);return false},up:function(a){this.enableEvents(a);this.moved=false;this.moveListener.remove();this.upListener.remove();this.callbacks.up.call(this.context,this.object,a,y5.Dom.getOffset(this.object));return false},CALLBACKS:["down","start","move","up"],initCallbacks:function(){if(typeof(this.callbacks)!=="object"){this.callbacks={}}for(var c=0,a=this.CALLBACKS.length;c<a;c++){var b=this.CALLBACKS[c];if(typeof(this.callbacks[b])!=="function"){this.callbacks[b]=y5.FALSE}}},disableEvents:function(a){this.oldSelectStart=document.onselectstart;document.onselectstart=y5.FALSE;this.oldMouseDown=document.onmousedown;document.onmousedown=y5.FALSE;this.old_click=this.object.onclick;this.object.onclick=y5.FALSE;if(this.aClickListener){this.clickListener.remove()}},enableEvents:function(b){document.onselectstart=this.oldSelectStart;this.oldSelectStart=null;document.onmousedown=this.oldMouseDown;this.oldMouseDown=null;var c=this;function a(){c.object.onclick=c.old_click;if(c.aClickListener){c.clickListener.add()}}if(!this.moved){a()}else{window.setTimeout(a,100)}}};y5.require(["Events","Dom"],function(){y5.loaded("ObjectMove")});y5.require(["Utils","Elements","Dom","Classes","Events","ObjectMove","Template","Widget"],function(){var h=y5.VOID,u=y5.UNDEF,d=y5.Types,j=y5.Dom,l=y5.Utils,n=y5.Classes,a=y5.Elements,s=y5.Widget,b="Widget.Window",m=y5.AEventListener,g='<div class="y5-w-fakeframe"><iframe src="javascript:\'<body style=\\\'background:none\\\'>\'" frameborder="0"></iframe></div>';s.Window=function(v,w,x){this.init(v,w,x)};s.Window.prototype={classContainer:"y5-w-content",defaultParams:{text:null,modal:false,event:null,element:"y5:viewport",halign:"center",valign:"middle",relative:false,fixed:false,saveState:false,savePosition:false,className:null,template:"default"},toString:function(){return b},init:function(v,w,x){this.element=v;this.content=w;this.params={};this.window=null;this.events={};this.callbacks={};this.shortcuts={};this.isActive=false;c.init();this.initParams=l.objectCopy(x);this.makeParams(x);this.create();this.make(x)},initOnce:function(){this.event("init");this.initOnce=h},box:function(w){var v=y5.Widget.Templates.get(this.toString(),this.params.template);return y5.T(v.getHTML(),w)},create:function(){var w=this.params;var v="y5-w-window"+(this.className?" "+this.className:"")+(w.className?" "+w.className:"")+(w.modal?" y5-w-window-modal":"");this.window=a.create("div",{style:"position:absolute;left:-999em;","class":v});this.window.innerHTML=this.box();this.dragWindowInitOnce()},getContainerOnce:function(){this.container=j.getElementByClass(this.classContainer,this.window);this.getContainerOnce=h},getFooterOnce:function(){this.footer=j.getElementByClass("y5-w-buttons",this.window);this.getFooterOnce=h},fillContainer:function(v){this.container.appendChild(this.params.saveState?v:v.cloneNode(true))},refreshContent:function(){if(this.params.text){this.container.innerHTML=y5.Strings.text2html(this.params.text)}else{if(this.params.html){this.container.innerHTML=this.params.html}else{j.clearNode(this.container);this.content.forEach(this.fillContainer,this)}}},setContent:function(){this.getContainerOnce();try{this.refreshContent()}catch(v){y5.Console.error("Find container",[b])}},convertPosition:function(y,v,z,x){var w=0;if(y.indexOf("%")!=-1){w+=(z-x)*(parseFloat(y)/100)}else{if(y.indexOf("em")!=-1){w+=j.em2px(parseFloat(y),v)}else{w+=parseFloat(y)}}return parseInt(w,10)},getScrollX:function(){return(this.params.fixed?j.getPageScrollX():0)},getScrollY:function(){return(this.params.fixed?j.getPageScrollY():0)},getPosition:function(){var x=this.params;var w;var y,z;if(x.element=="y5:viewport"||j.testTagName(x.element,["html","body"])){w=j.getBody();var v=j.viewPort();y=v[0];z=v[1]}else{w=x.element;y=w.clientWidth||w.offsetWidth;z=w.clientHeight||w.offsetHeight}var A=j.getOffset(w);A[0]+=this.convertPosition(x.halign,w,y,(x.relative?this.window.clientWidth:0));A[1]+=this.convertPosition(x.valign,w,z,(x.relative?this.window.clientHeight:0));return A},dragWindowInitOnce:function(){this.caption=j.getElementByClass("y5-w-titlebar",this.window);if(this.caption){var B=this;var y;function A(){y=j.getOffset(B.window)}function x(E,D,C,F){C=[C[0]+(y[0]-F[0]),C[1]+(y[1]-F[1])];B.dragWindowMove(D,C)}function z(){B.dragWindowStart()}function w(){B.dragWindowUp()}var v=new y5.ObjectMove(this.caption,document,{down:A,start:z,move:x,up:w});v.disableEvents=v.enableEvents=y5.VOID}this.dragWindowInitOnce=h},dragWindowStart:function(){n.add(this.window,"y5-w-window-moved")},dragWindowUp:function(){n.remove(this.window,"y5-w-window-moved")},dragWindowMove:function(z,x){if(z.clientX<0){x[0]-=z.clientX}if(z.clientY<0){x[1]-=z.clientY}var w=j.viewPort();var y=z.clientX-w[0];if(y>0){x[0]-=y}var v=z.clientY-w[1];if(v>0){x[1]-=v}this.moveTo(this.getMoveTo(this.X=x[0],this.Y=x[1]))},initPosition:function(){var C=this.getMoveTo(this.X,this.Y);var B=C[0];var A=C[1];var v=j.viewPort();var z=Math.floor(B-v[0]*0.07);var x=Math.floor(A-v[1]*0.07);var y=j.getPageScrollX();var w=j.getPageScrollY();if(B<y||A<w){window.scrollTo(z,x)}this.moveTo(C,true)},setPosition:function(){this.moveTo(this.getMoveTo(this.X,this.Y),true)},getMoveTo:function(v,A){var w=this.params;if(typeof v!=u&&typeof A!=u){}else{if(w.event){v=w.event.pageX;A=w.event.pageY}else{var z=this.getPosition();v=z[0];A=z[1]}}return[v,A]},moveTo:function(y,v){var x=(y[0]+(v?this.getScrollX():0));var w=(y[1]+(v?this.getScrollY():0));this.window.style.left=x+"px";this.window.style.top=w+"px"},setZIndex:function(v){this.window.style.zIndex=v},setEventsOnce:function(){this.events.scroll=new m("scroll",this.setPosition,window,false,this);this.events.resize=new m("resize",this.setPosition,window,false,this);this.setEventsOnce=h},enableEvents:function(){this.setEventsOnce();for(var v in this.events){this.events[v].add()}},disableEvents:function(){for(var v in this.events){this.events[v].remove()}},event:function(x){var z=this.params,w="on"+x,v=z.callbackContext||this,y=z.callbackObject;if(d.func(z[w])){z[w].call(v,this)}if(y&&d.func(y[w])){y[w](this)}return y5.Notify("y5:"+x,this.element,this)},action:function(w,v){w.preventDefault();if(this.event(v)){this.kill()}},setCallBacksOnce:function(){this.callbacks.killAllWidgets=new y5.Observer("y5:killAllWindows",this.kill,s,true,this);this.setCallBacksOnce=h},enableCallBacks:function(){this.setCallBacksOnce();for(var v in this.callbacks){this.callbacks[v].add()}},disableCallBacks:function(){for(var v in this.callbacks){this.callbacks[v].remove()}},setShortcutsOnce:function(){this.setShortcutsOnce=h},enableShortcuts:function(){this.setShortcutsOnce();for(var v in this.shortcuts){this.shortcuts[v].add()}},disableShortcuts:function(){for(var v in this.shortcuts){this.shortcuts[v].remove()}},makeParams:function(w){var v;if(w){v=w.callbackContext;w.callbackContext=null}this.params=l.objectCopy({},this.defaultParams);this.params=l.objectCopy(this.params,w);if(d.object(v)){this.params.callbackContext=v;w.callbackContext=v}this.normalizeParams()},normalizeParams:function(){var v=this.params;switch(v.halign){case"left":v.halign="0";break;case"center":v.halign="50%";break;case"right":v.halign="100%";break;default:v.halign=v.halign.toString();break}switch(v.valign){case"top":v.valign="0";break;case"middle":v.valign="50%";break;case"bottom":v.valign="100%";break;default:v.valign=v.valign.toString();break}},make:function(v){if(!this.isActive){this.makeParams(v);this.setContent();this.getFooterOnce();c.show(this,this.params.modal);this.initPosition();n.add(this.window,"y5-w-visible");this.enableEvents();this.enableShortcuts();this.enableCallBacks();this.initOnce();this.isActive=true;this.event("make")}this.event("activate")},kill:function(){n.remove(this.window,"y5-w-visible");c.hide(this,this.params.modal);this.disableEvents();this.disableShortcuts();this.disableCallBacks();this.isActive=false;this.event("kill");if(!this.params.savePosition){delete this.X;delete this.Y}},cleanup:function(){this.kill();this.element=null;this.content=null;this.window=null;this.events=null;this.callbacks=null;this.shortcuts=null}};if(y5.is_gecko&&y5.gecko_ver<1.9){var o=s.Window.prototype;o.createOld=o.create;o.create=function(){this.createOld();this.window.style.cssText="position:fixed"};o.getScrollX=function(){return(this.params.fixed?0:-j.getPageScrollX())};o.getScrollY=function(){return(this.params.fixed?0:-j.getPageScrollY())}}var c={containerView:null,modalLayer:null,opens:[],init:function(){this.initOnce()},initOnce:function(){this.html=j.getHtml();this.body=j.getBody();this.box=y5.$("y5-w-window-box")||this.body;this.containerView=a.create("div",{"class":"y5-w-window-view",style:"visibility:visible; position:absolute; left:0; top:0; width:100%; height:0; z-index:999999"});this.box.insertBefore(this.containerView,this.box.firstChild);this.initOnce=h},showBase:function(v,w){if(w){this.createModalLayerOnce(v,w);this.containerView.appendChild(this.modalLayer);this.modalLayer.style.display=""}},show:function(v,w){v.window.style.display="";this.showBase(v,w);this.addOpen(v);this.containerView.appendChild(v.window)},hideBase:function(){for(var v=this.opens.length-1;v>-1;v--){if(this.opens[v].params.modal){this.containerView.insertBefore(this.modalLayer,this.opens[v].window);return}}if(this.modalLayer){this.modalLayer.style.display="none"}},hide:function(v){v.window.style.left="-999em";this.removeOpen(v);this.hideBase(v)},createModalLayerElement:function(v){var w=(y5.is_opera&&y5.opera_ver<9)?"y5-w-modal-opera":"y5-w-modal";this.modalLayer=a.create("div",{"class":w,style:v});new m("click",function(x){x.stopPropagation()},this.modalLayer,true);if(y5.is_ie7down||(y5.is_linux&&y5.is_gecko)){this.modalLayer.appendChild(a.create(g))}this.containerView.appendChild(this.modalLayer)},createModalLayerOnce:function(){this.createModalLayerElement("position:fixed; display:none; left:0; top:0; width:100%; height:100%");this.createModalLayerOnce=h},addOpen:function(v){var w=0;this.opens.forEach(function(x){x.setZIndex(w++);x.disableShortcuts()});this.opens.push(v);if(v.params.modal){this.modalLayer.style.zIndex=w++}v.setZIndex(w)},removeOpen:function(w){var A=this.opens;var y=A.lastIndexOf(w);A.splice(y,1);var v=A.length;if(v){A[v-1].enableShortcuts()}var z=0;A.forEach(function(C){C.setZIndex(z++)});if(w.params.modal){var B=false;for(var x=A.length-1;x>=0;x--){if(A[x].params.modal){A[x].setZIndex(x+1);this.modalLayer.style.zIndex=x;B=true;break}}if(!B){this.modalLayer.style.zIndex=-1}}}};if(y5.is_ie){c.createModalLayerOnce=function(){this.createModalLayerElement("position:absolute; display:none");this.createModalLayerOnce=h}}if(!s.Templates.get(b,"default")){var q=new s.Template(b,null,"default");q.loadCSSModule(b);var e='<div class="y5-w-frame">${content}</div>';if(!y5.is_opera||y5.opera_ver>=9){e+='<div class="y5-w-shadow"></div><div class="y5-w-shadow y5-w-shadow2"></div>'}if(y5.is_ie7down||(y5.is_linux&&y5.is_gecko)){e+=g}q.setFrame(e);q.setBody('<div class="y5-w-content"></div>')}y5.loaded("Widget.Window")});y5.require(["Utils","Dom","Events","ShortCuts","Template","Widget.Window"],function(){var b="Widget.Popup";y5.Widget.Popup=function(c,d,e){this.Window(c,d,e)};y5.Widget.Popup.prototype={className:"y5-w-popup",defaultParams:{halign:"left",valign:"bottom",showCaption:false,title:""},toString:function(){return b},cancel:function(c){this.action(c,"cancel")},setEventsOnce:function(){this.button_close=y5.Dom.getElementByClass("y5-w-closebutton",this.window);if(this.button_close){this.events.close=new y5.AEventListener("click",this.cancel,this.button_close,false,this)}this.events.hide_click=new y5.AEventListener("mousedown",this.hide_click,document,false,this);this.Window.prototype.setEventsOnce.apply(this)},hide_click:function(c){if(!y5.Dom.isChild(c.target,this.window)){this.kill()}},setShortcutsOnce:function(){this.shortcuts.esc=y5.ShortCut.down([{key:y5.ShortCut.ESC}],this.esc,document,{checkTarget:false,context:this});this.Window.prototype.setShortcutsOnce.apply(this)},esc:function(c){this.action(c,"esc")}};y5.Utils.objectExtends(y5.Widget.Popup,y5.Widget.Window,"Window");if(!y5.Widget.Templates.get(b,"default")){var a=new y5.Widget.Template(b,"Widget.Window","default");a.loadCSSModule(b)}y5.loaded(b)});y5.require(["Utils","Classes","Events","Elements","ShortCuts","Widget.Popup","Dom"],function(){var d=y5.Dom,e=y5.Utils,h=y5.Classes,c=y5.Observer,g=y5.ShortCut,a=y5.Elements,b="Widget.Menu",j=y5.AEventListener;y5.Widget.Menu=function(m,n,o){this.initMenu(m,[],o)};y5.Widget.Menu.prototype={className:"y5-w-menu",classNameItem:"y5-w-menu-item",defaultParams:{saveState:true},toString:function(){return b},initMenu:function(m,n,o){this.uid=e.generateUniqueId();this.ids={};this.elements={};this.clear();this.MenuBase(m,n,o)},make:function(m){this.MenuBase.prototype.make.apply(this,[m]);this.refresh()},clear:function(){this.items=[];this.content=[];this.counter=0;this.activeItem=null;this.activeLast=null;for(var m in this.elements){delete this.elements[m]}for(var m in this.ids){delete this.ids[m]}if(this.eventsOver){this.eventsOver.forEach(function(n){n.cleanup()})}this.eventsOver=[];if(this.container){d.clearNode(this.container)}},roll:function(m){},refresh:function(){if(this.activeLast){var m=this.getElement(this.activeLast);if(m){h.remove(m,"y5-w-menu-item-active")}}if(this.activeItem){var m=this.getElement(this.activeItem);h.add(m,"y5-w-menu-item-active")}},getUid:function(){return this.uid+"_"+this.counter++},setActiveItem:function(n){this.activeLast=this.activeItem;var m=this.getItem(n);if(!m||m.disabled){this.activeItem=this.getNextId(n)}else{this.activeItem=n}},getFirstId:function(){for(var n=0,m=this.items.length;n<m;n++){if(!this.items[n].disabled){return this.items[n].id}}return null},getLastId:function(){for(var m=this.items.length-1;m>=0;m--){if(!this.items[m].disabled){return this.items[m].id}}return null},getPrevId:function(o){var m,n=false;for(m=this.items.length-1;m>=0;m--){if(n){if(!this.items[m].disabled){return this.items[m].id}continue}if(this.items[m].id==o){n=true}}if(!n){return null}for(m=this.items.length-1;m>=0;m--){if(!this.items[m].disabled){return this.items[m].id}}return null},getNextId:function(q){if(q==null){return this.getFirstId()}var n,m,o=false;for(n=0,m=this.items.length;n<m;n++){if(o){if(!this.items[n].disabled){return this.items[n].id}continue}if(this.items[n].id==q){o=true}}if(!o){return null}for(n=0,m=this.items.length;n<m;n++){if(!this.items[n].disabled){return this.items[n].id}}return null},getItem:function(m){return this.items[this.elements[m]]},getElement:function(n){var m=this.getItem(n);if(m){return y5.$(m.uid)}return null},newItem:function(q){var n=this.getUid();q.uid=n;var u=q.id||n;q.id=u;if(this.elements[u]){return null}var s=a.create("div",{id:n,className:this.classNameItem});if(q.className){h.add(s,q.className)}var o=a.create("a",{href:q.href||""});if(q.html){o.innerHTML=q.html}else{o.appendChild(document.createTextNode(q.label))}s.appendChild(o);var m=this.items.push(q);this.elements[u]=m-1;this.ids[n]=u;if(q.disabled){h.add(s,"y5-w-menu-item-disabled")}return s},newSeparator:function(o){var m=this.getUid();var n=a.create("div",{id:m,className:"y5-w-menu-separator"});this.elements[o||m]=0;return n},setItemContent:function(o,n){if(o){var m=this.container.appendChild(o);this.content.push(m);if(n){this.eventsOver.push(new j("mouseover",function(q){q.preventDefault();this.selectItem(this.ids[o.id])},m,true,this))}}},setItems:function(m){this.clear();m.map(function(n){return this.newItem(n)},this).forEach(function(n){this.setItemContent(n,true)},this)},addItem:function(m){this.setItemContent(this.newItem(m),true)},addSeparator:function(m){this.setItemContent(this.newSeparator(m))},actionItem:function(s,m){for(var o=0,n=this.items.length;o<n;o++){var q=this.items[o];if(q.id==s){m.apply(this,[q,o]);break}}this.refresh()},removeItem:function(o){function m(s,q){if(this.activeItem==s.id){this.setActiveItem(this.getNextId(s.id))}this.items.splice(q,1);this.content.splice(q,1);for(var u in this.elements){if(this.elements[u]>q){this.elements[u]--}}}this.container.removeChild(this.getElement(o));var n=this.elements[o];delete this.ids[n];delete this.elements[o];this.actionItem(o,m)},disableItem:function(n){function m(o){if(this.activeItem==o.id){this.setActiveItem(this.getNextId(o.id))}h.add(this.getElement(o.id),"y5-w-menu-item-disabled");o.disabled=true}this.actionItem(n,m)},enableItem:function(n){function m(o){h.remove(this.getElement(o.id),"y5-w-menu-item-disabled");o.disabled=false}this.actionItem(n,m)},selectItem:function(m){this.setActiveItem(m);this.refresh()},selectFirstItem:function(){this.selectItem(this.getFirstId())},setCallBacksOnce:function(){["addItem","addSeparator","removeItem","disableItem","enableItem","selectItem","setItems","selectFirstItem","clear"].forEach(function(m){this.callbacks[m]=new c("y5:"+m,this[m],this.element,true,this)},this);this.Window.prototype.setCallBacksOnce.apply(this)},setEventsOnce:function(){this.events.click=new j("click",this.clickItem,this.window,true,this);this.MenuBase.prototype.setEventsOnce.apply(this)},clickItem:function(m){this.goItem(m,this.findIdByElement(m.target))},goItem:function(o,q){o.stopPropagation();o.preventDefault();var m=this.getItem(q);if(m){var n=m.listener;if(n){if(n(this,o)){this.kill()}}else{this.kill();window.location.href=m.href}}},findIdByElement:function(n){var m=d.getAncestorOrSelf(n,"*",this.classNameItem);if(m){return this.ids[m.id]}return null},setShortcutsOnce:function(){var m=document,n={checkTarget:false,context:this};this.shortcuts.enter=g.down("enter",this.keyItemEnter,m,n);this.shortcuts.home=g.down("home",this.keyItemHome,m,n);this.shortcuts.end=g.down("end",this.keyItemEnd,m,n);this.shortcuts.down=g.press(["down","tab"],this.keyItemDown,m,n);this.shortcuts.up=g.press(["up","shift+tab"],this.keyItemUp,m,n);this.MenuBase.prototype.setShortcutsOnce.apply(this)},keyItem:function(m,n){m.preventDefault();m.stopPropagation();this.selectItem(n)},keyItemEnter:function(m){this.goItem(m,this.activeItem)},keyItemDown:function(m){this.keyItem(m,this.getNextId(this.activeItem))},keyItemUp:function(m){this.keyItem(m,this.getPrevId(this.activeItem))},keyItemHome:function(m){try{this.keyItem(m,this.getFirstId())}catch(m){}},keyItemEnd:function(m){try{this.keyItem(m,this.getLastId())}catch(m){}}};e.objectExtends(y5.Widget.Menu,y5.Widget.Popup,"MenuBase");if(!y5.Widget.Templates.get(b,"default")){var l=new y5.Widget.Template(b,"Widget.Window","default");l.loadCSSModule(b)}y5.loaded(b)});var Direct={};y5.registerNamespaceByData("Direct","/js/Direct","utf-8");y5.require(["Request.XML","Utils"],function(){var b=y5.Request.XML.prototype.send,a="csrf_token";y5.Request.XML.prototype.send=function(d){var c=window.csrf_token||"";if(y5.Types.object(d)){d[a]=c}else{if(!d){this.url+=(/=/.test(this.url))?"&":"";this.url+=a+"="+c}else{d=d?d+"&":"";d+=a+"="+c}}return b.call(this,d)};y5.loaded("Direct:Request")});Direct.UserOptions=direct.UserOptions;y5.loaded("Direct:UserOptions");Direct.Utils=new function(){function a(d,b){var c=d.className.match(b);return c?c[1]:""}this.mergeComponentChildren=function(d,b,e,c){this.addOtherParentChildren(d,d.element,b,e,c)};this.addOtherParentChildren=function(g,d,b,j,c){c=c||{};for(var e in c){if(!c.hasOwnProperty(e)){continue}var h=c[e].match(/Hash-(\w+)/);if(h){c[e]=h[1];g[h[1]]={}}else{g[c[e]]=[]}}y5.Dom.getDescendants(d,j,b).forEach(function(m){var l=a(m,b);if(c[l]){if((g[c[l]] instanceof Array)){g[c[l]].push(m)}else{var n=m.className.match(/Name-(\w+)/)[1];g[c[l]][n]=m}}else{g[l]=m}})};this.bind=function(c,g){var d=[];for(var e=2,b=arguments.length;e<b;e++){d.push(arguments[e])}return function(){var j=[].concat(d);for(var m=0,h=arguments.length;m<h;m++){j.push(arguments[m])}c.apply(g,j)}};this.formatNumber=function(){return common.format.number.apply(common.format,arguments)};this.formatHref=function(){return common.format.href.apply(common.format,arguments)};this.indexize=function(e,d){var c={};if(d){for(var b=0;b<e.length;b++){c[e[b][d]]=e[b]}}else{for(var b=0;b<e.length;b++){c[e[b]]=true}}return c};this.validateHref=function(b){return b.match(/^\s*(http:\/\/)?([a-zа-я0-9-]+\.)+[a-zа-я]+(\s*$|\/|:\d+|\?|#)/i)};this.extractDomain=function(b){return y5.Strings.trim(b).replace(/http(s)?:\/\//,"").replace(/[\/\?].*/,"").replace(/\#.*/,"").replace(/\/$/,"")};this.pluralize=common.inflector.pluralize;this.pluralizeWord=common.inflector.pluralizeWord;this.observeFontSizeChange=function(c){if(this.fontSizeChangeIframe){return}var b=document.createElement("iframe"),d=b.style;b.frameBorder=0;b.src="javascript:'<body style=\\'overflow:hidden\\' onresize=\\'top.Direct.Utils.notifyFontSizeChanged()\\'>'";d.width="1em";d.position="absolute";d.left="0";d.top="0";c=c||y5.Dom.getBody();c.appendChild(b);this.fontSizeChangeIframe=b};this.notifyFontSizeChanged=function(){y5.Events.notify(":fontSizeChanged",document,true)};this.fixIEBgFlickering=function(){try{document.execCommand("BackgroundImageCache",false,true)}catch(b){}}};y5.loaded("Direct:Utils");Direct.Placeholders=function(a){this.init(a)};Direct.Placeholders.prototype=new function(){var b=[],c=[],d=false,a="position:absolute; top:0; left:3px; display:block; cursor:text; color:#999",h="position:relative; top:0; left:0; display: block;";this.init=function(n){if(e(n)){return}var q=y5.Dom.getDescendants(n,"input"),o,m,s;for(o=0;o<q.length;o++){m=q[o];if(s=m.getAttribute("placeholder")){m.setAttribute("placeholder","");l(m,s)}}};function e(m){return typeof m.placeholder=="string"}function g(){for(var n=0,m=b.length;n<m;n++){b[n]&&b[n].value&&(c[n].style.display="none")}}function j(m,n){b[b.length]=m;c[c.length]=n;y5.Events.observe("focus",function(){n.style.display="none"},m,true);y5.Events.observe("blur",function(){if(m.value==""){n.style.display="block"}},m,true);y5.Events.observe("click",function(){m.focus()},n,true);if(!d){d=true;window.setInterval(g,100)}}function l(m,v){var s=y5.Elements.create("span",{style:h}),n=y5.Elements.create("label",{"for":m.id,style:a},v),u=m.offsetWidth-m.clientWidth,q=n.style,o=y5.Elements.getStyle(m).fontSize||"";q.lineHeight=m.offsetHeight+"px";q.left=(u?u/2+1:3)+"px";q.display=m.value==""?"block":"none";q.fontFamily=y5.Elements.getPropertyValue(m,"fontFamily");q.fontSize=(o+"").match(/\d+$/)?o+"px":"";m.parentNode.insertBefore(s,m);s.appendChild(n);s.appendChild(m);j(m,n)}};y5.loaded("Direct:Placeholders");Direct.Tabs=function(a,b){this.element=a;this.options=b||{};this.init()};Direct.Tabs.prototype=new function(){this.init=function(){this.Tabs=y5.Dom.getDescendants(this.element,"li");this.selected=null;for(var b=0;b<this.Tabs.length;b++){if(y5.Classes.test(this.Tabs[b],"selected")){this.selected=this.Tabs[b]}y5.Events.observe("click",a,this.Tabs[b],true,this)}};function a(d){var c=y5.Dom.getAncestorOrSelf(d.target,"li");if(this.selected==c){return}y5.Classes.add(c,"selected");if(this.selected){y5.Classes.remove(this.selected,"selected")}this.selected=c;for(var b=0;b<this.Tabs.length;b++){if(this.Tabs[b]==c){break}}y5.Events.notify(":TabSelect",this.element,true,{index:b,value:this.selected.getAttribute("value")})}};y5.loaded("Direct:Tabs");Direct.packed=true;Direct.Transfer=function(a,b){this.element=a;this.options=b||{};this.init()};Direct.Transfer.prototype=new function(){this.init=function(){if(y5.is_ie7down){b(true)}Direct.Utils.mergeComponentChildren(this,/Transfer-(\w+)/,"*");this.to=new Direct.Transfer.To(this.To,this.options);this.from=new Direct.Transfer.From(this.From,this.options);y5.Events.observe(":TabSelect",function(g){y5.Classes.assign(this.element,"b-money-transfer_1line",g.value=="1line");y5.Classes.assign(this.element,"b-money-transfer_2lines",g.value!="1line");Direct.UserOptions.set("show_wide_money_transfer",g.value=="1line"?"true":"false")},this.Mode,true,this);y5.Events.observe("submit",function(g){if(!a.call(this)){g.preventDefault();return false}this.from.fillHiddens();return true},this.Form,true,this);y5.Events.observe("Direct:totalChanged",d,"Transfer-From",true,this)};function b(e){try{document.execCommand("BackgroundImageCache",false,e)}catch(g){}}function d(){var e=c.call(this);this.to.assignErrors(e)}function c(){var m=this.from.getUsedCampaigns(),h=this.to.getAll(),e=null,j={},l={};if(m.length==0){}else{for(var g=0;g<m.length;g++){l[m[g].cid]=iget("Невозможно перенести средства с кампании № %s на нее же.",m[g].cid)}}return l}function a(){var l=this.from.getUsedCampaigns();if(l.length==0){alert(iget("Ошибка: Выберите кампании, с которых хотите перенести средства."));return false}if(!this.to.getCid()){alert(iget("Ошибка: Выберите кампанию, на которую хотите перенести средства."));return false}for(var h=0;h<l.length;h++){if(l[h].cid==this.to.getCid()){alert(iget("Ошибка: Невозможно перенести средства с кампании № %s на нее же.",this.to.getCid()));if(!l[h].ammountNode.disabled){l[h].ammountNode.focus()}return false}}for(var h=0;h<l.length;h++){var j=this.from.getAmmount(l[h].cid);if(j<10&&j!=l[h].available){alert(iget("Ошибка: Перевод с кампании № %s возможен на сумму не менее %s у.е.",l[h].cid,10));l[h].ammountNode.focus();return false}if((l[h].remaining-j)<10&&(l[h].remaining-j)>0){alert("Ошибка: Остаток средств на кампании № %s не может быть меньше %s у.е.",l[h].cid,10);l[h].ammountNode.focus();return false}}var m=this.options.campaignInfo[this.to.getCid()].AgencyID*1;for(var h=0;h<l.length;h++){var g=this.options.campaignInfo[l[h].cid].AgencyID*1;if(g!=m){if(g&&m){alert(iget("Кампании № %s и № %s принадлежат разным агентствам. Перенос средств возможен только на кампанию того же агентства.",l[h].cid,this.to.getCid()))}else{if(!m){alert(iget("Перенос с кампании № %s на № %s невозможен. Перенести средства с этой кампании можно только на кампанию того же агентства.",l[h].cid,this.to.getCid()))}else{alert(iget("Перенос с кампании № %s на № %s невозможен. Перенести средства на эту кампанию возможно только с кампании того же агентства.",l[h].cid,this.to.getCid()))}}return false}}var e=this.to.getMinServSum(this.to.getCid());if(this.from.getTotal()<e){alert(iget("Ошибка: Кампания № %s находится на тарифе «Беззаботный». На неё можно перенести сумму не менее %s у.е.",this.to.getCid(),Direct.Utils.formatNumber(e,2,"")));return false}return true}};if(Direct.packed){y5.loaded("Direct:Transfer")}else{y5.require(["Direct:Transfer.To","Direct:Transfer.From"],function(){y5.loaded("Direct:Transfer")})}Direct.Transfer.From=function(a,b){this.element=a;this.options=b||{};this.init()};Direct.Transfer.From.prototype=new function(){this.init=function(){Direct.Utils.mergeComponentChildren(this,/Transfer-From-(\S+)/,"*",{Row:"Rows",Cid:"Cids",Remaining:"Remaining",Available:"Available",Ammount:"Ammounts",HiddenAmmount:"HiddenAmmounts",SelectAll:"SelectAlls"});a.call(this);h.call(this);c.call(this);g.call(this)};this.selectAll=function(l){var j=this.map[l];if(j.selectAll.checked){j.originalValue=j.ammountNode.value;j.originalDisabled=j.ammountNode.disabled;j.ammountNode.value=Direct.Utils.formatNumber(j.available,2,"");j.ammountNode.disabled=true}else{j.ammountNode.value=j.originalValue;j.ammountNode.disabled=j.originalDisabled}g.call(this)};this.fillHiddens=function(){for(var j=0;j<this.campaigns.length;j++){this.campaigns[j].hiddenAmmount.value=this.campaigns[j].ammountNode.value}};this.getUsedCampaigns=function(){var l=[];for(var j=0;j<this.campaigns.length;j++){if(this.getAmmount(this.campaigns[j].cid)>0){l.push(this.campaigns[j])}}return l};this.getTotal=function(){var l=0;for(var j=0,m=this.getUsedCampaigns();j<m.length;j++){l+=this.getAmmount(m[j].cid)}return l};this.getAmmount=function(j){return this.map[j].ammountNode.value.replace(/[,бю]/i,".").replace(/\s/g,"")*1||0};function g(){var j=this.getTotal();this.Total.innerHTML=Direct.Utils.formatNumber(j,2,"&nbsp;");this.Clear.style.visibility=j?"visible":"hidden";y5.Events.notify("Direct:totalChanged","Transfer-From",true,{total:j,from:this})}function e(m){var j=this.map[m],l=this.getAmmount(m);if(j.available<l){j.ammountNode.value=Direct.Utils.formatNumber(j.available,2,"")}if(!j.ammountNode.value){j.ammountNode.value="0"}g.call(this)}function c(){y5.Events.observe("click",function(){for(var j=0;j<this.campaigns.length;j++){if(this.campaigns[j].selectAll.checked){this.campaigns[j].ammountNode.disabled=this.campaigns[j].originalDisabled;this.campaigns[j].selectAll.checked=false}this.campaigns[j].ammountNode.value=0}g.call(this)},this.Clear,true,this)}function b(j){if(this.getAmmount(j)==0){this.map[j].ammountNode.value=""}}function h(){for(var j=0;j<this.campaigns.length;j++){y5.Events.observe("click",Direct.Utils.bind(this.selectAll,this,this.campaigns[j].cid),this.campaigns[j].selectAll,true,this);y5.Events.observe("blur",Direct.Utils.bind(e,this,this.campaigns[j].cid),this.campaigns[j].ammountNode,true,this);y5.Events.observe("focus",Direct.Utils.bind(b,this,this.campaigns[j].cid),this.campaigns[j].ammountNode,true,this)}}function a(){this.campaigns=[];this.map={};for(var l=0;l<this.Rows.length;l++){var j=d(this.Available[l]),m=d(this.Remaining[l]),o=y5.Strings.strip(this.Cids[l].innerHTML),n={row:this.Rows[l],cidNode:this.Cids[l],ammountNode:this.Ammounts[l],hiddenAmmount:this.HiddenAmmounts[l],available:j,remaining:m,cid:o,selectAll:this.SelectAlls[l]};this.campaigns.push(n);this.map[o]=n}}function d(j){var l=j.innerHTML.replace(",",".").replace(/&nbsp;/g," ").replace(/\s/g,"").match(/\d+(\.\d+)?/);return l?parseFloat(l[0]):0}};y5.loaded("Direct:Transfer.From");Direct.Transfer.To=function(a,b){this.element=a;this.options=b||{};this.init()};Direct.Transfer.To.prototype=new function(){this.init=function(){Direct.Utils.mergeComponentChildren(this,/Transfer-To-(\S+)/,"*",{Campaign:"Campaigns",Row:"Rows",Name:"Names",Cid:"Cids"});a.call(this)};this.getAll=function(){return this.campaigns};this.getCid=function(){return this.Hidden.value};this.getCampByCid=function(d){return this.map[d]};this.getMinServSum=function(e){var d=(this.options.campaignInfo||{})[e]||{};return d.minServSum||0};this.assignErrors=function(g){for(var e=0;e<this.campaigns.length;e++){var d=this.campaigns[e];y5.Classes.assign(d.row,"b-money-transfer__disabled-row",g[d.cid]);if(g[d.cid]&&y5.Classes.test(d.row,"b-money-transfer__selected-row")){this.select(null)}d.row.setAttribute("title",g[d.cid]||"")}};this.select=function(e){var d=this.map[this.Hidden.value];if(d){y5.Classes.remove(d.row,"b-money-transfer__selected-row")}this.Hidden.value=e;b.call(this,e);d=this.map[this.Hidden.value];if(d){y5.Classes.add(d.row,"b-money-transfer__selected-row")}this.camp=d};function c(e){var d=this.map[e];if(y5.Classes.test(d.row,"b-money-transfer__disabled-row")){return}this.select(e)}function b(e){var d=(this.options.campaignInfo||{})[e];if(d){this.Remaining.innerHTML=d.remaining||"-";this.TargetName.innerHTML="&#x2116;&nbsp;"+e+" "+d.name||"-"}this.Campinfo.style.visibility=d?"visible":"hidden"}function a(){this.map={};this.campaigns=[];for(var d=0;d<this.Campaigns.length;d++){var g=y5.Strings.strip(this.Cids[d].innerHTML),e={name:this.Names[d],cidNode:this.Cids[d],cid:g,node:this.Campaigns[d],row:this.Rows[d]};this.campaigns.push(e);this.map[g]=e;y5.Events.observe("click",Direct.Utils.bind(c,this,g),this.Campaigns[d],true,this)}}};y5.loaded("Direct:Transfer.To")}(function(b,a){a.block["b-grid-table"]=function(g){var d=b(this),c=d.attr("class").match(/b-grid-table_(\d+)/),e=c?c[1]*1:200;b(".b-grid-table-body").each(function(){if(b("table",this).height()<e){b(this).addClass("b-grid-table-body_noscroll")}else{if(b.browser.safari||b.browser.msie||(b.browser.opera&&b.browser.version<9.3)){b(this).css("padding-right","20px")}if(navigator.userAgent.indexOf("Chrome")!=-1){b(this).css("padding-right","1px")}if(b.browser.msie){b(this).css("height",e+"px")}if(b.browser.msie&&b.browser.version<7){d.css("margin-right","-20px")}}})}})(jQuery,window.Lego);(function(c,a){var b=a.block["b-list-table"]=function(){};b.initDescriptions=function(g){var n=c(g).closest(".b-list-table"),v=n.find(".b-list-table__desc"),s=n.find(".b-list-table__textarea"),l=n.find(".b-window").eq(0),d=l.find(".b-window__button_type_save"),h=l.find(".b-window__button_type_close"),q=d.add(h).add(s),o=n.find(".b-list-table__descdata").get(0).onclick(),z=null,e=false,m=l.data("api");if(m){u()}else{n.one("b-window_api_ready",u)}function u(){m=l.data("api");v.bind("click",A);h.bind("click",function(){m.close()});d.bind("click",w);l.bind("b-window_close",function(B){if(e){B.preventDefault()}else{z=null}});c(o.container).bind("search_start",function(){m.close()})}function A(){var B=c(this);if(!B.data("params")){B.data("params",this.onclick())}m.attach(this,"left bottom",false,true);z==this?m.close():y(this)}function y(B){z=B;s.val(c(B).data("params").text||"");m.show()}function w(){var C=c(z).data("params"),D=s.val(),B={cmd:o.cmd,description:D};if(D===C.text){m.close();return true}e=true;x(true);B[C.idfield||"id"]=C.id;if(o.ulogin){B.ulogin=o.ulogin}if(o.agencyClientList){B.agency_client_list=o.agencyClientList}if(o.agencyLogin){B.agency_login=o.agencyLogin}c.ajax({method:"post",dataType:"text",url:"/registered/main.pl",data:B,success:function(F){if(F!="1"){return j()}x(false);e=false;var G=c(z).data("params");G.text=D;c(z).data("params",G).toggleClass("disabled",!/\S/.test(D));if(o.model){var E=o.model.items[v.index(z)];if(E){E.setDescription(D)}}m.close()},error:j})}function j(){x(false);e=false;window.alert(iget("Ошибка при сохранении примечаний. Попробуйте еще раз."))}function x(B){q[B?"attr":"removeAttr"]("disabled",true)}};b.initMassActions=function(o,l){var e=c(o).closest(".b-list-table").find(".b-list-table__mass").eq(0),h=e.find("input"),v=e.find("select"),m=[],n=(e.size()>0&&e.get(0).onclick)?e.get(0).onclick():{},l=c.extend({notifyItemsWithoutAction:function(x,y){return true},checkBeforeSubmit:function(x,y){return true},notifyTooManyActions:function(x){return true},submitForm:function(x,y,z){}},l||{});if(!n.list){return true}c(n.list).bind("selection_change",u);h.bind("click",q);w(true);u(c.Event("selection_change"),c(n.list).data("Selectors.Selected")||[]);function w(x){h.add(v)[x?"attr":"removeAttr"]("disabled","disabled");e.toggleClass("b-list-table__mass_type_disabled",x)}function j(x){return n.actionsInfo[x].actions}function g(x){return n.actionNames[x]||"?"}function q(){var B=[],A=[],C,x=v.val();for(var z=0,y=m.length;z<y;z++){C=j(m[z]);(c.inArray(x,C)>-1?B:A).push(m[z])}if(B.length>0){if(A.length&&!l.notifyItemsWithoutAction(A,n)){return}if(!l.notifyTooManyActions(B)){return}if(!l.checkBeforeSubmit(x,B)){return}l.submitForm(x,B,n)}}function d(z){var B={},C=[],A;for(var y=0;y<z.length;y++){A=j(z[y]);for(var x=0;x<A.length;x++){if(!B[A[x]]){B[A[x]]=true;C.push(A[x])}}}return C}function u(A,x){var z=s(x),B=d(z);v.html("");for(var y=0;y<B.length;y++){v.append(c("<option/>").attr("value",B[y]).html(g(B[y],n)))}if(!B.length){v.append(c("<option/>").html(n.emptyText||"-----"))}w(!B.length);m=z}function s(x){if(x.selected){m=c.grep(m,function(y){if(y>=x.indexes[0]&&y<=x.indexes[x.indexes.length-1]){return false}return true});m=m.concat(x.selected)}else{m=x}return m}};b.fixWidths=function(h){var e=c("tr:eq(0) td",h),g=h[0].offsetWidth,d=e.map(function(){return !c.support.boxModel?this.offsetWidth+"px":this.offsetWidth/g*100+"%"});if(h.css("tableLayout")!="fixed"){h.css("width",g+"px");h.addClass("b-list-table_fixed");e.each(function(j){this.style.width=d[j]})}};b.getHltBlocks=function(d,g,e){if(!d[e]){d[e]=c(".hlt",g)}return d[e]};b.getOriginalValues=function(e,h,g){if(!h.data("highlight.original")){var d=this.getHltBlocks(e,h,g);h.data("highlight.original",d.map(function(){return this.innerHTML}))}return h.data("highlight.original")}})(jQuery,window.Lego);(function(c,a){var d=common.format,b=a.block["b-list-table"];a.block["b-campaign-list"]=function(h){var q=c(this),m=h.model,s=h.input,w=c(".b-campaign-list__searchable",this),o="",n=[],u=false,g=false,v={notifyItemsWithoutAction:function(z,B){var C=[],x;for(var y=0;y<z.length;y++){x=B.actionsInfo[z[y]];C[y]=x.name+" ("+String.fromCharCode(8470)+" "+x.cid+")"}var A=iget("Выбранное действие недоступно для кампаний: ")+C.join(", ")+"\n"+iget("Продолжить?");return confirm(A)},checkBeforeSubmit:function(x,y){if(x=="delCamp"&&!confirm(iget("Вы уверены, что хотите удалить выбранные кампании?"))){return false}if(x=="resumeContext"&&!confirm(iget("В указанных кампаниях в ближайшее время будут восстановлены показы на тематических площадках по фразам, отключенным за низкий CTR."))){return false}return true},submitForm:function(x,B,C){function z(D,E){c("<input/>").attr({name:D,value:E,type:"hidden"}).appendTo(y)}var y=c("<form/>").attr({action:location.href.replace(/\?.*/,""),method:x=="showCampStat"?"get":"post"});z("cmd",x);for(var A=0;A<B.length;A++){z("cid",C.actionsInfo[B[A]].cid)}if(x=="showCampStat"){z("stat_type","campdate")}if(C.ulogin){z("ulogin",C.ulogin)}if(window.csrf_token){z("csrf_token",window.csrf_token)}y.appendTo("body").submit()}};b.initDescriptions(this);b.initMassActions(this,v);m.chunkSize=10;m.chunkTimeout=42;setTimeout(function(){b.fixWidths(q);l()},42);m.bind("search.found",function(y,x){var z=w.eq(x.iteration);z.show();if(x.empty||x.visible.length<100){c(".pos",z).html(x.visible.length);j(z,x)}else{z.hide()}});m.bind("search.missed",function(y,x){var z=w.eq(x.iteration);z.hide()});m.bind("search.start",function(x){x.regexp=new RegExp("("+x.query.text.replace(/(.)/g,"[$1]")+")","i");x.empty=!x.query.text.match(/\S/);c(h.eventTarget).trigger("search_start")});m.bind("search.finish",function(x){c(h.eventTarget).trigger("search_finish",[x])});s.bind("keyup",function(){l()});function l(){var x={text:s.val(),onlyFavorites:u,onlyManagerFavorites:g};if(x.text==o.text&&x.onlyFavorites==o.onlyFavorites&&x.onlyManagerFavorites==o.onlyManagerFavorites){return}o=x;m.search(x)}function j(B,z){var x=m.items[z.iteration].description.toLowerCase(),A=b.getOriginalValues(n,B,z.iteration),y=z.query.text!=""&&x.indexOf(z.query.text)!=-1;b.getHltBlocks(n,B,z.iteration).each(function(C){var D=A[C].replace(z.regexp,'<span class="hlted">$1</span>');if(this.innerHTML!=D){this.innerHTML=D}});c(".description",B)[y?"addClass":"removeClass"]("hlted")}if(window.y5){if(h.favorites){y5.Events.observe(":TabSelect",function(x){u=x.value=="favorites";if(h.shouldSaveFavorites){Direct.UserOptions.set("show_favorite_campaigns_only",u)}l();e()},h.favorites,true);u=y5.Dom.getDescendant(h.favorites,"li","selected").getAttribute("value")=="favorites"}if(h.managerFavorites){y5.Events.observe(":TabSelect",function(x){g=x.value=="favorites";Direct.UserOptions.set("show_my_campaigns_only",g);l();e()},h.managerFavorites,true);g=y5.Dom.getDescendant(h.managerFavorites,"li","selected").getAttribute("value")=="favorites"}function e(){if(h.allCampaignStatLink){var x=new y5.URL(h.allCampaignStatLink.href);if(u){x.addParam("show_favorites",1)}else{x.removeParams(["show_favorites"])}if(g){x.addParam("show_for_manager",1)}else{x.removeParams(["show_for_manager"])}h.allCampaignStatLink.href=x.toString()}}}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-list__selectors"]=function(d){var l=b(this),j=d.model,e=d.indexes,m=b(d.eventTarget),n=d.mainInput||b(".b-cl__selectors__main",l),c=b(".b-cl__selectors__checkbox",l),h={};b.each(e,function(q,o){h[o]=true});n.click(function(){for(var o=0;o<e.length;o++){if(h[e[o]]){c[o].checked=this.checked}}g()});c.click(function(){var o=true,q=false;c.each(function(u,s){if(h[e[u]]){if(!s.checked){o=false;return false}q=true}});n.attr("checked",o&&q);g()});function g(){var q=[],o={};b.each(e,function(w,u){if(h[u]&&c[w].checked){q.push(u);o[u]=true}});var s={selectedMap:o,selected:q,indexes:e};m.triggerHandler("selection_change",[s])}m.bind("search_start",function(o,q){n.attr("disabled",true)});m.bind("search_finish",function(o,q){n.attr("disabled",false);h=q.visibleMap;c.eq(0).triggerHandler("click")})}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-list__total"]=function(e){var j=b(this),h=e.model,g=e.indexes,l=b(e.eventTarget),o=b(".b-list-table__empty",j),n=b([]);if(e.hideOnEmpty){var d=j.prevAll(".b-campaign-list__total__hide-until:eq(0)");while(d[0]!=j[0]){n.push(d[0]);d=d.next()}n.push(j[0])}var m=common.format;l.bind("search_finish",function(s,q){c(h.getTotals(g,q.visibleMap));var u=b.grep(g,function(w){return q.visibleMap[w]});if(e.hideOnEmpty){n[u.length?"show":"hide"]()}o[u.length?"hide":"show"]()});function c(q){b(".total_shows",j).html(m.number(q.shows,0," "));b(".total_shows_left",j).html(m.number(q.showsLeft,0," "));b(".total_clicks",j).html(m.number(q.clicks,0," "));b(".total_sum",j).html(m.number(q.sum,2," "));b(".total_sum_rest",j).html(m.number(q.sumRest,2," "))}c(h.getTotals(g))}})(jQuery,window.Lego);(function(c,a){var d=common.format,b=a.block["b-list-table"];a.block["b-client-list"]=function(h){var s=c(this),n=h.list,u=h.input,x=[],q="",m=[],w={notifyItemsWithoutAction:function(B,E){var y=[],C;for(var A=0,z=B.length;A<z;A++){C=E.actionsInfo[B[A]];y[A]=C.login}var D=iget("Выбранное действие недоступно для клиентов: ")+y.join(", ")+"\n"+iget("Продолжить?");return confirm(D)},notifyTooManyActions:function(y){if(y.length>100){alert(iget("Нельзя выполнить действие более чем со 100 клиентами."));return false}return true},submitForm:function(y,D,E){function B(F,G){c("<input/>").attr({name:F,value:G,type:"hidden"}).appendTo(z)}var z=c("<form/>").attr({action:location.href.replace(/\?.*/,""),method:"get"});B("cmd",y);for(var C=0,A=D.length;C<A;C++){B("client_login",E.actionsInfo[D[C]].login)}if(E.ulogin){B("ulogin",E.ulogin)}if(y=="showSubClientCamps"){B("stat_type","by_agency_clients")}if(y=="showCampStat"){B("stat_type",E.statType)}if(y=="archiveUser"||y=="unArchiveUser"){B("cl_cnt",E.actionsInfo.length-D.length);if(window.Direct_cmd){B("rcmd",window.Direct_cmd)}if(E.agencyClientList){B("agency_client_list",E.agencyClientList)}}if(window.csrf_token){B("csrf_token",window.csrf_token)}z.appendTo("body").submit()}},g=s.find(".b-client-list__selectors");b.initDescriptions(this);b.initMassActions(this,w);c("tbody tr",this).each(function(){if(this.className.indexOf("b-client-list__child")!=-1){x[x.length-1].children.push(this)}else{if(this.className.indexOf("b-client-list__separator")!=-1){x[x.length-1].group.push(this)}else{c(this).data("client-list",x[x.length]={node:c(this),children:[],group:[this],rowspan:c(".b-client-list__rowspan",this),toggle:c(".b-client-list__togle-children",this),index:x.length,description:c(".description",this),pos:c(".pos",this)})}}});n.chunkSize=10;n.chunkTimeout=42;setTimeout(function(){b.fixWidths(s)},42);c(".b-client-list__togle-children",s).bind("click",function(){var z=c(this).closest("tr"),y=z.data("client-list");if(y.children[0].style.display=="none"){c(y.children).show();this.src="/i/hide.gif";y.rowspan.attr("rowspan",y.children.length+1);s.removeClass("b-list-table_fixed")}else{c(y.children).hide();this.src="/i/show.gif";y.rowspan.attr("rowspan",1)}});n.bind("search.found",function(z,y){var A=x[y.iteration];y.visible.push(y.iteration);if(y.empty||y.visible.length<100){v(A);A.toggle.attr("src","/i/show.gif");A.rowspan.attr("rowspan",1);A.pos.html(y.visible.length);j(A,y)}else{o(A)}});n.bind("search.missed",function(z,y){o(x[y.iteration])});n.bind("search.start",function(y){y.regexp=new RegExp("("+y.query.text.replace(/(.)/g,"[$1]")+")","i");y.visible=[];y.empty=!y.query.text.match(/\S/);if(!y.empty){s.addClass("b-list-table_fixed")}c(h.eventTarget).triggerHandler("search_start")});n.bind("search.finish",function(y){c(".b-list-table__empty",s)[y.visible.length>0?"hide":"show"]();c(h.eventTarget).triggerHandler("search_finish",[y])});u.bind("keyup",function(){l()});g.size()&&(function(){var y=s.find(".b-client-list__selectors__main"),E=s.find(".b-client-list__selectors__ch"),D=g.get(0).onclick(),F=[],B=[];function z(){var G=F.length>0,I=[];for(var H=0;H<F.length;H++){if(E.eq(F[H]).size()==0){continue}if(!E.eq(F[H]).attr("checked")){G=false}else{I.push(F[H])}}y[G?"attr":"removeAttr"]("checked","checked");C(I)}function C(G){c(D.list).data("Selectors.Selected",G).triggerHandler("selection_change",[G])}y.bind("click",function(){var H=!!this.checked;for(var G=0;G<F.length;G++){(E.eq(F[G]))[H?"attr":"removeAttr"]("checked","checked")}C(H?F:[])});E.bind("click",z);for(var A=0;A<E.size();A++){if(E.eq(A).closest("tr").css("display")!="none"){F.push(A)}if(E.eq(A).attr("checked")){B.push(A)}}c(D.list).bind("search_start",function(){y.attr("disabled","disabled")}).bind("search_finish",function(H,G){y.removeAttr("disabled");F=G.visible;z()});C(B)})();function v(z){for(var y=0;y<z.group.length;y++){z.group[y].style.display=""}for(var y=0;y<z.children.length;y++){z.children[y].style.display="none"}}function o(A){var y=A.group.concat(A.children);for(var z=0;z<y.length;z++){y[z].style.display="none"}}function l(){var y={text:u.val()};if(y.text==q.text){return}q=y;n.search(y)}function j(C,A){var B=C.node,y=n.items[A.iteration].description.toLowerCase(),z=A.query.text!=""&&y.indexOf(A.query.text)!=-1;e(C.node,A);C.toggle[!A.empty&&!A.matchedParent?"addClass":"removeClass"]("hlted");C.description[z?"addClass":"removeClass"]("hlted")}function e(A,y){var z=b.getOriginalValues(m,A,y.iteration);b.getHltBlocks(m,A,y.iteration).each(function(B){var C=z[B].replace(y.regexp,'<span class="hlted">$1</span>');if(this.innerHTML!=C){this.innerHTML=C}})}}})(jQuery,window.Lego);(function(c,a){var d="show_extended_client_info",b="b-client-list_truncated";a.block["b-client-list__toggle"]=function(){var g=c(this).parents("table").eq(0);function h(j,l){c(this).html(j?'&larr;&nbsp;<span class="b-pseudo-link"><span>'+iget("метрика")+"</span></span></span>":'<span class="b-pseudo-link"><span>'+iget("метрика")+"</span></span></span>&nbsp;&rarr;");g[j?"removeClass":"addClass"](b);if(!l){direct.UserOptions.set(d,j?"true":"false")}if(j){g.removeClass("b-list-table_fixed")}if(c.browser.msie){e(g)}}function e(j){var l=c("<tr></tr>");j.append(l);l.remove()}h.call(this,Direct.UserOptions.get(d)=="true",true);c(this).click(function(){var j=g.hasClass(b);h.call(this,j)})}})(jQuery,window.Lego);(function(b,a){a.block["b-pay-form_bucks"]=function(s){var n=b(this),A=b(".b-pay-form__money-input:eq(0)",n),l=b(".b-pay-form__money-input:eq(1)",n),e=b(".b-pay-form__money-label:eq(0)",n),g=b(".b-pay-form__money-label:eq(1)",n),y=b(".b-pay-form__money-label-value",e),j=b(".b-pay-form__money-label-value",g),o=b(".b-pay-form__currency"),q=o.val(),x=b(".b-pay-form__value",n),d=n.closest("form"),c="",u="",m=s.convRate||30;A.bind("keyup keypress change blur",function(){if(c==this.value){return}c=this.value;var B=common.parse.number(this.value),C=isNaN(B)?"":B,h=isNaN(B)?"":common.format.number(B*m,2);l.attr("value",h);j.html(h);y.html(this.value);u=h;w(A);w(l);x.attr("value",C)});A.bind("blur",function(){var h=common.parse.number(this.value);if(isNaN(h)){return}c=common.format.number(h,2);A.attr("value",c)});e.bind("click focus",function(){e.hide();A.show();l.hide();g.show();A.focus();o.val(q)});l.bind("keyup keypress change blur",function(){if(u==this.value){return}u=this.value;var h=common.parse.number(this.value),C=isNaN(h)?"":common.format.number(h/m,6),B=isNaN(h)?"":common.format.number(h/m,2);A.attr("value",B);j.html(this.value);y.html(B);c=B;w(A);w(l);x.attr("value",C)});l.bind("blur",function(){var h=common.parse.number(this.value);if(isNaN(h)){return}u=common.format.number(h,2);l.attr("value",u)});g.bind("click focus",function(){g.hide();l.show();A.hide();e.show();l.focus();o.val(s.currencyId)});d.bind("submit",function(){var B=common.parse.number(A.val()),h=common.parse.number(x.val()),C=false;if(!h||isNaN(h)){z(l);C=true}if(!B||isNaN(B)){z(A);C=true}if(C){alert(iget("Неправильно указана сумма к оплате."));return false}if(b("id_payment_coupon").length&&!validate_coupon()){alert(iget("Неверный промо-код"));b("id_payment_coupon").focus();return false}return true});function z(h){if(b(h).is(":visible")){b(h).parent().append(b('<div class="err-bg"></div>'))}}function w(h){b(h).parent().find(".err-bg").remove()}var v=e.closest("td")[0].offsetHeight;g.closest("td").css("height",v+"px");e.closest("td").css("height",v+"px");A.change();A.focus()}})(jQuery,window.Lego);(function(b,a){a.block["b-pay-form_shows"]=function(m){var j=b(this),d=b("input[type=text]",j),g=b(".b-pay-form_shows-price",j),e=b(".b-pay-form_shows-total",j),c=b("input[type=submit]",j),l=m.convRate*1||750,h=m.nds*1||0.2;d.bind("keyup keypress change blur",function(){var q=common.parse.number(this.value),n=isNaN(q)?"0":common.format.number(q*l,0),o=isNaN(q)?"0":common.format.number(q*l*(1+h),0);g.html(n);e.html(o)});d.change()}})(jQuery,window.Lego);(function($,Lego){Lego.block["b-xls-form"]=function(params){var $this=$(this),fileForm=$("form:eq(0)",$this),optionsForm=$("form:eq(1)",$this),file=$("input[type=file]",fileForm),submitFile=$("input[type=button]",fileForm),gid=1,cidInput=$("input[name=cid]",optionsForm),cidSelect=$("select[name=cid]",optionsForm),cancel=$(".b-xls-form__cancel",fileForm),geo_errors=[],other_errors=[],regionInput=$(".b-xls-form__table-region input",optionsForm);setDisabled(true);setLoaded(false);$(".b-xls-form__region",optionsForm).hide();regionInput.attr("checked",false);submitFile.click(function(){if(!$(file).val()){showErrors([Lego.message("b-xls-form:empty_file",iget("Выберите файл"))]);return}hideErrors();setDisabled(true);setLoading(true);fileForm.attr("target",createIframe());fileForm.submit()});cancel.click(function(){setDisabled(true);setLoading(false);setLoaded(false);hideErrors()});var disableWrongCidParam=function(){cidInput.attr("disabled",!$(".b-xls-form__target input[value=old]").attr("checked"));cidSelect.attr("disabled",!$(".b-xls-form__target input[value=other]").attr("checked"))};optionsForm.submit(function(){if(regionInput.attr("checked")&&!confirm(Lego.message("b-xls-form:confirm_geo",iget("Выбран ЕДИНЫЙ регион для всех импортируемых объявлений. Вы уверены, что хотите игнорировать настройки региона из XLS файла ?")))){return false}disableWrongCidParam();$("input[name=geo]",optionsForm).attr("disabled",!regionInput.attr("checked"));return true});!$(".b-xls-form__target input[name=destination_camp]").change(disableWrongCidParam);regionInput.click(function(){if(!geo_errors.length){setDisabled(false);hideErrors()}else{setDisabled(!this.checked,["target"]);$(".b-xls-form__errors__ul")[this.checked?"addClass":"removeClass"]("b-xls-form__errors-disabled")}$(".b-xls-form__region",optionsForm)[this.checked?"show":"hide"]();$(".b-xls-form__informer",optionsForm)[this.checked?"show":"hide"]()});function createIframe(){var target="upl_frame_"+(gid++),iframe=$('<iframe src="javascript:void(0)" name="'+target+'" width="0" height="0" style="display:none;"></iframe>');hideErrors();$this.append(iframe);iframe.bind("load",function(){fileLoaded(iframe)});return target}function fileLoaded(iframe){var str=iframe[0].contentWindow.document.body.innerHTML,data=eval("("+str+")");setLoading(false);geo_errors=data.geo_errors;other_errors=data.errors;if(data.errors.length){showErrors(data.errors.concat(data.geo_errors));setLoaded(true);$(".b-xls-form__errors__ul").removeClass("b-xls-form__errors-disabled");$("input[name=svars_name]",optionsForm).val("")}else{if(geo_errors.length){showErrors(data.errors.concat(data.geo_errors));setLoaded(true);setDisabled(false,["region"]);regionInput.triggerHandler("click");$("input[name=svars_name]",optionsForm).val(data.svars_name)}else{setLoaded(true);setDisabled(false);$("button[type=submit]",optionsForm).attr("disabled",data.svars_name);$("input[name=svars_name]",optionsForm).attr("value",data.svars_name)}}$(".b-xls-form__target input[value="+(data.cid?"old":"new")+"]").attr("checked",true);$(".b-xls-form__already-imported",optionsForm)[data.elder_loads&&data.cid?"show":"hide"]();$(".b-xls-form__target:eq(0)",optionsForm)[data.cid?"show":"hide"]();if(data.cid){$(".b-xls-form__target-camp",optionsForm).html("\u2116&nbsp;"+data.cid+(data.camp_name?"&nbsp;"+$("<div/>").text(data.camp_name).html():""));cidInput.val(data.cid)}disableWrongCidParam()}function setLoaded(state){file.attr("disabled",state);file[state?"hide":"show"]();submitFile[state?"hide":"show"]();cancel[state?"removeClass":"addClass"]("hidden");var message=$(".b-xls-form__loaded",fileForm);message[state?"removeClass":"addClass"]("hidden");if(state){message.html(file.val().replace(/.*[\/\\]/,""))}}function hideErrors(){$(".b-xls-form__errors__ul",$this).hide()}function showErrors(errors){$(".b-xls-form__errors__ul",$this).show();$(".b-xls-form__errors__ul",$this).html($.map(errors,function(e){return'<li class="b-xls-form__errors__li">'+$("<div/>").text(e).html()+"</li>"}).join(""))}function setDisabled(state,target){target=target||["region","target"];$.each(target,function(){$(".b-xls-form__table-"+this,optionsForm)[state?"addClass":"removeClass"]("b-xls-form__form_disabled");$(".b-xls-form__table-"+this+" input",optionsForm).attr("disabled",state);$(".b-xls-form__table-"+this+" select",optionsForm).attr("disabled",state)})}function setLoading(state){$(".b-xls-form__loading",fileForm)[state?"removeClass":"addClass"]("hidden");cancel[state?"removeClass":"addClass"]("hidden");file[state?"hide":"show"]();submitFile[state?"hide":"show"]()}}})(jQuery,window.Lego);(function(b,a){a.block["b-window"]=function(d){var h=b(this),c,e,n,q=false;var g={attach:function(s,v,w,u){if(c){g.detach()}if(!c){b(window).bind("resize",function(){if(q){return}q=true;setTimeout(function(){q=false;l()},5)})}c=b(s);e=v||"right bottom";n=w;if(!u){setTimeout(function(){g.show();l()},1)}},popup:function(){b(window).bind("resize",function(){if(q){return}q=true;setTimeout(function(){q=false;j()},5)});if(b.browser.msie){b(window).bind("scroll.window",function(){j()})}g.show();j()},attachment:function(){return c&&c[0]},detach:function(){c=null;h.trigger("b-window_detach");b(window).unbind(".window");b(window).unbind("resize",l)},close:function(){var s=b.Event("b-window_close");h.trigger(s);if(!s.isDefaultPrevented()){h.css("display","none")}},submit:function(){var u=b.Event("b-window_submit"),s;if(b.isFunction(g.submitData)){s=g.submitData()}h.trigger(u,s);if(!u.isDefaultPrevented()){h.css("display","none")}},show:function(){h.trigger("b-window_open");h.css("display","");if(c){l()}},visible:function(){return h.is(":visible")}};g.open=g.show;h.data("api",g).trigger("b-window_api_ready");h.find(".b-window__close, .b-window__cancel").click(function(){g.close()});h.find(".b-window__submit").click(function(){g.submit()});b(document).bind("b-window_close-all",function(s){g.close()});b(document).bind("click",function(s){if(n&&g.visible()&&s.target!=h[0]&&b(s.target).parents(".b-window")[0]!=h[0]){g.close()}});function j(){var s={};s.left=(b(window).width()/2)-(h.width()/2);if(b.browser.msie){s.top=(b(window).height()/2)-(h.height()/2)+b(document).scrollTop()}else{s.top=(b(window).height()/2)-(h.height()/2);s.position="fixed"}o(s);h.css(s)}function o(s){s.top=(s.top>0)?s.top:0;s.left=(s.left>0)?s.left:0}function m(s){s.top+="px";s.left+="px"}function l(){if(!h.is(":visible")){return}var v=c.offset(),s=b(document.body).offset(),u={};v.left-=s.left;v.top-=s.top;if(e.indexOf("left")>-1){u.left=v.left+c.width()-h.width()}else{if(e.indexOf("center")>-1){u.left=v.left+(c.width()-h.width())/2}else{u.left=v.left}}if(e.indexOf("top")>-1){u.top=v.top-c.height()-h.height()}else{if(e.indexOf("middle")>-1){u.top=v.top+(c.height()-h.height())/2}else{if(e.indexOf("t_equal")>-1){u.top=v.top}else{u.top=v.top+c.height()}}}o(u);m(u);h.css(u)}if(d.attachment){g.attach(d.attachment,d.position,false,!d.openOnLoad)}}})(jQuery,window.Lego);(function(b,a){a.block["b-ausfallen"]=function(d){var c=b(".b-ausfallen");this.click(function(){var g,j;c.css({top:"-5000px",left:"-5000px"});c.removeClass("g-hidden");function e(){g=(b(window).width()/2)-(c.width()/2);if(b.browser.msie){j=(b(window).height()/2)-(c.height()/2)+b(document).scrollTop()}else{j=(b(window).height()/2)-(c.height()/2);c.css({position:"fixed"})}return{x:g,y:j}}p=e();c.css({top:p.y,left:p.x});if(b.browser.msie){b(window).bind("scroll.popup",function(){p=e();c.css({top:p.y,left:p.x})})}b(window).bind("resize.popup",function(){p=e();c.css({top:p.y,left:p.x})});if(b.isFunction(d.counter)){d.counter()}var h=d.link;if(b.isFunction(d.link)){h=d.link()}c.find(".b-ausfallen__frame").replaceWith('<iframe class="b-ausfallen__frame" src="'+h+'" frameborder="0" src="about:blank"></iframe>');return false});b(".b-ausfallen__close").click(function(){c.css({top:"-5000px",left:"-5000px"});c.addClass("g-hidden");b(window).unbind(".popup");return false})}})(jQuery,window.Lego);(function($,Lego){var cache={},saveError=iget("Ошибка при сохранении ставки. Попробуйте еще раз."),loadError=iget("Ошибка при загрузке цен. Попробуйте еще раз.");Lego.block["b-inline-bid"]=function(params){var $this=$(this),value=$(".b-inline-bid__value",$this),phrase=$(".b-inline-bid__phrase",$this),popupWindow,popupSubmit,priority,price,bound=false;var priorityPositionMap={1:0,3:1,5:2};var priorityMap={1:iget("низкий приоритет"),3:iget("средний приоритет"),5:iget("высокий приоритет")};function attachOrClose(w,attachment){var api=w.data("api");if(api.visible()&&api.attachment()==attachment){api.close();return false}else{api.attach(attachment,null,true)}return true}function initPopupWindow(){if(popupWindow){return}popupWindow=$(".b-inline-bid__window-price");popupSubmit=$(".b-inline-bid__submit",popupWindow);price=$(".b-inline-bid__bid",popupWindow);priority=$(".b-inline-bid__priority",popupWindow)}function showPopupWindow(stat){$(".b-inline-bid__value-loading",value).remove();if(!stat){return}initPopupWindow();if(!attachOrClose(popupWindow,value[0])){return}$(".b-inline-bid__window-phrase").data("api").close();$(["pmax","pmin","max","min","broker","min_price"]).each(function(i,name){$(".b-inline-bid__price-"+name,popupWindow).html(stat[name])});$(".b-inline-bid__price-pmax",popupWindow).closest("tr")[stat.pmax==stat.pmin?"hide":"show"]();$(".b-inline-bid__price-min_price",popupWindow).closest("tr")[!stat.min_price?"hide":"show"]();$(".b-inline-bid__price-coverage",popupWindow).closest("tr")[params.priority?"hide":"show"]();bindWindow();if(params.priority){priority.eq(priorityPositionMap[params.priority]).attr("checked","checked")}else{price.val(common.format.number(stat.price,2,"."));price.triggerHandler("change")}}function onValueChange(){var priceVal=common.parse.number(price.val()),stat=cache[params.id],data=direct.autobroker.calcPrice(priceVal,stat.arr,stat.parr,stat.larr,stat.min_price);$(".b-inline-bid__price-broker",popupWindow).html(common.format.number(data.price,2,"."));$(".b-inline-bid__price-coverage",popupWindow).html(common.format.number(data.coverage*100,0)+"%");stat.broker=data.price}function bindWindow(){if(bound){return}bound=true;if(!params.priority){price.bind("change blur keyup",onValueChange)}price.keyup(priceKeyPress);popupSubmit.click(onPopupSubmit);popupWindow.bind("b-window_detach",releaseWindow)}function priceKeyPress(e){if(e.which==13){onPopupSubmit()}}function releaseWindow(){popupSubmit.unbind("click",onPopupSubmit);popupSubmit.attr("disabled","");price.unbind("change blur keyup",onValueChange);price.unbind("keyup",priceKeyPress);popupWindow.unbind("b-window_detach",releaseWindow);bound=false}function onPopupSubmit(e){popupSubmit.attr("disabled","disabled");var data={cmd:"ajaxUpdatePrices",bid:params.bid,id:params.id,cid:params.cid,phrase:params.phrase},priceVal=common.parse.number(price.val()||""),priorityVal=$(".b-inline-bid__priority:checked",popupWindow).val(),suffix=params.bid+"_"+params.id;params.price=data["val_"+suffix]=params.priority?params.price:priceVal;data["broker_"+suffix]=params.broker;if(params.ulogin){data.ulogin=params.ulogin}if(params.priority){data["autobudgetPriority_"+suffix]=params.priority=priorityVal}$(["arr","parr","larr"]).each(function(i,name){data[name+"_"+suffix]=cache[params.id][name]});if(cache[params.id].price!=priceVal||cache[params.id].priority!=priorityVal){$.ajax({url:"/registered/main.pl",data:data,type:"post",success:function(responseText){var response;try{response=eval("("+responseText+")")}catch(e){}if(response&&response.error){alert(response.error)}else{if(!response||!response.status){alert(saveError)}else{cache[params.id].price=priceVal;cache[params.id].autobudgetPriority=priorityVal;if(params.priority){value.html("<span>"+priorityMap[priorityVal]+"</span>")}else{value.html("<span>"+common.format.number(priceVal,2,".")+" "+iget("у.е.")+"</span>")}popupWindow.data("api").close()}}popupSubmit.attr("disabled","")},error:function(){alert(saveError);popupSubmit.attr("disabled","")}})}else{popupWindow.data("api").close();popupSubmit.attr("disabled","")}}function loadStatForBid(bid,id,callback){if(cache[id]){callback(cache[id])}else{var data={cmd:"ajaxGetPrices",bid:bid,cid:params.cid};if(params.ulogin){data.ulogin=params.ulogin}$.ajax({url:"/registered/main.pl",data:data,success:function(responseText){var response;try{response=eval("("+responseText+")")}catch(e){}if(!response||!response.result){alert(loadError)}else{if(response.error){alert(response.error)}else{$.each(response.result,function(){cache[this.id]=this})}}callback(cache[id])},error:function(){alert(loadError);callback(cache[id])}})}}phrase.click(function(){var w=$(".b-inline-bid__window-phrase");if(!attachOrClose(w,this)){return}var priceWindow=$(".b-inline-bid__window-price");priceWindow[0]&&priceWindow.data("api").close();$(".b-inline-bid__window__per-phrase",w).html(params.phrase.replace(/(\s+-.*)$/,"<em>$1</em>"));$(".b-inline-bid__window__per-camp",w).toggle(!!params.commonMinusWords).html(params.commonMinusWords);$(".b-inline-bid__window__per-camp__header",w).toggle(!!params.commonMinusWordsTitle).html(params.commonMinusWordsTitle)});value.click(function(){value.append('<i class="b-inline-bid__value-loading"></i>');loadStatForBid(params.bid,params.id,showPopupWindow)})}})(jQuery,window.Lego);(function(b,a){a.block["b-toggle"]=function(m){var l=b(this),e=b(".b-toggle__handle",l);e.click(function(n){n.preventDefault();j(this)});g();function j(o,s){var n=h(o),q=c(n),u=(n?"-"+n:"");l.toggleClass("closed"+u,q).toggleClass("open"+u,!q);if(!s){d(!q,n)}}function d(o,n){var q=m.storeName+(n?"-"+n:"");if(q){var s=b.grep((direct.UserOptions.get("toggle")||"").split("|"),function(u){return u&&u!="-"&&u!=q});if(!o&&b.inArray(q,s)==-1){s.push(q)}direct.UserOptions.set("toggle",s.join("|")||"-")}}function g(){if(m.storeName){var o={},n=(direct.UserOptions.get("toggle")||"").split("|");e.each(function(){var q=h(this);if(o[q||"-"]){return}o[q||"-"]=true;var s=m.storeName+(q?"-"+q:""),u=b.inArray(s,n)!=-1;if(u==c(q)){j(handle,false)}})}}function c(n){var o=(n?"-"+n:"");return !l.hasClass("closed"+o)}function h(n){var o=n.className.match(/handle-(\S+)/);return o?o[1]:""}}})(jQuery,window.Lego);(function(b,a){a.block["b-tabs"]=function(g){var l=b(this),m=b(".b-tabs__li",this),c=b(".b-tabs__target:eq(0) .b-tabs__target__li",l.parent()),n=b(".b-tabs__input"),d,j;m.click(function(){if(b(this).hasClass("b-tabs__li_active")){return}j.selectedIndex(b(this).prevAll(".b-tabs__li").length)});l.data("api",j={selectedIndex:function(o){if(o===undefined){return d}d=o;m.removeClass("b-tabs__li_active");c.removeClass("b-tabs__target__li_active");m.eq(d).addClass("b-tabs__li_active");c.eq(d).addClass("b-tabs__target__li_active");l.trigger("b-tabs.changed",{selectedIndex:d,name:g.tabNames?g.tabNames[d]:null});if(n.length&&g.tabNames){n.val(g.tabNames[d])}if(g.hash&&g.tabNames){location.href="#"+g.tabNames[d]}}});if(g.hash&&g.tabNames){var h=location.href.match(/#(.*)/),e=-1;if(h){e=b.inArray(h[1],g.tabNames)}j.selectedIndex(e<0?0:e)}else{var e=m.filter(".b-tabs__li_active");j.selectedIndex(e.length?e.prevAll(".b-tabs__li").length:0)}}})(jQuery,window.Lego);direct.formsedit={};direct.formsedit.Model=$.extend({},common.Observable,new function(){this.inputFields=[];this.getData=function(){var a={};$.each(this.inputFields,$.proxy(function(c,b){a[b]=this[b]()},this));return a};this.clear=function(a){var d=(new this.self()).getData();for(var b=0;b<this.inputFields.length;b++){var c=this.inputFields[b];if(d[c]===undefined){d[c]=""}}return this.update(d,a)};this.newProp=function(b,a){b="_"+b;return function(d,c){if(d===undefined){return this[b]}if(a){a.call(this,d,c)}else{this[b]=d?d:""}return this}};this.addProps=function(d,c){for(var b=0,a=c.length;b<a;b++){d[c[b]]=direct.formsedit.Model.newProp(c[b])}};this.update=function(d,a){var c={},g=[];for(var b in d){if(!d.hasOwnProperty(b)){continue}if(!this[b]||!this[b].apply){continue}var h=this[b](),e=d[b];if(d[b]===null||d[b]===undefined){d[b]=""}if(h!==e){c[b]=[h,e];g.push(b);this[b](e,a)}}this._triggerChange({changes:c,fields:g,source:a,model:this});return this};this._triggerChange=function(a){var b=this;$.each(this.inputFields,function(c,d){if(a.changes[d]){b.trigger("change."+d,a)}});this.trigger("change",a)};this.fixInitState=function(){this.staticData=this.getData();this.trigger("fix-init-state")};this.saveState=function(a){this.staticData=this.getData()};this.resetState=function(){var b=this;for(var a in this.staticData){if(this.staticData.hasOwnProperty(a)){this["_"+a]=this.staticData[a]}}};this.validate=function(c){c=c||this.validatedFields;var d={},a;for(var b=0;b<c.length;b++){if($.isFunction(this["validate_"+c[b]])){a=this["validate_"+c[b]]()}else{if(!$.isFunction(this[c[b]])||!this[c[b]]()){a=["empty"]}else{a=[]}}if(a&&a.length){d[c[b]]=a}}return d};this.getErrorsMessage=function(a){}});direct.formsedit.ModelAggregator=$.extend({},direct.formsedit.Model,new function(){this.models={};this.validate=function(){var a=direct.formsedit.Model.validate.apply(this);a.common=$.extend({},a);for(var b in this.models){if(!this.needToValidate(b)){continue}a[b]=this.models[b].validate()}return a};this.needToValidate=function(a){return true};this.update=function(b,a){if(b.common){this.update(b.common,a)}direct.formsedit.Model.update.call(this,b,a);return this};this.clear=function(a){for(var b in this.models){if(this.hasOwnProperty(b)){this[b]().clear(a)}}return direct.formsedit.Model.clear.call(this,a)};this.attach=function(a,b){this["_"+b]=this.models[b]=a;this[b]=this.newProp(b,function(e,d){this["_"+b].update(e,d)});var c=this;$.each(a.triggers||[],function(e,d){a.bind("change."+d,function(g){c.trigger("change."+d,{changes:g.changes,fields:g.fields,source:g.source,model:c})})})};this.saveState=function(b){this.staticData=this.getData();for(var a in this.models){if(!this.models.hasOwnProperty(a)){continue}this.models[a].staticData=this.models[a].getData()}};this.fixInitState=function(){direct.formsedit.Model.fixInitState.call(this);for(var a in this.models){if(!this.models.hasOwnProperty(a)){continue}this.models[a].fixInitState()}};this.getData=function(b){var c=direct.formsedit.Model.getData.call(this);c.common=$.extend({},c);for(var a in this.models){if(!this.models.hasOwnProperty(a)){continue}c[a]=this.models[a].getData()}return c};this.getModel=function(a){return(a=="common")?this:this.models[a]}});(function(){var a=direct.formsedit.OGRNModel=function(b){b&&this.update(b)};a.prototype=$.extend({},direct.formsedit.Model,new function(){this.self=a;this.inputFields=["ogrn_num","org_details_id"];this.allFields=this.inputFields;this.triggers=["ogrn_num"];this._ogrn_num=this._org_details_id="";this.validatedFields=["ogrn_num"];direct.formsedit.Model.addProps(this,this.allFields);this.isEmpty=function(){var b=this.ogrn_num();return $.trim(b)==""||b==a.prototype._ogrn_num};this.isEqual=function(b){if(!b&&!this.org_details_id()&&!this.ogrn_num()){return true}return b&&(this.org_details_id()||this.ogrn_num()==b.ogrn_num)&&this.org_details_id()==b.org_details_id};this.isChanged=function(){if(!this.staticData){return false}if(this.ogrn_num()!=this.staticData.ogrn_num&&$.validateOGRN(this.ogrn_num())){return true}return false};this.getErrorsMessage=function(b){b=b||this.validate();if(!b){return}if(b.ogrn_num&&$.inArray("invalid_ogrn",b.ogrn_num)!=-1){return iget("Введен неверный ОГРН/ОГРНИП.")}return""};this.validate_ogrn_num=function(){var b=this.ogrn_num();if(b==""||$.validateOGRN(b)){return[]}else{return["invalid_ogrn"]}};this._triggerChange=function(c){var b=c.changes;if(b.ogrn_num){this.trigger("change.ogrn_num",c)}this.trigger("change",c)}})})();(function(){var a=direct.formsedit.VCardModel=function(c,b){this._init(c)};a.prototype=$.extend({},direct.formsedit.ModelAggregator,new function(){this.self=a;this.allFields=this.inputFields=["country","city","country_code","name","city_code","phone","ext","contactperson","worktime","street","contact_email","house","build","apart","im_client","name","im_login","extra_message","geo_id","ci_name","auto_bounds","auto_point","auto_precision","manual_bounds","manual_point"];this.triggers=["extra_message","vcard"];this.validatedFields=["country","city","country_code","city_code","phone","name"];direct.formsedit.Model.addProps(this,this.allFields);$.each(this.allFields,$.proxy(function(d,c){this["_"+c]=""},this));this._worktime="0#4#10#00#18#00";var b={country:iget("страна"),city:iget("город"),country_code:iget("код страны"),city_code:iget("код города"),phone:iget("телефон"),name:iget("название компании/ФИО")};this._init=function(c){this.models={};this.attach(new direct.formsedit.OGRNModel(),"ogrn");if(c){this.update(c)}};this.getErrorsMessage=function(e){e=e||this.validate();var c=[],g=[];for(var d in e){if(e.hasOwnProperty(d)){if($.inArray("empty",e[d])!=-1){c.push(b[d])}}}if(c.length){g.push(iget("Заполнены не все требуемые поля контактной информации:")+" "+c.join(", "))}g.push(this.ogrn().getErrorsMessage());return $.grep(g,function(h){return h}).join("\n")};this._triggerChange=function(c){direct.formsedit.Model._triggerChange.call(this,c);if(c.fields.length){this.trigger("change.vcard",c)}};this.isEqual=function(e,d,c){for(var g in e){if(!e.hasOwnProperty(g)){continue}if(typeof this[g]!="function"){continue}if(this.models[g]){continue}if(c&&g.match(/^(manual_|auto_)/)){continue}if(!$.isEqual(this[g](),e[g])&&(d||!$.isEqual(a.prototype["_"+g],this[g]()))){return false}}return this.ogrn().isEqual(e.ogrn)};this.isEmpty=function(){var d=this,c=true;$.each(this.inputFields,function(e,h){var g=d[h]();if(h!="worktime"&&g&&$.trim(g||"")!=""){c=false;return false}else{if(h=="worktime"&&a.prototype._worktime!=g){c=false;return false}}});return c&&this.ogrn().isEmpty()}})})();(function(){var a=direct.formsedit.HrefModel=function(b){if(b){if(b.href&&!b.domain_sign){b.domain_sign=1}this.update(b)}};a.prototype=$.extend({},direct.formsedit.Model,new function(){this.self=a;this.allFields=this.inputFields=["href","domain","domain_sign","domain_error"];this.triggers=["href"];this.validatedFields=["href"];direct.formsedit.Model.addProps(this,this.allFields);this._href=this._domain=this._domain_error=this._domain_sign="";this.getErrorsMessage=function(b){b=b||this.validate();if(b.href&&$.inArray("empty",b.href)!=-1){return iget("Не введена ссылка на сайт")}return""};this.href=direct.formsedit.Model.newProp("href",function(b){this._href=b});this.domain_calc=function(){return $.extractDomain(this.href())}})})();(function(){var a=direct.formsedit.Sitelinks=function(b){b&&this.update(b)};a.prototype=$.extend({},direct.formsedit.Model,new function(){this.self=a;this.allFields=this.inputFields=[];this.validatedFields=[];for(var b=0;b<SITELINKS_NUMBER;b++){this["title"+b]=direct.formsedit.Model.newProp("title"+b);this["href"+b]=direct.formsedit.Model.newProp("href"+b);this["_title"+b]="";this["_href"+b]="";this.inputFields.push("title"+b);this.inputFields.push("href"+b);this.validatedFields.push("title"+b);this.validatedFields.push("href"+b)}this.update=function(e,c){for(var d=0;d<SITELINKS_NUMBER;d++){if(e[d]&&e[d].title){e["title"+d]=e[d].title||"";e["href"+d]=e[d].href||"";delete e[d]}}return direct.formsedit.Model.update.call(this,e,c)};this.totalTitleLength=function(){var c=0;for(var d=0;d<SITELINKS_NUMBER;d++){c+=$.trim(this["title"+d]()).length}return c};this.validate=function(){return false};this.isEmpty=function(){for(var c=0;c<SITELINKS_NUMBER;c++){if($.trim(this["title"+c]())||$.trim(this["href"+c]())){return false}}return true}})})();(function(){var self=direct.formsedit.Banner=function(data){this._init(data)};self.prototype=$.extend({},direct.formsedit.ModelAggregator,new function(){this.self=self;var rubricsFields=["text_rubrics","ChoosedCategories","UncheckedCategories","categories"];this.inputFields=["title","body","all_phrases","DontShowCatalog","with_sitelinks"].concat(rubricsFields);this.utilityFields=["ci_hidden","with_href","with_ci","geo","bid","isMediaplan"];this.allFields=this.inputFields.concat(this.utilityFields).concat(rubricsFields);this.validatedFields=["title","body","all_phrases"];var fieldsNames={title:iget("заголовок"),body:iget("текст объявления"),all_phrases:iget("ключевые фразы")};direct.formsedit.Model.addProps(this,this.allFields);this._init=function(data){this.models={};this.attach(new direct.formsedit.VCardModel(),"vcard");this.attach(new direct.formsedit.HrefModel(),"href");this.attach(new direct.formsedit.Sitelinks(),"sitelinks");if(data){data.ci_hidden=data.with_ci*1?0:1;data.href=!data.href||typeof data.href=="string"?$.extend({},data):data.href;this.update(data)}};this.getErrorsMessage=function(errors){errors=errors||this.validate();var emptyFields=[],errorMessages=[];for(var field in errors){if(errors.hasOwnProperty(field)){if($.inArray("empty",errors[field])!=-1){emptyFields.push(fieldsNames[field])}}}if(emptyFields.length){errorMessages.push(iget("Заполнены не все требуемые поля:")+" "+emptyFields.join(", "))}if(errors.all_phrases&&$.inArray("size",errors.all_phrases)!=-1){errorMessages.push(iget("Превышена допустимая длина ключевых фраз в 4096 символов"))}for(var m in this.models){if(this.models.hasOwnProperty(m)){if(this.needToValidate(m)){errorMessages.push(this.models[m].getErrorsMessage())}}}return $.grep(errorMessages,function(x){return x}).join("\n")};this.validate_all_phrases=function(){if(!$.isFunction(this.all_phrases)||!this.all_phrases()||!this.all_phrases().length){return["empty"]}var phrases=this.all_phrases().join("");if(phrases.length>4096){return["size"]}return[]};this.needToValidate=function(type){switch(type){case"vcard":return this.with_ci();case"href":return this.with_href();case"sitelinks":return this.with_sitelinks()&&this.with_href();default:return true}};this.with_ci=direct.formsedit.Model.newProp("with_ci",function(v){this._with_ci=v*1});this.with_href=direct.formsedit.Model.newProp("with_href",function(v){this._with_href=v*1});this.getChoosedCategories=function(){if(this.ChoosedCategories()){return this.ChoosedCategories()}else{var res="";if(this.categories()){$.each(this.categories(),function(i,cat){res+=(i!=0)?","+cat.phrase:cat.phrase})}return res}};this.ci_hidden=function(v){if(v===undefined){return !this.with_ci()}return this.with_ci(!v)};this._triggerChange=function(e){direct.formsedit.ModelAggregator._triggerChange.call(this,e);var _this=this;$.each(rubricsFields,function(){if(e.changes[this]){_this.trigger("change.rubrics",e);return false}});if(e.changes.DontShowCatalog){this.trigger("change.DontShowCatalog",e)}if(e.changes.title){this.trigger("change.title",e)}if(e.changes.body){this.trigger("change.body",e)}if(e.changes.with_ci){this.trigger("change.with_ci",e)}if(e.changes.ci_hidden){this.trigger("change.ci_hidden",e)}if(e.changes.with_href){this.trigger("change.with_href",e)}if(e.changes.with_sitelinks){this.trigger("change.with_sitelinks",e)}};this.check_minus_words=function(cid,callback){direct.formsedit.Banner.check_minus_words(this.all_phrases(),cid,callback)}});direct.formsedit.Banner.check_minus_words=function(phrases,cid,callback){var _this=this,banner_phrases=(typeof phrases==="string")?phrases:phrases.join(" ");$.ajax({url:"/registered/main.pl",type:"POST",data:{cmd:"ajaxCheckCampMinusWords",cid:cid,banner_words:banner_phrases},timeout:5000,success:function(string){var data;try{data=eval("("+string+")")}catch(e){}callback(data&&data.error)},error:function(){callback(false)}})}})();(function(){var a=direct.formsedit.PriceModel=function(b){this.phrases=b};a.prototype=$.extend({},direct.formsedit.Model,new function(){this.self=a;var b=[0,3,13,12];this.getErrorsMessage=function(c){c=c||this.validate();if(c.phrases&&$.inArray("empty",c.phrases)!=-1){return iget("Необходимо добавить Ключевые слова")}return""};this.allFields=["unglued"];this.validatedFields=["phrases"];direct.formsedit.Model.addProps(this,this.allFields);this._unglued=1;this.setPlaceForAll=function(d,c){var e=this;$.each(this.phrases,function(g){this[6]=d});this.trigger("change.place",{source:c,placeNum:d})},this.getPhrases=function(){var c=[];$.each(this.phrases,function(d){c.push(this[7])});return c},this.allPhrasesForSubmit=function(){var d="",c="";$.each(this.phrases,function(e){c=(d)?",":"";d+=c+this[7]+"::"+this[8]+"::"+this[10]});return d};this.getIsActive=function(c){return this.phrases[c][5]},this.setIsActive=function(d,c){this.phrases[d][5]=c;this.trigger("change.phrase")};this.getPhrasesWithUngluedSuffix=function(){var c=[];$.each(this.phrases,function(d){c.push(this[7]+this[11])});return c},this.countGlobSummSpec=function(){var c=0;$.each(this.phrases,function(d){if(!this[5]){c+=this[2]}});return c};this.countGlobSummFirst=function(){var c=0;$.each(this.phrases,function(d){if(!this[5]){c+=this[1]}});return c};this.countGlobSummGarant=function(){var c=0;$.each(this.phrases,function(d){if(!this[5]){c+=this[0]}});return c};this.getResultOutput=function(){var d=[];var c=this.unglued();$.each(this.phrases,function(e){d.push(this[7]+(c?this[11]:"")+"#"+this[5]+"#"+this[6]+"#"+this[8]+"#"+this[10]+"#"+this[4])});return d.join(",")};this.validate_phrases=function(){var c=false;$.each(this.phrases,function(d){if(this[10]>0&&this[5]==0){c=true}});return c?[]:["empty"]};this.setPlace=function(e,d,c){this.phrases[d][6]=e;this.trigger("change.place",{source:c,placeNum:e,phraseNum:d})},this.getSummShows=function(){var c=0;$.each(this.phrases,function(){if(!this[5]){c+=this[4]}});c=(Math.round(c*100))/100;return c},this.getSummBudget=function(){var d=0;$.each(this.phrases,function(){if(!this[5]){d+=this[this[6]-1]}});d=(Math.round(d*100))/100;var c=(Math.round(kurs_ye*d*100))/100;return d+"<br>(&nbsp;"+c+"  "+iget("руб.")+"&nbsp;)"},this.getCTR=function(){var d=0;var c=0;$.each(this.phrases,function(){if(!this[5]){d+=this[parseInt(b[this[6]])];c++}});var e=0;if(d){e=(Math.round((d/c)*100))/100}return e};this._triggerChange=function(c){if(c.changes.unglued){this.trigger("change.unglued",c)}}})})();(function(){var a=direct.formsedit.Timetargeting=function(c,b){this.weekdayNames=(iget("Пн.")+" "+iget("Вт.")+" "+iget("Ср.")+" "+iget("Чт.")+" "+iget("Пт.")+" "+iget("Сб.")+" "+iget("Вс.")).split(" ");c=c||{};this.update(c)};a.prototype=$.extend({},direct.formsedit.Model,new function(){this.self=a;var j={holiday:["time_target_holiday","time_target_holiday_dont_show","time_target_holiday_from","time_target_holiday_to"],timezone:["timezone_id","timezone_text"],timeTarget:["timeTarget"]};this.triggers=[];this.validatedFields=["counter"],this.utilityFields=["counter"],this.inputFields=this.allFields=j.holiday.concat(j.timezone).concat(j.timeTarget).concat(this.utilityFields);direct.formsedit.Model.addProps(this,this.allFields);this._time_target_holiday=0;this._time_target_holiday_dont_show=0;this._time_target_holiday_from=8;this._time_target_holiday_to=20;this._timezone_id=0;this._timeTarget="1ABCDEFGHIJKLMNOPQRSTUVWX2ABCDEFGHIJKLMNOPQRSTUVWX3ABCDEFGHIJKLMNOPQRSTUVWX4ABCDEFGHIJKLMNOPQRSTUVWX5ABCDEFGHIJKLMNOPQRSTUVWX6ABCDEFGHIJKLMNOPQRSTUVWX7ABCDEFGHIJKLMNOPQRSTUVWX";this._timezone_text="";this.timeTarget=direct.formsedit.Model.newProp("timeTarget",function(u){this._timeTarget=u.replace(/(\d)$/,"")||this._timeTarget});this.timezone_id=direct.formsedit.Model.newProp("timezone_id",function(u){this._timezone_id=u?u:0});var g=this;$.each(["time_target_holiday","time_target_holiday_dont_show","time_target_holiday_from","time_target_holiday_to"],function(v,u){g[u]=direct.formsedit.Model.newProp(u,function(w){this["_"+u]=w||w===0?w*1:this["_"+u]})});this.validate_counter=function(){if(this.counter()<40){return["size"]}};this.getErrorsMessage=function(u){u=u||this.validate();if(u.counter&&$.inArray("size",u.counter)!=-1){return iget("Объявления должны быть включены не менее 40 часов в неделю в рабочие дни. Измените расписание показа объявлений.")}};var m=["timezone_id"];var s="ABCDEFGHIJKLMNOPQRSTUVWX";var h="1234567";var n=s.split("");var b=200;var c;var e;this._triggerChange=function(u){var v=this;$.each(j,function(w,y){for(var x=0;x<y.length;x++){if(u.changes[y[x]]){v.trigger("change."+w,u);return}}})};this.isInseparable=function(){var w=this.timeTarget().match(/\d/g);var u=this.timeTarget().split(/\d/);if(!w||!u){return false}if(!$.browser.msie){u=u.slice(1)}if(h.indexOf(w.join(""))==-1){return false}if(s.indexOf(u[0])==-1){return false}for(var v=1;v<u.length;v++){if(u[v]!=u[0]){return false}}return true};this.updater=function(){this.trigger("update.all")};this.calculateText=function(x){var y="";x=x||"\n";var v=l.call(this,this.timeTarget());var w="";if(this.time_target_holiday()){if(this.time_target_holiday_dont_show()==1){w+=iget("По праздникам: не показывать")}else{if(this.time_target_holiday_from()!=0||this.time_target_holiday_to()!=24||v!=iget("Круглосуточно")){w+=iget("По праздникам: показывать c")+" "+this.time_target_holiday_from()+":00 "+iget("до")+" "+this.time_target_holiday_to()+":00"}}}var u="";if(this.timezone_id()&&(v!=iget("Круглосуточно")||w)){u=iget("Время")+": "+this.timezone_text()}y+=v;if(w){y+=(y)?x+w:w}if(u){y+=(y)?x+u:u}return y};function l(x){if(!x){return iget("Круглосуточно")}var A=x.match(/\d/g);var u=x.split(/\d/);if(!A||!u){return""}if(!$.browser.msie){u=u.slice(1)}var y="";var z=(A.length==7);if(d(u)){z=z&&(u[0].length==24);y=o.call(this,A)+": "+q(u[0])}else{for(var w=0;w<A.length;w++){z=z&&u[w].length==24;y+=(y)?", "+this.weekdayNames[A[w]-1]+": "+q(u[w]):this.weekdayNames[A[w]-1]+": "+q(u[w])}}y=(z)?iget("Круглосуточно"):iget("Показывать")+": "+y||iget("Круглосуточно");if(y.length>b){y=y.slice(0,b);var v=y.match("(.*),[^,]*$");y=(v)?v[1]+"...":y+"..."}return y}function d(v){var u=v[0];for(var w=0;w<v.length;w++){if(u!=v[w]){return false}}return true}function o(x){var w=this.weekdayNames[x[0]-1];var u="";for(var v=1;v<x.length;v++){if(x[v]-1!=x[v-1]){if(u){w+="-"+this.weekdayNames[u-1];u=""}w+=", "+this.weekdayNames[x[v]-1]}else{u=x[v]}if(v==x.length-1&&u){w+="-"+this.weekdayNames[u-1]}}return w}function q(x){var z=x.split("");var y="";var u=[],w;for(var v=0;v<n.length;v++){u.push(z.indexOf(n[v])!=-1)}for(var v=0;v<=u.length;v++){if((!u[v])&&w){y+=(y)?", "+w+"-"+v+":00":w+"-"+v+":00";w=null;continue}if(!w&&u[v]){w=v+":00"}}return y}})})();(function(){var self=direct.formsedit.campaignModel=function(data){this._init();if(data){data.timetarget=data.timetarget||data;this.update(data)}};self.prototype=$.extend({},direct.formsedit.ModelAggregator,new function(){this.self=self;var notListenedFields=["isNewCamp","geo_text","is_serviced","cid"],otherListenedFields=["statusMetricaControl","ci_hidden","submit_disable","minus_words_error","DoShow","orig_is_serviced","my_pages","AgencyUID","ManagerUID","minus_words","autoOptimization","agency","servicing","geo","statusOpenStat","name","start_date","timeTarget","FIO","rf","rfReset","camp_description","favorite_camp","fairAuction"],smsNotificationFields=["sms_flags","sms_time","sms_phone"],emailNotificationFields=["email","sendWarn","sendAccNews","money_warning_value","warnPlaceInterval"],contextLimitFields=["ContextLimit","ContextPriceCoef","statusBehavior","statusContextStop"],downtshowFields=["DontShow"],broadMatchFields=["show_broad_match","broad_match_flag","broad_match_limit"],disabledIpsFields=["disabledIps"],autobudgetFields=["autobudget","autobudget_date","autobudget_sum","autobudget_bid","min_price_guarantee","min_price_premium","strategy_min_price"];this.utilityFields=["ci_hidden","submit_disable","minus_words_error"];this.inputFields=notListenedFields.concat(otherListenedFields).concat(broadMatchFields).concat(contextLimitFields).concat(downtshowFields).concat(disabledIpsFields).concat(this.fields).concat(autobudgetFields).concat(emailNotificationFields).concat(smsNotificationFields);this.allFields=this.inputFields.concat(this.utilityFields);this.validatedFields=[];this.listenedFieldsTypes={sms_notification:smsNotificationFields,email_notification:emailNotificationFields,autobudget:autobudgetFields,context_limit:contextLimitFields,downtshow:downtshowFields,disabled_ips:disabledIpsFields,broad_match:broadMatchFields,other:otherListenedFields};direct.formsedit.Model.addProps(this,this.allFields);this._sms_flag={};this._autoOptimization="Yes";this._isNewCamp=1;this._ManagerUID="";this._AgencyUID="";this._ContextPriceCoef=100;this.with_ci=direct.formsedit.Model.newProp("with_ci",function(v){this._with_ci=v*1});this.show_broad_match=direct.formsedit.Model.newProp("show_broad_match",function(v){this._show_broad_match=v*1});this.broad_match_flag=direct.formsedit.Model.newProp("broad_match_flag",function(v){this._broad_match_flag=v*1});this.ci_hidden=function(v){if(v===undefined){return !this.with_ci()}return this.with_ci(!v)};this.autobudget=direct.formsedit.Model.newProp("autobudget",function(v){this._autobudget=v=="No"?false:v=="Yes"?true:!!v});this.check_minus_words=function(cid,ulogin){var _this=this;_this.update({common:{submit_disable:true}});$.ajax({url:"/registered/main.pl",type:"POST",data:{cmd:"ajaxCheckCampMinusWords",cid:cid,ulogin:ulogin,minus_words:_this.minus_words()},timeout:5000,success:function(string){var data;try{data=eval("("+string+")")}catch(e){}if(data&&data.error){_this.minus_words_error(data&&data.error)}else{_this.minus_words_error(false)}_this.update({common:{submit_disable:false}});_this.trigger("submit_continue")},error:function(){_this.minus_words_error(false);_this.update({common:{submit_disable:false}});_this.trigger("submit_continue")}})};this.strategy_min_price=function(v){if(v===undefined){return{guarantee:this.min_price_guarantee(),premium:this.min_price_premium()}}this.min_price_premium(v.premium*1);this.min_price_guarantee(v.guarantee*1);return this};this._init=function(){this.models={};var vcardModel=new direct.formsedit.VCardModel();var timetargetModel=new direct.formsedit.Timetargeting();this.attach(vcardModel,"vcard");this.attach(timetargetModel,"timetarget")};this._triggerChange=function(e){direct.formsedit.ModelAggregator._triggerChange.call(this,e);for(var i=0;i<otherListenedFields.length;i++){if(e.changes[otherListenedFields[i]]){this.trigger("change."+otherListenedFields[i],e)}}var _this=this;for(var name in this.listenedFieldsTypes){$.each(this.listenedFieldsTypes[name],function(i,fieldName){if(fieldName!=name&&e.changes[fieldName]){_this.trigger("change."+name,e);return false}})}}});self.strategyToModel=function(v){var data={};data.autobudget_bid=data.autobudget_sum="";data.min_price_guarantee=data.min_price_premium=0;data.autobudget=false;if(v.strategy=="autobudget"){data.autobudget_bid=v.autobudget_bid;data.autobudget_sum=v.autobudget_sum;data.autobudget="1"}else{if(v.strategy=="min-price"){data.min_price_guarantee=(v.strategyScope=="both"||v.strategyScope=="guarantee")?1:0;data.min_price_premium=(v.strategyScope=="both"||v.strategyScope=="premium")?1:0}}return data};self.modelToStrategy=function(m){var value={};value.autobudget_bid=m.autobudget_bid();value.autobudget_sum=m.autobudget_sum();if(m.autobudget()){value.strategy="autobudget"}else{if(m.min_price_guarantee()||m.min_price_premium()){value.strategy="min-price";value.strategyScope="premium";if((m.min_price_guarantee())){value.strategyScope="guarantee"}if((m.min_price_guarantee()&&m.min_price_premium())){value.strategyScope="both"}}else{value.strategy="default"}}return value}})();(function(){var self=direct.formsedit.Mediaplan=function(data){this._init(data)};self.prototype=$.extend({},direct.formsedit.ModelAggregator,new function(){this.self=self;var rubricsFields=["text_rubrics","ChoosedCategories","UncheckedCategories","categories"];this.inputFields=["title","body","new_phrases","DontShowCatalog"].concat(rubricsFields);this.utilityFields=["ci_hidden","with_href","with_ci","geo","can_saved","bid","isMediaplan","with_sitelinks"];this.allFields=this.inputFields.concat(this.utilityFields);this.validatedFields=["all_phrases"];this._isMediaplan=true;var fieldsNames={all_phrases:iget("ключевые слова")};direct.formsedit.Model.addProps(this,this.allFields);this._init=function(data){this.splitedPhrases={};this.splitedCategories=[];this.models={};this.attach(new direct.formsedit.VCardModel(),"vcard");this.attach(new direct.formsedit.HrefModel(),"href");this.attach(new direct.formsedit.Sitelinks(),"sitelinks");if(data){data.ci_hidden=!data.with_ci;data.href=!data.href||typeof data.href=="string"?$.extend({},data):data.href;this.update(data)}};this.with_ci=direct.formsedit.Model.newProp("with_ci",function(v){this._with_ci=v*1});this.with_href=direct.formsedit.Model.newProp("with_href",function(v){this._with_href=v*1});this.validate_all_phrases=function(){var phrases=this.allPhrases();if(!phrases||!phrases.length){return["empty"]}return[]};this.needToValidate=function(type){switch(type){case"vcard":return false;case"href":return false;case"sitelinks":return this.with_sitelinks()&&this.with_href();default:return true}};this.getErrorsMessage=function(errors){errors=errors||this.validate();var emptyFields=[],errorMessages=[];for(var field in errors){if(errors.hasOwnProperty(field)){if($.inArray("empty",errors[field])!=-1){emptyFields.push(fieldsNames[field])}}}if(emptyFields.length){errorMessages.push(iget("Заполнены не все требуемые поля:")+" "+emptyFields.join(", "))}if(errors.all_phrases&&$.inArray("size",errors.all_phrases)!=-1){errorMessages.push(iget("Превышена допустимая длина ключевых фраз в 4096 символов"))}for(var m in this.models){if(this.models.hasOwnProperty(m)){if(this.needToValidate(m)){errorMessages.push(this.models[m].getErrorsMessage())}}}return $.grep(errorMessages,function(x){return x}).join("\n")};this.new_phrases=direct.formsedit.Model.newProp("new_phrases",function(v){this._new_phrases=$.trim(v)||""});this.allPhrases=function(){var new_phrases=this.new_phrases()||"";var splited=this.getSplitedPhrasesString();var suff=(new_phrases&&splited)?", ":"";return new_phrases+suff+splited};this.allMediaPhrases=function(){var media_phrases=[];for(var i in this.splitedPhrases){if(!this.splitedPhrases.hasOwnProperty(i)){continue}media_phrases.push(this.splitedPhrases[i][0])}return media_phrases};this.splitWords=function(){var new_phrases=this.new_phrases();if(new_phrases){var _this=this;var data={cmd:"ajaxTestPhrases",phrases:new_phrases};function onSplitedPhraseLoaded(res){_this.onSplitedWordsLoaded.call(_this,res)}$.ajax({url:"/registered/main.pl",dataType:"xml",data:data,type:"POST",success:onSplitedPhraseLoaded})}else{this.trigger("load.splitedPhrases")}};this.onSplitedWordsLoaded=function(res){var error=$(res).find("error");if(error.length>0){var errorCode=error.text();alert(errorCode)}else{var _this=this;$(res).find("phrase").each(function(i){var phrase=$(this).text();_this.setSplitedPhrase(direct.utils.generateId(),phrase,_this)});this.trigger("load.splitedPhrases")}};this.getSplitedPhrasesLength=function(){var length=0;for(var i in this.splitedPhrases){length++}return length};this.allPhrasesForSubmit=function(){var splited_str=prefix="",id;for(var i in this.splitedPhrases){if(!this.splitedPhrases.hasOwnProperty(i)){continue}splited_str+=prefix+this.splitedPhrases[i][0]+"::"+this.splitedPhrases[i][1]+"::"+this.splitedPhrases[i][3];prefix=","}for(var i in this.splitedCategories){if(!this.splitedCategories.hasOwnProperty(i)){continue}splited_str+=prefix+this.splitedCategories[i][0]+"::"+i+"::"+0;prefix=","}return splited_str};this.getSplitedPhrasesString=function(){var str="";for(var i in this.splitedPhrases){if(!this.splitedPhrases.hasOwnProperty(i)){continue}str=(str)?str+","+this.splitedPhrases[i]:this.splitedPhrases[i]}return str};this.getSplitedPhrase=function(num){return this.splitedPhrases[num][0]};this.getPhrasesWithoutMinus=function(phrases){var phraseArray=[];for(var i=0;i<phrases.length;i++){if(!phrases[i].match(/^-.*/)){phraseArray.push(phrases[i])}}return phraseArray};this.setSplitedPhrase=function(num,phrase,source){var isNewPhrase=!this.splitedPhrases[num];var newWithoutMinus=this.getPhrasesWithoutMinus($.trim(phrase).split(" "));if(!isNewPhrase){if(!$.trim(phrase)){this.removeSplitedPhrase(num)}this.splitedPhrases[num]=[$.trim(phrase),this.splitedPhrases[num][1],this.splitedPhrases[num][2],newWithoutMinus.length]}else{this.splitedPhrases[num]=[$.trim(phrase),0,1,newWithoutMinus.length]}this.trigger("change.allPhrases");this.trigger("change.splitedPhrases",{source:source,num:num,value:phrase})};this.setSplitedPhrasesHash=function(hash){this.splitedPhrases=hash};this.setSplitedCategoriesHash=function(hash){this.splitedCategories=hash};this.updateCategoriesHash=function(){var categories=this.ChoosedCategories();var _this=this;var splitedTmp={};if(categories){var catArray=categories.split(",");$.each(catArray,function(i,cat){splitedTmp[cat]=_this.splitedCategories[cat]||[0,0,1]});this.splitedCategories=splitedTmp}else{this.splitedCategories={}}};this.removeAllPhrases=function(){var nums=[];for(var i in this.splitedPhrases){nums.push(i);delete (this.splitedPhrases[i])}this.trigger("removeSplitedPhrases",{phrasesNums:nums});this.trigger("change.allPhrases")};this.removeSplitedPhrase=function(num){delete (this.splitedPhrases[num]);this.trigger("removeSplitedPhrases",{phrasesNums:[num]});this.trigger("change.allPhrases")};this.getChoosedCategories=function(){if(this.ChoosedCategories()){return this.ChoosedCategories()}else{var res="";if(this.categories()){$.each(this.categories(),function(i,cat){res+=(i!=0)?","+cat.phrase:cat.phrase})}return res}};this._triggerChange=function(e){direct.formsedit.ModelAggregator._triggerChange.call(this,e);if(e.changes.new_phrases){this.trigger("change.new_phrases",e);this.trigger("change.allPhrases",e)}var _this=this;$.each(rubricsFields,function(){if(e.changes[this]){_this.trigger("change.rubrics",e);return false}});if(e.changes.ChoosedCategories){this.updateCategoriesHash()}if(e.changes.title){this.trigger("change.title",e)}if(e.changes.body){this.trigger("change.body",e)}if(e.changes.ci_hidden){this.trigger("change.ci_hidden",e)}if(e.changes.with_sitelinks){this.trigger("change.with_sitelinks",e)}if(e.changes.with_ci){this.trigger("change.with_ci",e)}if(e.changes.with_href){this.trigger("change.with_href",e)}}});direct.formsedit.Mediaplan.check_minus_words=function(phrases,cid,callback){var _this=this;$.ajax({url:"/registered/main.pl",type:"POST",data:{cmd:"ajaxCheckCampMinusWords",cid:cid,banner_words:phrases},timeout:5000,success:function(string){var data;try{data=eval("("+string+")")}catch(e){}callback(data&&data.error)},error:function(){callback(false)}})}})();(function(){var a=direct.formsedit.Phrase=function(b){if(b){this.update(b,a,true)}};a.prototype=$.extend({},direct.formsedit.Model,new function(){this.self=a;var c=["place","w_pmin","w_max","w_min","p_ctr","fp_ctr","ctr","shows","p_clicks","fp_clicks","clicks"];var b=["phrase","declined","checked","phrase_unglued_suffix","numword","mbid","id0","id","group_checked"];this.allFields=b.concat(c);this.utilityFields=["budget_type"];direct.formsedit.Model.addProps(this,this.allFields);var d=this;$.each(c,function(e,g){d[g]=direct.formsedit.Model.newProp(g,function(h){this["_"+g]=h*1})});this.p_budget=function(){return this.p_clicks()*this.w_pmin()};this.fp_budget=function(){return this.fp_clicks()*this.w_max()};this.budget=function(){return this.clicks()*this.w_min()};this.current_ctr=function(){switch(this.place()){case 0:return this.clicks();case 1:return this.ctr();case 2:return this.fp_ctr();case 3:return this.p_ctr()}};this.current_budget=function(){switch(this.place()){case 1:return this.budget();case 2:return this.fp_budget();case 3:return this.p_budget()}};this._triggerChange=function(g){if(g.changes.place){this.trigger("change.place",g)}if(g.changes.declined){this.trigger("change.declined",g)}if(g.changes.checked){this.trigger("change.checked",g)}if(g.changes.group_checked){this.trigger("change.group_checked",g)}}})})();(function(){var a=direct.formsedit.BannerInfo=function(b){this._phrases={};this._categories={};if(b){this.update(b,a,true)}};a.prototype=$.extend({},direct.formsedit.Model,new function(){direct.formsedit.Model.addProps(this,["bid","selected"]);this.setHashProp=function(b,c){this[b]=function(e,d){if(d===undefined){return this["_"+c][e]}else{this["_"+c][e]=d}};this[b+"Field"]=function(g,e,d){if(d===undefined){return this["_"+c][g][e]}else{this["_"+c][g][e]=d}};this[c]=function(){return this["_"+c]}};this.setHashProp("category","categories");this.setHashProp("phrase","phrases")})})();(function(){common.template={evaluate:function(a,c){for(var b in c){a=a.split("${"+b+"}").join(c[b])}return a}}})();(function(g,b){var e=15,j="b-region-suggest",h=j+"__elem";SELECTED_CLASS_NAME=j+"__elem_selected";var d={},c={};function a(s,l,o){function q(u){g.each(c[u],function(v,w){w(d[u])});c[u]=null}if(c[l]){c[l].push(o)}else{c[l]=[o];if(d[l]){q(l)}else{window[s]=function(u){d[l]=u;q(l)};var m=document.getElementsByTagName("head")[0],n=document.createElement("script");n.src=l.replace(/callback=\?/,"callback="+s);m.appendChild(n)}}}b.block["b-region-suggest"]=function(T){var y=g(this),M=g('<div class="'+j+'__list"><iframe frameborder="0" class="'+j+"__iframe\" src=\"javascript:'<body style=\\'background:none;overflow:hidden\\'>'\"></iframe><ul class=\""+j+'__items"></ul></div>').hide(),F=M.find("."+j+"__items"),O=y.closest("form").find('input[name="'+(T["for"]||"text")+'"]'),n=y.find('input[type="hidden"]'),N=T.parent?g(T.parent):null,x=T.phone?g(T.phone):null,w=T.url,V,X=T.requestid||w.replace(/^.*\//,"").replace(/\?.*$/,""),D,H,U,m,K=true,G=false,q=false,v;O.blur().attr("autocomplete","off");y.append(M);a(X,w,function(Y){V=Y;if(!N){E();if(T.focus){O.focus()}}S()});function S(){g(document).bind("popupsClose.lego",Q);if(N){N.bind("regionIdChanged",function(aa,Y){if(m!=Y){var Z;if(O.val().match(/\S/)){Z=W(O.val(),Y)}s(Z?Z.id:"",Z?Z.name:"")}m=Y;K||Q()});m=N.data("regionId");B(m)}O.blur(function(){G||Q();var Y=O.val();if(q){if(H&&H.length==1&&H[0].name==Y){u(0)}else{s("",O.attr("value"))}}});F.mousedown(function(Y){G=true}).click(function(Z){var Y=g(Z.target);O.focus();if(Y.is("li *")){l(Y.closest("li").attr("suggest_position"));u(D);Q()}else{G=false}});O.keydown(function(Y){switch(Y.keyCode){case 38:case 40:Y.preventDefault();K?L():z(Y.keyCode-39);break;case 27:G=true;break}}).keypress(function(Y){switch(Y.keyCode){case 13:Y.preventDefault();return false;case 27:l(0);O.focus();Q();return false}}).keyup(function(Z){switch(Z.keyCode){case 13:Z.preventDefault();u(D);Q();return false;default:var Y=O.attr("value").toLowerCase();if(Y!=U){q=true;clearInterval(v);v=setTimeout(L,1)}break}}).bind("regionSuggest.change",function(Y){T.text=O.attr("value");P()})}function C(){var Z=0,aa;H=[];for(var Y=0;Y<V.length;Y++){aa=V[Y];if((aa.name.toLowerCase().indexOf(U)==0)&&(!m||aa.parentId==m)){H.push(aa);if(++Z>=e){break}}}return H}function R(){return g.map(H,function(aa,Z){var Y="<strong>"+aa.name.substring(0,U.length)+"</strong>"+aa.name.substring(U.length);return'<li suggest_position="'+Z+'"><a class="'+h+'">'+Y+"</a></li>"}).join("")}function L(){g(document).trigger("popupsClose.lego");U=O.attr("value").toLowerCase();if(!U.match(/\S/)){Q()}else{C();F[0].innerHTML=R(H);M[H.length?"show":"hide"]();D=-1;K=false}}function Q(){if(K){return}M.hide();K=true;G=false}function z(Y){l(D+Y)}function l(Y){if(!H.length){return}D=Math.min(Math.max(Y,0),H.length-1);F.find("."+SELECTED_CLASS_NAME).removeClass(SELECTED_CLASS_NAME);F.find("."+h+":eq("+D+")").addClass(SELECTED_CLASS_NAME)}function u(Y){if(!Y&&Y!==0){return}if(!H[Y]){return}s(H[Y].id,H[Y].name,H[Y].code)}function s(ab,Z,Y,aa){q=false;O.val(Z||"");O.change();n.attr("value",ab);if(!aa){y.trigger("regionIdChanged",ab)}y.data("regionId",ab);if(x&&!x.val().match(/\S/)&&Y){if(w.match(/cities/)&&Y.match(/^0/)){Y=Y.split(/\s/)[1]}else{Y=Y.split(/\s/)[0]}if(w.match(/countries/)){Y="+"+Y}x.val(Y).change()}U=Z.toLowerCase()}function o(Z){for(var Y=0;Y<V.length;Y++){if(V[Y].id==Z){return V[Y]}}return{}}function I(Y){Y=Y.toLowerCase();for(var Z=0;Z<V.length;Z++){if(V[Z].name.toLowerCase()==Y){return V[Z].id}}}function W(Y,aa){Y=Y.toLowerCase();for(var Z=0;Z<V.length;Z++){if(V[Z].parentId==aa&&V[Z].name.toLowerCase()==Y){return V[Z]}}}function J(Y){Y=Y.toLowerCase();for(var Z=0;Z<V.length;Z++){if(V[Z].name.toLowerCase()==Y){return V[Z]}}}function A(Z){for(var Y=0;Y<V.length;Y++){if(V[Y].id==Z){return V[Y].code}}}function B(aa){T.text=O.val();T.phoneCode=x.val();if(aa&&(T.text||T.id)){var Z=T.id?o(T.id):J(T.text);if(Z){var Y=Z.parentId}if(!aa||Y==aa){aa=Y;T.id=Z.id;T.phoneCode=T.phoneCode||Z.code||"";s(T.id,T.text,T.phoneCode,true);T.id=T.text=T.phoneCode=""}}}function E(){T.text=O.val();if(x){T.phoneCode=x.val()}if(T.text){var Y=J(T.text);if(Y){T.phoneCode=T.phoneCode||Y.code||"";s(Y.id,T.text,T.phoneCode,true)}}T.id=T.text=T.phoneCode=""}function P(){if(T.id&&!T.text){T.text=o(T.id).name}if(T.text&&!T.id){T.id=I(T.text)}if(T.id&&x&&!T.params){T.phoneCode=A(T.id)}s(T.id||"",T.text||"",T.phoneCode||"");T.id=T.text=T.phoneCode=""}}})(jQuery,window.Lego);(function(d){var a={};d.cachedAjax=function(j){var h=d.extend(true,{},jQuery.ajaxSettings,j),l=h.cacheKey,g;if(!l){return d.ajax(j)}g=a[l];if(g&&g.loading){g.s.push(h)}else{if(g){if(h.async){setTimeout(function(){c(g,h)},1)}else{c(g,h)}}else{g=a[l]={loading:true,s:[h],args:{}};g.xhr=d.ajax(d.extend(true,{},h,{complete:function(){g.args.complete=d.makeArray(arguments);e("complete",g);g.loading=false;g.s=[]},success:b("success",g),error:b("error",g),beforeSend:b("beforeSend",g)}))}}return g.xhr};function c(g,h){g.s=[h];d.each(["beforeSend","error","success","complete"],function(){if(g.args[this]){e(this,g)}});g.s=[]}function b(h,g){return function(){g.args[h]=d.makeArray(arguments);e(h,g)}}function e(h,g){d.each(g.s,function(){var j=this.context||this;if(this[h]){this[h].apply(j,g.args[h])}})}})(jQuery);direct.UrlCheck=new function(){this.check=function(a,b){$.cachedAjax({type:"GET",cacheKey:a,url:SCRIPT,data:{cmd:"ajaxCheckUrl",url:a},dataType:"json",success:function(c){b(c)}})}};(function(b,a){a.block["b-banner-form__href"]=function(v){var l=b(this),g=v.model,A=g.href(),B=v.limit,h=v.disable_on_hidden,e=l.find(".b-banner-form__href__href"),c=l.find(".b-banner-form__href__domain"),m=l.find(".b-banner-form__href__domain_sign"),x=l.parents(".b-banner-form__href__container"),u=l.find(".b-banner-form__href__counter"),w=c.hasClass(".b-banner-form__href__domain_input"),d=g.href().domain(),C;z();q();if(!x.length){x=l}g.bind("change.with_href",q);g.href().bind("change",function(D){if(D.source!=l){z();if(D.changes.href){s()}}});var j;e.bind("focus",function(){j=this.value});e.bind("keyup click blur",function(){if(j==this.value){return}j=this.value;var D=b.extractDomain(e.val());if(!d||!w){c.val(D);m.val("")}o();n()});e.bind("blur",function(){s();A.trigger("finishEditing.url")});c.bind("keyup click blur",function(){m.val("");g.href().update({domain:c.val(),domain_sign:m.val()},l);d=this.value});function s(){var D=e.val();if(b.validateHref(D)){C=b.trim(D);g.href().update({domain_error:""});direct.UrlCheck.check(C,y)}}function o(D){g.href().update({domain:c.val(),domain_sign:m.val(),domain_error:"",href:e.val()},l)}function z(){if(g.href().href()!=e.val()){e.val(g.href().href())}if(g.href().domain()!=c.val()){c.val(A.domain())}m.val(g.href().domain_sign());n()}function n(){var D=g.href().href().replace(/\#([^\#]*?)\#/g,"$1").length;u.html(B-D).toggleClass("b-input-counter__counter_overflow_yes",B<D)}function q(){if(h){e.attr("disabled",!g.with_href());c.attr("disabled",!g.with_href())}else{x.toggle(!!g.with_href())}b(window).trigger("js-page-resize")}function y(F){if(F.url!=C){return}if(F.code==1){var D=F.domain,E;if(w&&d&&c.val()){if(c.val()!=D&&g.href().domain_calc()!=D){g.href().update({domain:D,domain_sign:F.domain_sign,domain_error:iget("Видимая ссылка изменилась. Проверьте правильность.")})}}else{g.href().update({domain:D,domain_sign:F.domain_sign})}}else{g.href().update({domain_error:F.text})}}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__copy-clear-link"]=function(d){var l=b(this),h=d.model,j=d.mode?d.mode:"vcard",n=d.prev_model||{};var c=l.find(".copy-link"),e=l.find(".clear-link");if(c.length>0){c.bind("click",g)}if(e.length>0){e.bind("click",m)}function g(o){o.preventDefault();if(j=="all"){h.update(n.getData()).trigger("copy").vcard().trigger("copy")}else{if(n.vcard().isEmpty()&&!confirm(iget("Будет скопирована пустая визитка"))){return false}h.update({with_ci:1,vcard:n.vcard().getData()}).vcard().trigger("copy")}return false}function m(o){o.preventDefault();if(j=="all"){h.clear().trigger("clear").vcard().trigger("clear")}else{h.vcard().clear().trigger("clear")}}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__text"]=function(g){var l=b(this),j=g.model,o=g.fieldName,h=l.find(".b-banner-form__text__"+o+""),c=b(".b-input-counter__counter",l),d=g.limit||0,n=false;h.bind("b-spell-checker-change keyup blur",e);j.bind("change."+o,m);m();function e(){var q={};q[o]=h.val();j.update(q,l)}function m(s){h.val(j[o]());var q=j[o]().replace(/\#([^\#]*?)\#/g,"$1").length;c.html(d-q).toggleClass("b-input-counter__counter_overflow_yes",d<q);if(s&&s.source!=l){h.trigger("change").trigger("b-spell-checker__check")}}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__preview"]=function(A){var q=b(this),g=A.model,h=A.type,w=A.href_default_value,H=A.title_default_value,E=A.body_default_value,I=q.find(".title-link"),x=q.find(".body"),j=q.find(".url-container"),s=q.find(".address-container"),G=q.find(".domain-warning"),d=q.find(".format-warning"),u=q.find(".ukranian-warning"),l=q.find(".length-warning"),e=q.find(".kazakh-warning");C();F();B();D();y();g.bind("change.title",B);g.bind("change.body",D);g.bind("change.href",y);g.bind("change.with_href",C);g.bind("change.with_ci",o);function m(J){J=J||"";return J.replace(/[\s\xA0]{2,}/g," ")}function o(){s.toggleClass("g-hidden",!g.with_ci())}function B(){n(I,g.title()||H);F()}function D(){n(x,g.body()||E);F()}function y(){var J=g.href().domain()||g.href().domain_input()||g.href().href()||w;if(J.length>35){J="..."+J.substr(J.length-35,J.length)}n(j,J);C()}function n(J,K){if(K.length>25){K=v(K);J.html(K)}else{J.text(K)}}function v(O){var Q=25,N=O.replace(/([\s\.\-\/])/g,"$1\u0001").split("\u0001"),P=[],M,J,K,L;O=m(O);for(M=0,J=N.length;M<J;M++){K=N[M];while(K.length>Q){L=Math.min(Q,K.length/2);P.push(K.substring(0,L));K=K.substring(L)}P.push(K)}P=b.map(P,function(R){return(b.escapeHTML(R))});return P.join("<wbr />")}function F(){var K=I.val()+x.val();var J=z(K);if(u){u.toggleClass("g-hidden",J!="uk")}if(e){e.toggleClass("g-hidden",J!="kk")}}function z(J){if(J.match("["+String.fromCharCode(1200,1170,1171,1256,1186,1178,1210,1198,1201,1257,1187,1179,1211,1199,1174,1202,1203,1175,1240,1241)+"]")){return"kk"}else{if(J.match("["+String.fromCharCode(1028,1030,1031,1108,1110,1111,1168,1169)+"]")){return"uk"}else{return""}}}function c(N,J){if(!N||!J){return false}var L=/(www\.)?(.*)/;var K=N.match(L)[2];var M=J.match(L)[2];return(K==M)}function C(){var L=(g.href().domain_calc())?g.href().domain_calc():b.extractDomain(g.href().href());var K=g.href().domain()?(c(L,g.href().domain())||(g.href().domain_ascii()!=""&&c(g.href().domain_ascii(),L))):true;var J=g.href().domain()?b.validateHref(g.href().domain())!=null:true;d.toggleClass("g-hidden",J||!g.with_href());G.toggleClass("g-hidden",K||!g.with_href());var M=g.href().domain()||g.href().domain_input()||g.href().href()||w;l.toggleClass("g-hidden",M.length<=35||!g.with_href());j.toggleClass("g-hidden",!g.with_href())}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__simple-visibility-switcher"]=function(m){var l=b(this),e=m.show_text,h=m.hide_text,c=m.model,g=l.find(".show_ci_link");g.bind("click",d);c.bind("change.ci_hidden",j);function j(n){if(e&&h){g.html("<span>"+(c.ci_hidden()?h:e)+"</span>")}}function d(n){n.preventDefault();c.update({ci_hidden:c.ci_hidden()?0:1},l);return false}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__checkbox-switcher"]=function(j){var o=b(this),l=j.model,n=j.type,m=o.find(".checkbox"),c=o.find(".required");m.click(h);l.bind("change.with_"+e(n),q);l.bind("change.with_"+n,d);d();function h(){var s={};s["with_"+n]=!!m.attr("checked");g(s)}function d(){m.attr("checked",l["with_"+n]()?"checked":"");c.toggleClass("g-hidden",!l["with_"+n]())}function q(){if(!l["with_"+e(n)]()&&!m.attr("checked")){m.attr("checked",1);h()}}function e(s){if(s=="ci"){return"href"}if(s=="href"){return"ci"}}function g(s){if(s.hasOwnProperty("with_ci")){s.ci_hidden=s.with_ci?0:1}l.update({common:s},o)}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__common-visibility-switcher"]=function(g){var m=b(this),h=g.model;var j=m.find(".show_href_link,.b-banner-form__common-visibility-switcher__href"),d=m.find(".show_address_link,.b-banner-form__common-visibility-switcher__vcard"),c=m.find(".show_all_link,.b-banner-form__common-visibility-switcher__all"),o=m.find(".b-banner-form__common-visibility-switcher__with-href"),s=m.find(".b-banner-form__common-visibility-switcher__with-ci");j.bind("click",l);d.bind("click",l);c.bind("click",l);h.bind("change.with_ci",n);h.bind("change.with_href",n);function n(u){if(u.source==m){return}if(h.with_ci()&&h.with_href()){c.attr("checked",true)}else{if(h.with_href()){j.attr("checked",true)}else{d.attr("checked",true)}}q()}function q(){o.val(h.with_href()?1:0);s.val(h.with_ci()?1:0)}function l(){h.update(e(),m);q()}function e(){if(j.attr("checked")){return{with_ci:0,with_href:1,ci_hidden:1}}if(d.attr("checked")){return{with_ci:1,with_href:0,ci_hidden:0}}if(c.attr("checked")){return{with_ci:1,with_href:1,ci_hidden:0}}}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__validator"]=function(g){var n=b(this),d=n.find(".submit"),v=n.find(".submit_back"),c=n.find(".submit_back_input"),j=g.model,m=g.cid,h;setTimeout(function(){h=j.all_phrases()},42);d.click(u);n.submit(u);v.click(function(){c.val(1);n.unbind("submit",u).submit()});function u(){var w=j.getErrorsMessage();if(w){alert(w);return false}if(!l()||!o()){return false}if(q(h,j.all_phrases())){e(true);j.check_minus_words(m,function(x){s(false);if(!x||confirm(x)){n.unbind("submit",u).submit()}e(false)})}else{n.unbind("submit",u).submit()}return false}function q(z,C){if(z.length!=C.length){return true}var A=z.sort(),w=C.sort();for(var B=0;C[B];B++){if(A[B]!==w[B]){return true}}return false}function l(){if(!g.common_ci_set){return true}if(!j.with_ci()||!j.vcard().isEqual(g.common_ci,true,true)){return confirm(iget("Вы изменили контактную информацию! При сохранении установленная ЕДИНАЯ контактная информация будет ОТМЕНЕНА! Сохранить?"))}return true}function o(){if(!g.common_geo_set){return true}if(j.geo()!=g.common_geo){return confirm(iget("Вы изменили регион! При сохранении установленный ранее ЕДИНЫЙ для всех объявлений регион будет ОТМЕНЕН!"))}return true}function e(w){d.attr("disabled",!!w);s(!!w)}function s(w){if(w){d.after('<span class="b-campaign-form__minus-words__progress">'+iget("Идёт проверка на пересечение с едиными минус-словами")+"</span>")}else{b(".b-campaign-form__minus-words__progress").remove()}}}})(jQuery,window.Lego);(function(b,a){var c=3;a.block["b-banner-form__validator-multi"]=function(j){var q=b(this),d=q.find(".submit"),n=j.models,o=j.cid,l;setTimeout(function(){l=h()},42);d.click(w);q.submit(w);function w(){if(!g()){return false}if(!m()||!s()){return false}if(u(l,h())){phrases=h();phrases+="";phrases=phrases.replace(/,/g," ");e(true);direct.formsedit.Banner.check_minus_words(phrases,o,function(x){v(false);if(!x||confirm(x)){q.unbind("submit",w).submit()}e(false)})}else{q.unbind("submit",w).submit()}return false}function h(){var x=[];for(var y in n){if(!n.hasOwnProperty(y)){continue}x=x.concat(n[y].all_phrases()||[])}return x}function u(A,D){if(A.length!=D.length){return true}var B=A.sort(),z=D.sort();for(var C=0;D[C];C++){if(B[C]!==z[C]){return true}}return false}function m(){if(!j.common_ci_set){return true}for(var x in n){if(!n.hasOwnProperty(x)){continue}if(!n[x].with_ci()||!n[x].vcard().isEqual(j.common_ci,true,true)){return confirm(iget("Вы изменили контактную информацию! При сохранении установленная ЕДИНАЯ контактная информация будет ОТМЕНЕНА! Сохранить?"))}}return true}function s(){if(!j.common_geo_set){return true}for(var x in n){if(!n.hasOwnProperty(x)){continue}if(n[x].geo()!=j.common_geo){return confirm(iget("Вы изменили регион! При сохранении установленный ранее ЕДИНЫЙ для всех объявлений регион будет ОТМЕНЕН!"))}}return true}function g(){var z=[];for(var y in n){if(n.hasOwnProperty(y)){var x=n[y].getErrorsMessage();if(x){z.push(iget("В объявлении № M-%s допущены ошибки:",y)+"\n"+x)}}}if(z.length){var A=z.join("\n\n");if(z.length>c){A=z.slice(0,c).join("\n\n")+"\n\n"+common.inflector.pluralize(iget("Также допущены ошибки еще в %d {объявлении|объявлениях|объявлениях}"),z.length-c)}alert(A);return false}return true}function e(x){d.attr("disabled",!!x);v(!!x)}function v(x){if(x){d.after('<span class="b-campaign-form__minus-words__progress">'+iget("Идёт проверка на пересечение с едиными минус-словами")+"</span>")}else{b(".b-campaign-form__minus-words__progress").remove()}}}})(jQuery,window.Lego);(function(b,a){var c=3;a.block["b-banner-form__validator-mediaplan"]=function(y){var m=b(this),F=y.isNewBlock,G=m.find(".b-banner-form__phrases-input"),d=m.find(".b-banner-form__validator-mediaplan-submit"),A=m.find(".b-banner-form__validator-mediaplan-back"),E=m.find(".b-banner-form__validator-mediaplan-action"),v=y.models,n=y.cid;var e=h();var s;var C=q();d.click(D);A.click(g);function h(){var I=0;for(var H in v){I+=1}return I}function q(){var I=[],H=[];for(var K in v){I.push(v[K].allMediaPhrases())}for(var L=0;L<I.length;L++){for(var J=0;J<I[L].length;J++){H.push(I[L][J])}}return H}function l(I,L){if(I.length!=L.length){return true}var J=I.sort(),H=L.sort();for(var K=0;L[K];K++){if(J[K]!==H[K]){return true}}return false}function g(){E.val(F?"createMediaplan":"showMediaplan");m.submit()}function D(){if(!o()){return false}s={};for(var H in v){v[H].bind("load.splitedPhrases",(function(I){return function(){w(I)}})(H));v[H].splitWords()}}function o(){var J=[];for(var I in v){if(v.hasOwnProperty(I)){var H=v[I].getErrorsMessage();if(H){var L=(e>1)?iget("В блоке № П-%s допущены ошибки:",I):iget("В блоке были допущены ошибки:");J.push(L+"\n"+H)}}}if(J.length){var K=J.join("\n\n");if(J.length>c){K=J.slice(0,c).join("\n\n")+"\n\n"+common.inflector.pluralize(iget("Также допущены ошибки еще в %d {объявлении|объявлениях|объявлениях}"),J.length-c)}alert(K);return false}return true}function w(H){v[H].unbind("load.splitedPhrases");s[H]=true;for(var I in v){if(!s[I]){return false}}B();j()}function z(){var J="";for(var I in v){var H=(I*1)?"-"+I:"";J+='<input type="hidden" name="phrases'+H+'" value="'+b.escapeHTML(v[I].allPhrasesForSubmit())+'"></input>'}m.append(b(J))}function j(){for(var H in v){G.val("");v[H].update({common:{new_phrases:""}},m)}}function u(H){if(H){d.attr("disabled",true);x(true)}else{d.attr("disabled",false);x(false)}}function x(H){if(H){d.after('<span class="b-campaign-form__minus-words__progress">'+iget("Идёт проверка на пересечение с едиными минус-словами")+"</span>")}else{b(".b-campaign-form__minus-words__progress").remove()}}function B(){if(l(C,q())){phrases=q();phrases+="";phrases=phrases.replace(/,/g," ");u(true);direct.formsedit.Mediaplan.check_minus_words(phrases,n,function(H){x(false);if(H){if(confirm(H)){z();m.submit()}}else{z();m.submit()}u(false)})}else{z();m.submit()}}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__multiedit"]=function(v){var g=b(this),d=g.parents(".b-bfm__window"),n=d.data("api"),w=v.phrases,x=v.banners_array,e=v.sitelinks_model,u=v.models;var h=[q,m];if(b(".b-bfm__new-domain",g).length){h.push(y)}h.push(z);if(b(".b-bfm__add-minus-words",g).length){h.push(s)}h.push(A);b(".b-bfm__submit",g).click(function(){var B=b(".b-tabs__li_active",g).prevAll(".b-tabs__li",g).length,C=h[B];C()});b(".b-bfm__close",g).click(function(){n.close()});b(n.attachment()).click(function(){n[n.visible()?"close":"open"]()});g.bind("b-tabs.changed",function(){b(".b-tabs__target__li_active .b-bfm__input,.b-tabs__target__li_active .b-bfm__textarea",g).focus().blur()});function o(){var B=b(".b-bfm__new-ogrn",g),C=B.val();if(!C){alert(iget("Введите новый ОГРН/ОГРНИП"));return}if(!b.validateOGRN(C)){alert(iget("Введенный Вами ОГРН/ОГРНИП не корректен"));return}b.each(u,function(E,D){D.update({ogrn:{ogrn_num:C}})});B.val("");n.close()}function q(){var C=b(".b-bfm__new-href",g),D=C.val(),B=b(".b-bfm__replace-domain",g).attr("checked")||b(".b-bfm__replace-domain",g).length==0;if(!D){alert(iget("Введите новую ссылку"));return}if(!b.validateHref(D)){alert(iget("Введенный Вами URL не работает"));return}b.each(u,function(){var E={href:{href:D,domain:B?b.extractDomain(D):undefined},with_href:true};this.update(E);this.sitelinks()&&this.sitelinks().update(E)});C.val("");n.close()}function y(){var B=b(".b-bfm__new-domain",g),C=B.val();if(!C){alert(iget("Введите новый домен"));return}if(!b.validateHref(C)){alert(iget("Введенный Вами URL не работает"));return}b.each(u,function(){this.update({href:{domain:C},with_href:true})});B.val("");n.close()}function m(){var D=b(".b-bfm__href-from",g),E=b(".b-bfm__href-to",g),C=D.val(),J=E.val(),G=C.replace(/([^a-zА-Я0-9])/gi,"\\$1"),B=new RegExp(G,"gi"),I=b(".b-bfm__update-domain",g).attr("checked")||!b(".b-bfm__update-domain",g).length,F=b(".b-bfm__update-sitelinks",g).attr("checked");if(!C){alert(iget("Введите строку для поиска"));return}var H=[];b.each(u,function(N,L){if(L.with_href()&&L.href().href().match(/\S/)){H.push(L.href().href().replace(B,J))}if(F&&L.with_sitelinks()){for(var M=0;M<SITELINKS_NUMBER;M++){if(L.sitelinks()["href"+M]().match(/\S/)){H.push(L.sitelinks()["href"+M]().replace(B,J))}}}});var K=[];b.each(H,function(L,M){if(!b.validateHref(M)){K.push(M)}});if(K.length>0){if(!confirm(iget("После изменения следующие ссылки не будут работать")+": "+K.join(", ")+".\n"+iget("Продолжить?"))){return}}b.each(u,function(N,L){if(!L.with_href()){return}L.update({href:{href:L.href().href().replace(B,J),domain:I?b.extractDomain(H[M]):undefined},with_href:true});if(F&&L.with_sitelinks()){var O={};for(var M=0;M<SITELINKS_NUMBER;M++){if(L.sitelinks()["href"+M]().match(/\S/)){O["href"+M]=L.sitelinks()["href"+M]().replace(B,J)}}L.sitelinks().update(O)}});D.val("");E.val("");n.close()}function z(){var G=b(".b-bfm__text-from",g),C=b(".b-bfm__text-to",g),D=G.val(),F=C.val(),E=D.replace(/([^a-zА-Я0-9])/gi,"\\$1"),B=new RegExp(E,"gi");if(!D){alert(iget("Введите строку для поиска"));return}b.each(u,function(I,H){H.update({common:{title:(H.title()||"").replace(B,F),body:(H.body()||"").replace(B,F)}})});G.val("");C.val("");n.close()}function s(){var D=b(".b-bfm__add-minus-words",g);var B=D.val().split("\r").join(" ");if(!B){alert(iget("Введите минус слова"));return}var N={spaceFlag:0};var M=c(B);if(x&&w){for(var E=0;E<x.length;E++){var K=w[x[E]];for(var C=0;C<K.length;C++){var L=b("[name = ph-"+x[E]+"_"+K[C]+"]");var I=j(L.val(),M,N);if(I.length){if(!L.val().match(/["']/)){L.val(L.val()+" -"+I.join(" -"))}}}}}else{for(var E in u){for(var G in u[E].splitedPhrases){var F=u[E].splitedPhrases[G][0];var J=l(F);var I=j(F,M,N);if(I.length){u[E].setSplitedPhrase(G,F+" -"+I.join(" -"))}}}}if(N.spaceFlag){alert(iget("Минус-слова не могут состоять из нескольких слов!"))}else{if(N.deprecatedWordsHash){var H=iget('Нельзя вычитать слова, содержащиеся в исходной ключевой фразе. Например, нельзя вычитать слово "кино", содержащиеся в исходной ключевой фразе "билет в кино"');for(var F in N.deprecatedWordsHash){H+="\n";H+=iget('Минус-слово "%s" есть в следующих ключевых фразах "%s"',F,N.deprecatedWordsHash[F].join(", "))}alert(H)}else{n.close();D.val("")}}}function A(){if(e.isEmpty()){alert(iget("Введите дополнительные ссылки"));return}var D={with_sitelinks:true,sitelinks:{}},B={};for(var C=0;C<SITELINKS_NUMBER;C++){if(e["title"+C]().match(/\S/)){D.sitelinks["title"+C]=e["title"+C]()}if(e["href"+C]().match(/\S/)){D.sitelinks["href"+C]=e["href"+C]()}B["title"+C]="";B["href"+C]=""}b.each(u,function(F,E){E.update(D)});e.update(B);n.close()}function j(D,B,G){var I=new Array();var F=l(D.split(" -"));var C=F[0].split(" ");for(var E=0;E<B.length;E++){var H=B[E];if(H.indexOf(" ")>-1){G.spaceFlag=1}if(C.indexOf(H)!=-1&&(!G.deprecatedWordsHash||!G.deprecatedWordsHash[H]||b.inArray(D,G.deprecatedWordsHash[H]))){if(!G.deprecatedWordsHash){G.deprecatedWordsHash={}}if(!G.deprecatedWordsHash[H]){G.deprecatedWordsHash[H]=[]}G.deprecatedWordsHash[H].push(D)}else{if(C.indexOf(H)==-1&&H.indexOf(" ")<0&&H!=""){I.push(H)}}}return I}function c(B){var C=B.indexOf(",")>0?B.split(","):B.split(/\s+/);return l(C)}function l(B){return b.map(B,function(C){if(C){return b.trim(C.toLowerCase()).replace(/^-/,"")}})}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__advq"]=function(h){var g=b(this),c=h.model,e=g.find(".b-banner-form__advq-link");e.click(d);window.splitWords=window.splitWords||function(){};function d(l){l.preventDefault();var m=document.location.host.replace(/forum./,"");var j=document.location.protocol+"//"+m+"/registered/main.pl?cmd=wordstat&text=&suffix="+c.bid()+"&key="+key+"&tm="+time+(c.geo()?"&geo="+c.geo():"");b.openWindow(j,"words_window",800,600)}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__phrases"]=function(C){var o=b(this),g=C.model,M=o.find(".b-banner-form__phrases-input"),n=o.find(".b-banner-form__phrases-clear"),l=o.find(".b-banner-form__phrases-split"),h=o.find(".b-banner-form__phrases-new-block"),m={};var w=o.find(".b-banner-form__phrases-declined"),H=o.find(".b-banner-form__phrases-low-ctr"),s=o.find(".b-banner-form__phrases-active");var K=o.find(".b-banner-form__phrases-delete-all");var G;g.bind("load.splitedPhrases",D);g.bind("change.new_phrases",x);g.bind("change.splitedPhrases",A);g.bind("removeSplitedPhrases",d);j();M.keyup(J);M.blur(J);n.click(y);l.click(q);K.click(F);function j(){o.find(".b-banner-form__phrases-keywords").map(function(O){var P=b(this).find(".keyword-input");var N=P.attr("className").match(/keyword-input-((active|declined|low_ctr)\d*)/)[1];B.apply(this,[b(this),N])});K.toggleClass("g-hidden",g.getSplitedPhrasesLength()==0)}function F(){g.removeAllPhrases()}function q(){g.splitWords()}function D(){y();M.val("")}function A(P){if(P.source==o){return}var O=o.find(".keyword-input-"+P.num);if(O.length){O.val(P.value)}else{var N=u(P.value,P.num);h.append(N);B(N,P.num)}K.toggleClass("g-hidden",g.getSplitedPhrasesLength()==0)}function B(O,N){O.find(".keyword-delete").bind("click",{index:N},c);O.find(".keyword-input").bind("change",{index:N},e);O.find(".keyword-adjust").bind("click",{index:N},I);O.find(".keyword-select").bind("click",{index:N},L);m[N]=O}function I(N){N.preventDefault();z(g.getSplitedPhrase(N.data.index),g.geo(),"","",1,N.data.index);return false}function z(R,Q,N,T,P,O){var S=E(O);S.find("[name=text]").val(R);S.find("[name=geo]").val(Q);S.find("[name=tm]").val(N);S.find("[name=key]").val(T);S.find("[name=minus]").val(P);S.find("[name=name]").val(O);var U=create_standard_window("","Words");S.submit();if(navigator.appName=="Netscape"){U.focus()}}function E(){if(G){return G}G=b('<form method="POST" target="Words"><input type="hidden" name="cmd" value="wordstat"></input><input type="hidden" name="text"></input><input type="hidden" name="suffix" value="'+g.bid()+'"></input><input type="hidden" name="key"></input><input type="hidden" name="tm"></input><input type="hidden" name="geo"></input><input type="hidden" name="minus"></input><input type="hidden" name="name"></input></form>');G.appendTo(b(document.body));return G}function L(N){N.preventDefault();z(g.getSplitedPhrase(N.data.index),g.geo(),time,key,"");return false}function e(O){O.preventDefault();var N=O.data.index;g.setSplitedPhrase(N,this.value,o);return false}function d(O){var P=O.phrasesNums;for(var N=0;N<P.length;N++){m[P[N]].remove()}if(o.find(".b-banner-form__phrases__declined-phrase").length==0){w.hide()}if(o.find(".b-banner-form__phrases__active-phrase").length==0){s.hide()}if(o.find(".b-banner-form__phrases__low_ctr-phrase").length==0){H.hide()}K.toggleClass("g-hidden",g.getSplitedPhrasesLength()==0)}function c(O){O.preventDefault();var N=O.data.index;g.removeSplitedPhrase(N,o);return false}function u(O,N){return b('<table class="b-pf__action-c b-banner-form__phrases-keywords"><tbody><tr><td style="width: 15px; padding: 0.4em;"><a border="0" href="#" class="keyword-delete"><img width="13" height="13" border="0" src="/i/i-delete.gif" alt="'+iget("Удалить фразу")+'" id="del0"/></a></td><td class="b-pf__action__input-c"><input type="text" value="'+direct.utils.escapeHTML(O)+'" class="keyword-input keyword-input-'+N+' b-pf__input b-pf__action__input"/></td><td class="b-pf__action__action-c"><span class="b-pf__action"><a href="#" class=" keyword-adjust">'+iget("Уточнить")+'</a></span></td><td class="b-pf__action__action-c"><span class="b-pf__action"><a href="#" class="keyword-select">'+iget("Подобрать")+"</a></span></td></tr></tbody></table>")}function y(){M.val("");v("")}function J(){v(M.val())}function x(N){if(N.source==o){return}M.val(g.new_phrases())}function v(N){g.update({common:{new_phrases:N}},o)}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__rubrics"]=function(w){window.b_banner_form__rubrics=true;var m=b(this),g=w.model,A=m.find(".b-banner-form__rubrics-select-link"),l=m.find(".b-banner-form__rubrics-clear-link"),q=m.find(".b-banner-form__rubrics-clear-div"),u=m.find(".b-banner-form__rubrics-text"),z=m.find(".b-banner-form__rubrics-choosed"),c=m.find(".b-banner-form__rubrics-unchecked"),B=m.find(".b-banner-form__rubrics-downtshow");A.click(h);l.click(e);B.click(j);var d;g.bind("change.rubrics",x);g.bind("change.DontShowCatalog",o);function h(C){C.preventDefault();v()}function o(){var C=g.DontShowCatalog()=="Yes"?1:0;B.attr("checked",C);n(C)}function n(C){l.toggleClass("g-hidden",C);z.val(C?"":g.ChoosedCategories());c.val(C?"":g.UncheckedCategories());u.html(C?"":g.text_rubrics())}function j(){g.update({common:{DontShowCatalog:this.checked?"Yes":""}});n(this.checked)}function x(C){u.html(g.text_rubrics());z.val(g.ChoosedCategories());c.val(g.UncheckedCategories());s(true)}function e(E){E.preventDefault();var D=g.UncheckedCategories();var C=g.ChoosedCategories();g.update({common:{text_rubrics:"",ChoosedCategories:"",UncheckedCategories:D?D+", "+C:C}});s(false)}function s(C){q.toggleClass("g-hidden",!C)}function v(){var D=y(),C=g.getChoosedCategories?g.getChoosedCategories():g.ChoosedCategories();D.find("[name=ChoosedCategories]").val(C);D.find("[name=UncheckedCategories]").val(g.UncheckedCategories());if(b.isFunction(g.allPhrases)){D.find("[name=phrases]").val(g.allPhrases())}else{D.find("[name=phrases]").val(g.all_phrases())}OpenWindow("/registered/main.pl?cmd=showRubrics&rubrics="+C,700,600,"catalog_choose");D.submit()}function y(){if(C){return C}var C=b('<form  method="post" target="catalog_choose"><input type="hidden" name="cmd" value="showRubrics"><input type="hidden" name="ChoosedCategories"><input type="hidden" name="UncheckedCategories"><input type="hidden" name="phrases"><input type="hidden" name="bid" value="'+g.bid()+'"></form>');C.appendTo(b(document.body));return C}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__suggestions"]=function(h){var o=b(this),m=h.model,d=h.urlSuggestionHref,n=h.phrasesSuggestionHref,s=o.find(".b-banner-form__suggestions-url"),g=o.find(".b-banner-form__suggestions-phrases");var c,e;s.click(q);g.click(l);function l(u){u.preventDefault();e=window.open(n+"&bid="+m.bid(),"popupSuggestions","width=700,height=500,status=yes,menubar=no,resizable=yes,scrollbars=1");e.focus();return false}function q(u){u.preventDefault();if(m.getModel("href").href()!=""){j()}else{alert(iget("Не указан адрес сайта"))}return false}function j(){c=window.open(d+"&bid="+m.bid(),"popupUrlSuggestions","width=700,height=500,status=yes,menubar=no,resizable=yes,scrollbars=1");c.focus()}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__sitelinks"]=function(l){var q=b(this),g=l.model,m=g.sitelinks(),e=b(".b-banner-form__sitelinks__title",q),s=b(".b-banner-form__sitelinks__href",q),o=b(".b-banner-form__sitelinks__title-counter",q),j=b(".b-banner-form__sitelinks__href-counter",q),n=b(".b-banner-form__sitelinks__clear",q),w=[];c();m.bind("change",c);m.bind("change",function(y){if(y.source==q){return}for(var x=0;x<SITELINKS_NUMBER;x++){e.eq(x).val(m["title"+x]());s.eq(x).val(m["href"+x]());d(x,m["href"+x]())}});e.bind("keyup blur change",function(){var x={},y=b(this).data("index");x["title"+y]=this.value;m.update(x,q)});s.bind("keyup blur change",function(A){var x={},z=b(this).data("index"),y=m["href"+z]();x["href"+z]=this.value;m.update(x,q);if(y!=this.value){v(z)}if(A.type=="blur"){d(z,this.value)}});s.each(function(x){b(this).data("index",x)});e.each(function(x){b(this).data("index",x)});n.click(function(){var x={};for(var y=0;y<SITELINKS_NUMBER;y++){x["title"+y]="";x["href"+y]=""}m.update(x,null)});if(!l.skipSameOriginCheck){g.href().bind("change",function(){for(var x=0;x<SITELINKS_NUMBER;x++){if(w[x]&&w[x].type=="origin"){v(x)}}})}function v(x){if(w[x]){w[x].dom.remove();w[x]=null}}function h(x,z,y){v(x);w[x]={dom:b('<div class="b-banner-form__sitelinks__error">'+z+"</div>"),type:y};s.eq(x).parents(".b-banner-form__sitelinks__value:eq(0)").append(w[x].dom)}function d(y,x){v(y);if(!x.match(/\S/)){return}if(b.validateHref(x)){direct.UrlCheck.check(x,function(z){u(y,z)})}else{h(y,iget("Адрес сайта не указан или указан неверно"),"validity")}}function u(x,y){if(y.url==m["href"+x]()&&!y.code){h(x,y.text,"noresponce")}else{if(y.code&&("."+y.domain).indexOf("."+g.href().domain_calc())==-1&&("."+y.domain).indexOf("."+g.href().domain())==-1){if(!l.skipSameOriginCheck){h(x,iget("Ссылка не ведет на страницу основного сайта"),"origin")}}}}function c(){var x=m.totalTitleLength();for(var y=0;y<SITELINKS_NUMBER;y++){o.eq(y).html(b.trim(m["title"+y]()).length+"/"+(SITELINKS_MAX_LENGTH-x)).toggleClass("b-input-counter__counter_overflow_yes",SITELINKS_MAX_LENGTH<x);j.eq(y).html(MAX_URL_LENGTH-b.trim(m["href"+y]()).length).toggleClass("b-input-counter__counter_overflow_yes",MAX_URL_LENGTH<b.trim(m["href"+y]()).length)}n.toggleClass("b-banner-form__sitelinks__clear_state_off",m.isEmpty())}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__sitelinks__loader"]=function(j){var g=b(this),h,d=j.model;l();d.bind("change.with_sitelinks",l);d.bind("change.with_href",l);g.click(function(){if(!d.with_href()){return}d.update({with_sitelinks:!d.with_sitelinks()})});function l(){e()[0].style.display=d.with_sitelinks()&&d.with_href()?"":"none";if(b.browser.msie&&j.refresh_ie){var m=e()[0].parentNode;m.removeChild(e()[0]);m.appendChild(e()[0])}c()}function c(){var n=e().is(":visible")&&e().css("display")!="none",m=n?iget("скрыть дополнительные ссылки"):iget("дополнительные ссылки");g.html("<span>"+m+"</span>").toggleClass("b-banner-form__sitelinks__loader_hlt_on",n||!d.sitelinks().isEmpty()).toggleClass("b-banner-form__sitelinks__loader_disabled_on",!d.with_href())}function e(){if(h){return h}return h=g.parents("table").find(".b-banner-form__sitelinks__container")}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__sitelinks__copy"]=function(c){b(this).click(function(){c.model.sitelinks().update(c.prev_model.sitelinks().getData())})}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__domain-toggle"]=function(c){b(this).click(function(){var d=b(this).parents("table:eq(0)").find(".b-banner-form__href__domain-input-c")[0],e=d.style.display!="none";d.style.display=e?"none":"";this.innerHTML=this.innerHTML.replace(/[+-]/,!e?"-":"+");b(window).trigger("js-page-resize")})}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__ogrn"]=function(g){var n=b(this),j=g.model.vcard().ogrn(),c=n.find(".b-banner-form__ogrn__select-box"),d=n.find(".b-banner-form__ogrn__input"),m=n.find(".b-banner-form__ogrn-error");j.bind("change",function(s){if(s.source!=n){o()}});d.blur(function(){h();q()});c.change(function(){h();e();if(!c.val()){d.select()}});j.saveState();e();l();h();function l(){if(c.length&&c.attr("options").length==2&&!d.val()&&g.model.vcard().isEmpty()){c.attr("selectedIndex",1).change();direct.formsedit.OGRNModel.prototype._ogrn_num=j.ogrn_num()}}function h(){j.update({ogrn_num:c.val()?c.find("> :selected").text():d.val(),org_details_id:c.val()},n)}function o(){c.val(j.org_details_id());e()}function e(){d.val(c.val()?"":(j.ogrn_num()||"")).toggleClass("g-hidden",!!c.val());q()}function q(){var s=d.val()&&!b.validateOGRN(d.val());m.text(s?iget("Введен неверный ОГРН/ОГРНИП"):"").toggleClass("g-hidden",!s)}}})(jQuery,window.Lego);(function(b,a){a.block["b-vcard-form"]=function(w){var n=b(this),g=n[0].nextSibling,j=w.model,D=false,y,s=b(".b-vcard__extra__counter",n),C=w.limit||200;var c=["country_code","city_code","phone","ext","name","ci_name","contactperson","contact_email","im_login","geo_id"],d=["im_client"],l=["extra_message"];var h={};for(y=0;y<c.length;y++){h[c[y]]=n.find("."+c[y]);h[c[y]].bind("change  blur",{name:c[y]},E)}var v=n.find(".address_message");var q={};for(y=0;y<d.length;y++){q[d[y]]={};q[d[y]].control=n.find("."+d[y]);q[d[y]].options=q[d[y]].control.find("option");q[d[y]].control.bind("change  blur",{name:d[y]},E)}var e={};for(y=0;y<l.length;y++){e[l[y]]=n.find("."+l[y]);e[l[y]].bind("change blur keyup",{name:l[y]},E)}j.vcard().bind("change",A);j.bind("change.ci_hidden",m);o();function m(F){if(b.browser.msie){g.parentNode.removeChild(n[0]);n.toggleClass("g-hidden",j.ci_hidden());g.parentNode.insertBefore(n[0],g)}else{n.toggleClass("g-hidden",j.ci_hidden())}b(window).trigger("js-page-resize")}function E(G){var F=G.data.name;var H={};H[F]=b(this).val();u(H);if(F=="extra_message"){o()}}function u(F){j.update({vcard:F},n)}function B(G){var F=0;for(F=0;F<c.length;F++){if((G.hasOwnProperty(c[F]))&&h[c[F]]){h[c[F]].attr("value",j.models.vcard[c[F]]()||"")}}}function x(G){var F=0;for(F=0;F<l.length;F++){if(G.hasOwnProperty(l[F])&&e[l[F]]){e[l[F]].attr("value",j.models.vcard[l[F]]()||"")}}o()}function z(H){var G,F;for(G=0;G<d.length;G++){if((H.hasOwnProperty(d[G]))&&q[d[G]]){var I=j[d[G]]||0;q[d[G]].options.each(function(J){if(this.value==j.models.vcard[d[G]]()){F=J}});q[d[G]].control.attr("selectedIndex",F)}}}function A(F){if(F.source==n){return}B(F.changes);z(F.changes);x(F.changes)}function o(){var F=(j.vcard().extra_message()||"").length;s.html(C-F).toggleClass("b-input-counter__counter_overflow_yes",C<F)}}})(jQuery,window.Lego);(function(b,a){a.block["b-vcard-form__worktime"]=function(W){var u=b(this),e=W.model,q,E=u.find(".all_day"),J=[],g=[],w=(new direct.formsedit.VCardModel()).worktime(),j=[0,0,"0","00","0","00"],S=u.find(".worktime");e.vcard().bind("change.worktime",M);var c=(iget("пн")+" "+iget("вт")+" "+iget("ср")+" "+iget("чт")+" "+iget("пт")+" "+iget("сб")+" "+iget("вс")).split(" ");var h=[];var L=[];var X="00 15 30 45".split(" ");for(var T=0,P=c.length;T<P;T++){c[T]={text:c[T],value:T}}for(T=0;T<24;T++){h[T]={text:T>9?T:"0"+T,value:T};L[T]={text:T>8?(T+1):"0"+(T+1),value:(T==23)?0:(T+1)}}for(var T=0,P=X.length;T<P;T++){X[T]={text:X[T],value:X[T]}}R();function R(){q=b('<div class="content"></div>');u.append(q);var Z=S.val();if(Z){var l=G(Z)}else{var l=G(w);S.val(w)}H(l)}function z(ab){var ac=J[ab];for(var aa=2,Z=ac.length;aa<Z;aa++){ac[aa]=j[aa]}H(J)}function d(l){var Z=J[l];Z[0]=0;Z[1]=6;H([J[0]])}function Q(Z,l){var aa={node:Z,selects:Z.find("select"),plus:Z.find(".plus"),minus:Z.find(".minus"),all_day:Z.find(".all_day"),all_week:Z.find(".all_week")};g.push(aa);if(l>0){aa.all_week.hide()}V(l)}function F(){for(T=0;T<g.length;T++){V(T)}}function y(Z){var l=g.length;var ab=l-Z;if(ab<0){for(var aa=l;aa<Z;aa++){var ac=D();Q(ac,aa);q.append(ac)}}else{for(var aa=Z;aa<l;aa++){g[aa].node.remove()}g=g.slice(0,Z)}}function D(ac,ab){ac=ac||c;ab=ab||{};var Z={from:A("day_from","day_from",c,ab[0]),to:A("day_to","day_to",ac,ab[1])};var l={from:A("hour_from","hour_from",h,ab[2]),to:A("hour_to","hour_to",L,ab[4])};var aa={from:A("minute_from","minute_from",X,ab[3]),to:A("minute_to","minute_to",X,ab[5])};return N(Z,l,aa)}function m(ab){J=[].concat(ab);if(ab.length==g.length){for(var aa=0,Z=ab.length;aa<Z;aa++){var ad=g[aa];var ac=ab[aa];b.each(ad.selects,function(l){b(this).val(ac[l])});O(aa);x(aa)}s()}else{y.call(this,ab.length);m.call(this,ab)}}function o(l){var aa=c.slice(l[0]);var Z=D(aa,l);Q(Z,g.length);q.append(Z)}function H(l){m(l);Y(l)}function n(){e.update({vcard:{worktime:S.val()}},u)}function Y(l){var Z=b.map(l,function(aa){return aa.join("#")}).join(";");S.val(Z);n()}function G(l){l=l||w;if(l){return b.map(l.split(";"),function(Z){return[Z.split("#")]})}}function M(Z){if(Z.source==u){return}S.val(e.getModel("vcard").worktime()||w);var l=G(e.getModel("vcard").worktime());m(l)}function U(Z,aa){var l=b(Z);l.empty();b.each(aa,function(ab,ac){l.append(b("<option value="+ac.value+">"+ac.text+"</option>"))})}function A(Z,l,aa,ac){var ab=b('<select name="'+Z+'" class="'+l+'" tabindex="1"></select>');b.each(aa,function(ad,af){var ae=(ac==af.value)?"selected":"";ab.append(b("<option "+ae+" value="+af.value+">"+af.text+"</option>"))});return ab}function N(aa,l,ab){var Z=b('<div class="date"></div>').append('<label class="day_from">&#1089;<span class="all_week"> <span>'+iget("ежедневно")+"</span></span></label>").append(aa.from).append('<label class="day_to">&#1087;&#1086;</label>').append(aa.to);var ac=b('<div class="time">').append('<img src="/i/i_clock.gif" width="10" height="10"></img>').append(l.from).append(" : ").append(ab.from).append("&mdash;").append(l.to).append(" : ").append(ab.to).append('<div class="all_day"><span>'+iget("круглосуточно")+"</span></div>");return b('<div class="work_period"></div>').append(Z).append(ac).append('<div class="controls"><span class="minus" tabindex="1">&minus;</span><span class="plus" tabindex="1">+</span></div>').append('<div class="clear"></div>')}function v(Z,l){J[Z][l]=g[Z].selects[l].value;s();if(l==0){O(Z)}else{if(l==4){x(Z)}}Y(J)}function V(ac){for(var aa=0,Z=g[ac].selects.length;aa<Z;aa++){var ab=g[ac].selects[aa];b(ab).unbind("change");b(ab).bind("change",function(ad,l){return function(){v(ad,l)}}(ac,aa))}g[ac].all_day.unbind("click");g[ac].all_day.bind("click",function(){z(ac)});g[ac].all_week.unbind("click");g[ac].all_week.click(function(){d(ac)});g[ac].minus.unbind("click");g[ac].minus.bind("click",function(){C(ac)});g[ac].plus.unbind("click");g[ac].plus.bind("click",I)}function C(ad){g[ad].node.remove();var ac=[],Z=[];for(var ab=0,aa=g.length;ab<aa;ab++){if(ad!=ab){ac.push(g[ab]);Z.push(J[ab])}}g=ac;J=Z;if(ad==0){g[0].all_week.css("display","")}s();F();Y(J)}function K(){var Z=0;for(var l=0;l<J.length;l++){Z+=J[l][1]*1-J[l][0]*1+1}return(Z<7)}function s(){var l=g.length;for(var aa=0;aa<l-1;aa++){g[aa].plus.addClass("g-hidden")}var Z=!K();g[l-1].plus.toggleClass("g-hidden",Z);g[0].minus.toggleClass("g-hidden",l<2)}function O(ab){var aa=g[ab];var l=c.slice(J[ab][0]);var Z=J[ab][1]-(c.length-l.length);U(aa.selects[1],l);if(J[ab][1]>=J[ab][0]){aa.selects[1].selectedIndex=Z}else{aa.selects[1].selectedIndex=0;J[ab][1]=J[ab][0]}}function x(ab){var aa=g[ab];var l=(J[ab][4]==0)?[X[0]]:X;var Z=(J[ab][4]==0)?0:aa.selects[5].selectedIndex;U(aa.selects[5],l);if(J[ab][5]>0&&J[ab][4]==0){aa.selects[5].selectedIndex=Z;J[ab][5]=0}else{aa.selects[5].selectedIndex=Z}}function B(){var ac=[0,0,0,0,0,0,0],ab=0,ad=0,aa=0;for(var Z=0;Z<J.length;Z++){for(var l=J[Z][0];l<=J[Z][1];l++){ac[l]=1}}aa=-100;for(var Z=0;Z<7;Z++){if(!ac[Z]){if(aa==Z-1){ad=Z}else{ab=Z}aa=Z}}if(ab>ad){ad=ab}return[ab,ad]}function I(){var l=g.length;var Z=[0,0,10,"00",18,"00"];var aa=B();Z[0]=aa[0];Z[1]=aa[1];o(Z);J.push(Z);Y(J);s()}}})(jQuery,window.Lego);(function(b,a){var c=1;a.block["b-vcard-form__address"]=function(h){var g=b(this),j=false,d=h.model.vcard(),e={};b("input[class*=b-vcard-form__address__]",g).each(function(){b(this).data("model_field",this.className.match(/b-vcard-form__address__(\w+)/)[1]);e[b(this).data("model_field")]=this}).bind("blur change",function(){var l={};l[b(this).data("model_field")]=this.value;d.update(l,g)}).blur(function(){j=false;setTimeout(function(){if(!j){g.triggerHandler("blur");d.trigger("finishEditing.address")}},c)}).focus(function(){if(!j){g.triggerHandler("focus");d.trigger("startEditing.address")}j=true});d.bind("change",function(l){if(l.source==g){return}b.each(e,function(n,m){if(l.changes[n]){m.value=d[n]()}})})}})(jQuery,window.Lego);(function(){var self=direct.formsedit.Address=function(data){this.update(data||{})};self.instances={};self.forVCard=function(vcard,cid,ulogin){var key=getModelKey(vcard);if(!vcard.country()||!vcard.city()||!vcard.street()||!vcard.city()||!vcard.country()){return null}if(!self.instances[key]){self.instances[key]=new direct.formsedit.Address({country:vcard.country(),city:vcard.city(),street:vcard.street(),house:vcard.house(),build:vcard.build(),cid:cid,ulogin:ulogin})}return self.instances[key]};self.prototype=$.extend({},direct.formsedit.Model,new function(){this.self=self;this.inputFields=["country","city","street","house","build","manual_point","manual_bounds","auto_point","auto_bounds","auto_precision","request_status","cid","ulogin"];direct.formsedit.Model.addProps(this,this.inputFields);this._country=this._city=this._street=this._house=this._build=this._manual_point=this._manual_bounds=this._auto_point=this._auto_bounds=this._auto_precision=this._cid=this._ulogin="";this._request_status="success";this.key=function(){return getModelKey(this)};this.findPoint=function(callback){if(this.auto_bounds()){callback(this)}else{if(this._loading){this._callbacks.push(callback)}else{this._loading=true;this._callbacks=[callback];$.ajax({type:"POST",url:"/registered/main.pl",dataType:"text",data:{cmd:"ajaxValidateStreet",cid:this.cid(),ulogin:this.ulogin(),country:this.country()||"",city:this.city()||"",street:this.street()||"",house:this.house()||"",build:this.build()||""},complete:$.proxy(function(xhr,s){if(s=="success"){try{var data=eval("("+xhr.responseText+")");this.update({request_status:"success",auto_precision:data.auto_precision,auto_bounds:data.auto_bounds,auto_point:data.auto_point,manual_point:data.manual_point,manual_bounds:data.manual_bounds},self)}catch(e){this.update({request_status:"invalid"},self)}}else{this.update({request_status:s},self)}delete this._loading;var _this=this;$.each(this._callbacks,function(i,callback){callback(_this)});delete this._callbacks},this)})}}};this.isLoaded=function(){return !!this.auto_precision()||this.request_status()!="success"};this.isManual=function(){return !!this.manual_point()&&this.auto_point()!=this.manual_point()};this.manual_point_ymaps=function(){var parts=this.manual_point().split(",");return this.manual_point()&&new YMaps.GeoPoint(parts[0],parts[1])};this.auto_point_ymaps=function(){var parts=this.auto_point().split(",");return this.auto_point()&&new YMaps.GeoPoint(parts[0],parts[1])};this.point_ymaps=function(){return this.manual_point_ymaps()||this.auto_point_ymaps()};this.point=function(){return this.manual_point()||this.auto_point()};this.manual_bounds_ymaps=function(){var parts=this.manual_bounds().split(",");return this.manual_bounds()&&new YMaps.GeoBounds(new YMaps.GeoPoint(parts[0],parts[1]),new YMaps.GeoPoint(parts[2],parts[3]))};this.auto_bounds_ymaps=function(){var parts=this.auto_bounds().split(",");return this.auto_bounds()&&new YMaps.GeoBounds(new YMaps.GeoPoint(parts[0],parts[1]),new YMaps.GeoPoint(parts[2],parts[3]))};this.bounds_ymaps=function(){return this.manual_bounds_ymaps()||this.auto_bounds_ymaps()};this.bounds=function(){return this.manual_bounds()||this.auto_bounds()}});var ADDRESS_STREET_PREFIXES_RE=new RegExp("(^|\\s|[.,])("+ADDRESS_STREET_PREFIXES+")($|\\s|[.,])");function getModelKey(model){var street=model.street();if(!ADDRESS_STREET_PREFIXES_RE.test(street)){street=iget("ул.")+street}return[model.country(),model.city(),street,model.house(),model.build()].join(",")}})();(function(c,a){var b={exact:iget("определено с точностью до дома"),number:iget("определено с точностью до дома, корпус не найден"),near:iget("определено с точностью до дома, корпус не найден"),street:iget("определено с точностью до улицы"),manual:iget("установлено вручную"),error:iget("ошибка при определении адреса; попробуйте сохранить изменения и заново открыть страницу редактирования"),empty:iget("не определено"),other:iget("не определено, адрес не найден")};a.block["b-vcard-form__map"]=function(E){var w=c(this),H=c(".b-vcard-form__map__container",w),D=c(".b-vcard-form__map__result",w),u=c(".b-vcard-form__map__map",w),l=c(".b-vcard-form__map__close",w),o=c(".b-vcard-form__map__clear",w),e=c(".b-vcard-form__map__refine",w),s=c(".b-vcard-form__map__position",w),d=c(".b-vcard-form__map__move-to-found",w),q=c(".b-vcard-form__map__auto-bounds-hidden",w),j=c(".b-vcard-form__map__auto-point-hidden",w),I=c(".b-vcard-form__map__auto-precision-hidden",w),J=c(".b-vcard-form__map__manual-bounds-hidden",w),h=c(".b-vcard-form__map__manual-point-hidden",w),O,M,y=E.cid,B=E.ulogin,n=E.model.vcard(),A=E.models,P=E.isMediaplan,x=direct.formsedit.Address.forVCard(n,y,B),g;x&&x.update({auto_bounds:n.auto_bounds(),auto_point:n.auto_point(),auto_precision:n.auto_precision(),manual_bounds:n.manual_bounds(),manual_point:n.manual_point()});L(x);K();n.bind("finishEditing.address finishEditing.city finishEditing.country change copy clear",function(R){if(R&&R.source==w){return}if(R&&!R.changes.auto_point&&!R.changes.manual_point){return}var Q=direct.formsedit.Address.forVCard(n,y,B);g=null;if(Q!=x){if(x&&x.isManual()&&Q&&!P){G(true);Q.findPoint(function(){G(false);g=Q.getData();Q.update(x.getData());L(Q);K()});return}L(Q)}K()});e.click(function(){z(true);K()});o.click(function(){x.update({manual_point:"",manual_bounds:""},w);K()});d.click(function(){x.update(g,w);g=null;K()});l.click(function(){z(false)});function m(Q){if(Q.source==w||Q.source==direct.formsedit.Address){return}g=null;K()}function v(Q){g=null;x.update({manual_point:Q.getGeoPoint().toString(),manual_bounds:[O.getBounds().getLeftBottom().toString(),O.getBounds().getRightTop().toString()].join(",")},w);K(true)}function L(Q){if(x){x.unbind("change",m)}x=Q;if(x){x.bind("change",m)}}function z(Q){w.toggleClass("b-vcard-form__map_open_yes",!!Q).toggleClass("b-vcard-form__map_open_no",!Q)}function G(Q){w.toggleClass("b-vcard-form__map_loading_yes",!!Q)}function C(){if(!w.hasClass("b-vcard-form__map_open_yes")){return}if(!O){O=new YMaps.Map(u[0]);O.addControl(new YMaps.SmallZoom(),new YMaps.ControlPosition(YMaps.ControlPosition.TOP_LEFT));O.addControl(new YMaps.TypeControl());M=new YMaps.Placemark(new YMaps.GeoPoint(0,0),{draggable:1,hasBalloon:0,style:"plain#greenPoint"});M.setIconContent(iget("Передвиньте метку"));O.addOverlay(M);YMaps.Events.observe(M,M.Events.DragEnd,v,this)}setTimeout(function(){O.setBounds(x.bounds_ymaps());M.setGeoPoint(x.point_ymaps())},100)}function K(Q){if(x&&!x.isLoaded()){G(true);x.findPoint(function(R){G(false);if(R!=x){return}N(Q)})}else{N(Q)}}function N(S){var R=!x?"empty":x.request_status()!="success"?"error":x.isManual()?"manual":x.auto_precision(),Q=!x?"empty":x.request_status()!="success"?"error":x.isManual()||x.auto_precision()=="exact"?"ok":"near";D.html(b[R]||b.other);w[0].className=w[0].className.replace(/b-vcard-form__map_status_\w+/,"b-vcard-form__map_status_"+Q);if(Q=="empty"||Q=="error"){z(false)}else{if(w.hasClass("b-vcard-form__map_open_yes")){F()}e.html(x.isManual()?iget("уточнить положение"):iget("установить вручную"));w.toggleClass("b-vcard-form__map_warning_yes",!!g)}J.val(x&&x.isManual()&&x.manual_bounds()||"");h.val(x&&x.isManual()&&x.manual_point()||"");q.val(x&&x.auto_bounds()||"");j.val(x&&x.auto_point()||"");I.val(x&&x.auto_precision()||"");n.manual_bounds(J.val());n.manual_point(h.val());n.auto_bounds(q.val());n.auto_point(j.val());n.auto_precision(I.val());if(!S){C()}}function F(){if(!g&&x.isManual()){s.html(iget("в")+" "+YMaps.humanDistance(x.manual_point_ymaps().distance(x.auto_point_ymaps()))+" "+iget("от найденной точки"));o.html(iget("вернуть в найденную точку"));w.addClass("b-vcard-form__map_moved_yes")}else{w.removeClass("b-vcard-form__map_moved_yes")}}}})(jQuery,window.Lego);(function(b,a){a.block["b-vcard-form__place"]=function(l){var j=b(this),c=b(".b-vcard-form__place__country",j),h=b(".b-vcard-form__place__country-suggest",j),g=b(".b-vcard-form__place__city",j),e=b(".b-vcard-form__place__city-suggest",j),d=l.model.vcard();h.bind("regionIdChanged",function(){d.update({country:c.val()},j).trigger("finishEditing.country")});e.bind("regionIdChanged",function(){d.update({city:g.val()},j).trigger("finishEditing.city")});d.bind("change.country",function(m){if(m.source!=j){c.val(d.country()).change()}});d.bind("change.city",function(m){if(m.source!=j){g.val(d.city()).change()}})}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-form__dont-show-catalog-all"]=function(j){var h=b(this),g=j.models,c=h.find(".dont-show-catalog-all-checkbox");c.click(d);l();function l(){if(g){for(var m in g){g[m].bind("change.DontShowCatalog",e)}}}function e(o){if(o.source==h){return}var n=false;if(g){for(var m in g){n=n&&g[m].DontShowCatalog()=="Yes"}}c.attr("checked",n)}function d(o){var n=this.checked?"Yes":"";if(g){for(var m in g){g[m].update({common:{DontShowCatalog:n}},h)}}}}})(jQuery,window.Lego);(function(b,a){a.block["b-prices-edit"]=function(o){var m=o.priceModel,g=b(this),u=o.multi?g.find(".b-prices-edit-summ-shows"):b(".b-prices-edit-summ-shows"),x=o.multi?g.find(".b-prices-edit-summ-budget"):b(".b-prices-edit-summ-budget"),w=o.multi?g.find(".b-prices-edit-ctr"):b(".b-prices-edit-ctr"),c=g.find(".b-prices-edit-phrase-hidden"),j=g.find(".b-prices-edit-ungluedsuffixes"),z=g.find(".b-prices-edit-switch-word");m.bind("change.unglued",d);m.bind("change.place",v);z.map(function(A){b(this).bind("click",{index:A},n)});var l,e,s;q();h();function n(B){var C=B.data.index;var A=b(this).parent().parent();if(m.getIsActive(C)){A[0].className="tdata";b(this).attr("src","/i/i-close2.gif");b(this).attr("alt",iget("Выключить слово"));b(this).attr("title",iget("Выключить слово"));m.setIsActive(C,0)}else{A[0].className="tdisabled";b(this).attr("src","/i/i-active.gif");b(this).attr("alt",iget("Включить слово"));b(this).attr("title",iget("Включить слово"));m.setIsActive(C,1)}h()}function h(){u.html(m.getSummShows());x.html(m.getSummBudget());w.html(m.getCTR())}function d(C){var A=m.unglued();j.toggleClass("g-hidden",!A);var B=(A)?m.getPhrasesWithUngluedSuffix():m.getPhrases();b.each(c,function(D){b(this).val(B[D])})}function v(B){h();if(B.source==g){return}var A=(B.placeNum==3)?s:(B.placeNum==2)?e:l;if(B.phraseNum){A.get(B.phraseNum).checked=true}else{A.attr("checked",true)}}function q(){l=g.find(".b-prices-edit-place-swither[value=1]");e=g.find(".b-prices-edit-place-swither[value=2]");s=g.find(".b-prices-edit-place-swither[value=3]");l.map(function(A){b(this).bind("click",{phraseNum:A,place:1},y)});e.map(function(A){b(this).bind("click",{phraseNum:A,place:2},y)});s.map(function(A){b(this).bind("click",{phraseNum:A,place:3},y)})}function y(A){m.setPlace(A.data.place,A.data.phraseNum,g)}}})(jQuery,window.Lego);(function(b,a){a.block["b-prices-edit__switcher"]=function(e){var h=e.phrases,m=b(this),d=e.priceModel,c=e.priceModels,n=m.find(".b-prices-edit-spect-link"),j=m.find(".b-prices-edit-first-link"),g=m.find(".b-prices-edit-garant-link");n.bind("click",{place:3},l);j.bind("click",{place:2},l);g.bind("click",{place:1},l);function l(o){o.preventDefault();if(d){d.setPlaceForAll(o.data.place,m)}else{if(c){b.each(c,function(){this.setPlaceForAll(o.data.place,m)})}}return false}}})(jQuery,window.Lego);(function(b,a){a.block["b-prices-edit__unglue"]=function(m){var o=b(this),g=m.priceModel,d=m.priceModels,s=o.find(".b-prices-edit__unglue-undo-text"),e=o.find(".b-prices-edit__unglue-redo-text"),c=o.find(".b-prices-edit__unglue-undo-link"),j=o.find(".b-prices-edit__unglue-redo-link");c.click(n);j.click(q);function u(v){s.toggleClass("g-hidden",v);c.toggleClass("g-hidden",v);e.toggleClass("g-hidden",!v);j.toggleClass("g-hidden",!v)}function n(v){v.preventDefault();u(true);h("undo")}function q(v){v.preventDefault();u(false);h("redo")}function h(v){if(g){l(g,v)}else{b.each(d,function(x,w){l(w,v)})}}function l(v,w){if(w=="undo"){v.update({unglued:0})}else{v.update({unglued:1})}}}})(jQuery,window.Lego);(function(b,a){a.block["b-prices-edit__validate"]=function(j){var o=j.backAction,n=b(this),s=j.error_message,g=j.priceModel,d=j.priceModels,e=b(".b-prices-edit-submit"),h=b(".b-prices-edit-submit-back"),c=n.find(".b-prices-edit__validate-action"),q=n.find(".b-price-edit-result-phrases");e.click(l);h.click(m);function l(){if(g){var w=g.getErrorsMessage();if(w){alert(w);return false}q.val(g.getResultOutput())}else{var v=[];for(var u in d){var w=d[u].getErrorsMessage();if(w){alert(w);return false}v.push(d[u].getResultOutput())}q.map(function(x){b(this).val(v[x])})}n.submit()}function m(){var v="";var w;for(var u in d){d[u].update({unglued:0});w=(u==0)?"":"-"+u;v+='<input type="hidden" name="phrases'+w+'" value="'+d[u].allPhrasesForSubmit()+'"></input>'}c.val(o);n.append(b(v));n.submit()}}})(jQuery,window.Lego);(function(b,a){a.block["b-prices-edit__global-summs"]=function(j){var g=j.phrases,h=b(this),c=j.priceModels;for(var e in c){c[e].bind("change.phrase",d)}d();function d(){var v=0,s=0,u=0;for(var q in c){v+=c[q].countGlobSummSpec();s+=c[q].countGlobSummFirst();u+=c[q].countGlobSummGarant()}var o=(Math.ceil((kurs_ye*v)*100))/100;var l=(Math.ceil((kurs_ye*s)*100))/100;var m=(Math.ceil((kurs_ye*u)*100))/100;var n=iget("спецразмещение")+"&nbsp;&mdash; <i><b>"+o+"</b> "+iget("руб.")+"</i>,";n+=" "+iget("на первую позицию")+"&nbsp;&mdash; <i><b>"+l+"</b> "+iget("руб.")+"</i>,";n+=" "+iget("на гарантированные показы")+"&nbsp;&mdash; <i><b>"+m+"</b> "+iget("руб.")+"</i>.";h.html(n)}}})(jQuery,window.Lego);(function(b,a){a.block["b-validator__limit"]=function(g){var j=b(this),h=g.model,m=g.fieldName,d=g.limit,n=g.useTemplate,c=j.find(".counter");h.bind("change."+m,l);l(true);function e(){switch(m){case"extra_message":return h.models.vcard.extra_message();case"href":return h.models.href.href();default:return h[m]()}}function l(s){var q=e()||"",o;if(s){q=b.unescapeHTML(q)}if(q){q=q.replace(/[\s\xA0]{2,}/g," ");q=q.replace(/[\s\xA0]$/,"");q=q.replace(/^[\s\xA0]/,"")}if(n&&q){if(q.match(/(\#)([^\#]*)(\#)/)){q=q.replace(/(\#)([^\#]*)(\#)/g,"$2")}}o=(q)?q.length:0;c.text(d-o);c.toggleClass("b-validator-limit-error",(d-o)<0)}}})(jQuery,window.Lego);(function(b,a){a.block["b-validator__minus-words"]=function(g){var e=this,d=b(".b-validator__minus-words__count",e),c=g.limit||1000;b(".b-validator__minus-words__input",e).bind("change keyup click blur",function(){var j=b.trim(this.value).replace(/\s-/g,"").replace(/^-/g,"").replace(/-/g,"a").replace(/[\u0000-\u002F\u1D00-\uFFFF]/g,""),h=j.length;d.html(c-h);d.toggleClass("b-validator__minus-words__count_error",c<h)}).triggerHandler("change")}})(jQuery,window.Lego);(function(b,a){a.block["b-add-agency"]=function(g){var l=b(this);var e={};var o=["name","phone","fax","url","email","city","geo_id"];var h={name:iget("Не указано имя агентства"),phone:iget("Не указан телефон"),fax:iget("Не указан fax"),url:iget("Не указан url"),email:iget("Не указан E-mail"),invalid_email:iget("Неверно указан E-mail"),city:iget("Не указан город"),geo_id:iget("Неправильно введено название города")};var n=l.find("input.agency-find"),d=l.find("input.agency-create");d.click(c);for(var j=0;j<o.length;j++){var m=l.find("[name="+o[j]+"]");if(m.length>0){e[o[j]]=m}}function c(v){var u="";var s=[];for(var q in e){if(b.isEmpty(e[q].val())){s.push(q);if(q!="geo_id"||b.inArray("city",s)==-1){u+=(u)?"\n"+h[q]:h[q]}}}if((b.inArray("email",s)==-1)&&!b.validateEmail(e.email.val())){u+=(u)?"\n"+h.invalid_email:h.invalid_email}if(u){alert(u);return false}return confirm(iget("Вы уверены, что хотите создать новое агентство?"))}}})(jQuery,window.Lego);(function(b,a){a.block["b-keyword-processing"]=function(h){var o=b(this),e=o.find(".keyword-select"),q=o.find(".keyword-adjust"),c=o.find(".keyword-input");e.click(d);q.click(n);var j=h.model;var m=h.inputName||0;var s;function d(u){u.preventDefault();var v=(j)?j.geo():document.forms.ad.geo.value;g(c.val(),v,time,key,"")}function n(u){u.preventDefault();var v=(j)?j.geo():document.forms.ad.geo.value;g(c.val(),v,"","",1)}function g(x,w,u,z,v){var y=l();y.find("[name=text]").val(x);y.find("[name=geo]").val(w);y.find("[name=tm]").val(u);y.find("[name=key]").val(z);y.find("[name=minus]").val(v);var A=create_standard_window("","Words");y.submit();if(navigator.appName=="Netscape"){A.focus()}}function l(){if(s){return s}s=b('<form method="POST" target="Words"><input type="hidden" name="cmd" value="wordstat"></input><input type="hidden" name="text"></input><input type="hidden" name="suffix"></input><input type="hidden" name="key"></input><input type="hidden" name="tm"></input><input type="hidden" name="geo"></input><input type="hidden" name="minus"></input><input type="hidden" name="name" value="'+m+'"></input></form>');s.appendTo(b(document.body));return s}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__email-notification"]=function(m){var l=b(this),e=m.model,d=b("#"+m.popupId),j=l.find(".b-campaign-form__email-notification__input"),h=l.find(".b-campaign-form__email-notification__open");e.bind("change.email_notification",g);h.click(c);function c(n){n.preventDefault();if(d.data("api").visible()){d.data("api").close()}else{b(document).trigger("b-window_close-all");d.removeClass("g-hidden").data("api").open()}}function g(n){b.each(j,function(s,o){var q=o.name;b(o).val(e[q]())})}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__email-notification__popup"]=function(y){var n=b(this),j=y.model,u=b("#"+y.popupId),e=n.find(".b-window"),m=n.find(".popup__send-news"),d=n.find(".popup__warn_span"),v=n.find(".popup__email-block"),q=n.find(".popup__email_link");var D={sendAccNews:n.find(".popup__send-acc-news"),sendWarn:n.find(".popup__warn-checkbox"),warnPlaceInterval:n.find(".popup__warn-select"),money_warning_value:n.find(".popup__money-warning"),email:n.find(".popup__email-select")};e.bind("b-window_submit",z);e.bind("b-window_submit b-window_close b-window_cancel",C);u.bind("b-window_submit",l);D.sendWarn.click(s);q.click(x);j.bind("change.email_notification",B);j.bind("change.servicing",h);e.bind("b-window_open",B);function h(){m.toggleClass("g-hidden",j.servicing())}function l(F,E){if(!b.validateEmail(E)){alert(iget("Неправильный email"));F.preventDefault()}else{if(D.email.find('option[value="'+b.escapeHTML(E)+'"]').length==0){D.email.append('<option value="'+b.escapeHTML(E)+'">'+b.escapeHTML(E)+"</option>")}D.email.val(b.escapeHTML(E))}}function C(E){u.data("api").close()}function c(){var E={};E.sendAccNews=D.sendAccNews.attr("checked")?"Yes":"";E.sendWarn=D.sendWarn.attr("checked")?"Yes":"";E.warnPlaceInterval=D.warnPlaceInterval.val();E.money_warning_value=D.money_warning_value.val();E.email=D.email.val();return E}function A(){D.sendAccNews.attr("checked",j.sendAccNews()=="Yes"?1:0);D.sendWarn.attr("checked",j.sendWarn()=="Yes"?1:0);D.warnPlaceInterval.val(j.warnPlaceInterval());D.money_warning_value.val(j.money_warning_value());D.email.val(j.email());o(j.sendWarn()=="Yes")}function g(){var E=D.money_warning_value.val();if(E.match(/^\d*$/)&&E>0&&E<=50){return true}else{alert(iget("Неверное значение уровня остатка средств"));return false}}function z(E){if(!g()){E.preventDefault()}else{w()}}function w(){var E=c();j.update(E,n)}function B(E){if(E.source==n){return}A()}function s(E){o(E.target.checked)}function o(E){D.warnPlaceInterval.attr("disabled",!E);d.toggleClass("disabled",!E)}function x(E){E.preventDefault();u.removeClass("g-hidden").data("api").attach(v[0])}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__email-notification__email-input-popup"]=function(h){var g=b(this),d=g.find(".email-input-popup_input"),c=g.find(".b-window");c.bind("b-window_open",function(){c.data("api").submitData=function(){return d.val()};d.val("");setTimeout(function(){d.focus()},1)});d.keypress(e);function e(j){if(j.keyCode==13){c.data("api").submit();return false}else{return true}}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__sms-notification"]=function(h){var n=b(this),j=h.model,l=n.find(".b-sms-notification-open-wnd"),c=b("#"+h.popupId),m=n.find(".b-campaign-form__sms-notification__hidden"),g=n.find(".b-campaign-form__sms-notification__hidden-time");l.bind("click",d);j.bind("change.sms_notification",e);e();function e(){var q=j.sms_flags()||{};b.each(m,function(v,s){var u=b(s).attr("name");b(s).val(q[u]?1:0)});var o=j.sms_time().split(":")||[9,0,21,0];b.each(g,function(u,s){b(s).val(o[u])})}function d(o){o.preventDefault();if(c.data("api").visible()){c.data("api").close()}else{b(document).trigger("b-window_close-all");c.removeClass("g-hidden").data("api").open()}}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__sms-notification__popup"]=function(j){var s=b(this),l=j.model,c=s.find(".b-window"),q=s.find(".popup__set-all-time");var g=[s.find(".popup__hour-from"),s.find(".popup__min-from"),s.find(".popup__hour-to"),s.find(".popup__min-to")];var e={active_orders_money_out_sms:s.find(".popup__money-out"),notify_order_money_in_sms:s.find(".popup__money-in"),moderate_result_sms:s.find(".popup__moderate-result"),notify_metrica_control_sms:s.find(".popup__metrica-control")};q.click(o);c.bind("b-window_submit",n);c.bind("b-window_open",h);function d(){var x=(l.statusMetricaControl()!="Yes");var w=(x)?"gray":"black";b("#notify_metrica_control_sms_label").css("color",w);e.notify_metrica_control_sms.attr("disabled",x)}function h(w){if(w.source==s){return}m();d();u()}function n(z){if(!v()){z.preventDefault()}else{var y={};var x={};for(var w in e){x[w]=e[w].attr("checked")}y.sms_flags=x;y.sms_time=[g[0].val(),g[1].val(),g[2].val(),g[3].val()].join(":");l.update(y,s)}}function v(){if(g[0].val()==g[2].val()&&g[1].val()>g[3].val()||g[0].val()>g[2].val()){alert(iget("Время для sms-уведомлений задано не верно"));return false}return true}function m(){var x=l.sms_flags()||{};for(var w in e){e[w].attr("checked",x[w]==1?1:0)}}function u(){var w=l.sms_time()?l.sms_time().split(":"):["09","00",21,"00"];b.each(w,function(x,y){g[x].val(y)})}function o(w){w.preventDefault();b.each(["00","00","00","00"],function(x,y){g[x].val(y)})}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__downtshow"]=function(y){var m=b(this),G=y.isText,j=y.model,A=y.value,d=y.emptyValue,D=m.find(".b-downtshow-popup-link"),B=m.find(".b-downtshow-clear"),l=m.find(".b-downtshow-clear-link"),h=m.find(".b-downtshow-mypages-only-select"),u=m.find(".b-downtshow-div-dont"),q=m.find(".b-downtshow-div-dont"),e=m.find(".b-downtshow-handler"),n=m.find(".b-dontshow-do-checkbox"),C=m.find(".b-downtshow-dont-hidden"),s=m.find(".b-downtshow-do-hidden");D.click(v);l.click(E);n.bind(c);j.bind("change.downtshow",x);j.bind("change.DoShow",z);h.bind("select change",o);g(A);if(h.length>0){o()}function z(){m.toggleClass("g-hidden",j.DoShow())}function x(){g(j.DontShow()||"")}function c(){var H="";b.each(n,function(I,J){if(J.checked){H+=(H)?", "+J.value:J.value}});s.val(H)}function F(){var H="";b.each(b(".b-dontshow-dont-checkbox"),function(I,J){if(J.checked){H+=(H)?", "+J.value:J.value}});C.val(H);B.toggleClass("g-hidden",!H)}function o(){var H=(h.find("option:selected").val()=="Yes");q.toggleClass("g-hidden",!H);u.toggleClass("g-hidden",H);e.toggleClass("g-hidden",H)}function g(K){var H=K.split(/[ ,]+/);var J="";var L="";if(H.length){for(var I=0;I<H.length;I++){if(H[I]){J+='<input tabindex="1" class="b-dontshow-dont-checkbox" name="chk_DontShow" type=checkbox value="'+b.escapeHTML(H[I])+'" checked>'+b.escapeHTML(H[I])+"<br>";L+=L?", "+H[I]:H[I]}}}J=(L)?J:d;u.html(J);C.val(L);b(".b-dontshow-dont-checkbox").click(F);B.toggleClass("g-hidden",!L)}function E(H){H.preventDefault();if(G){j.update({common:{DontShow:""}},m)}else{w()}}function w(){b.each(dontCheckbox,function(H,I){b(I).attr("checked",undefined)});b("#id_dontShowYacontextMcb").attr("cheched",false);F()}function v(H){H.preventDefault();OpenWindow("/registered/main.pl?cmd=showDontShow",550,500,"showDontShow")}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__context-limit"]=function(h){var u=this,l=h.model,d=b("#"+h.popupId),e=u.find(".b-context-limit-window-toggle"),g=u.find(".b-campaign-form__context-limit__text"),o=u.find(".b-campaign-form__context-limit__hidden");var s={};l.bind("change.context_limit",q);b.each(o,function(z,y){var A=b(y).attr("name");s[A]=b(y)});q({});function q(y){b.each(l.listenedFieldsTypes.context_limit,function(z,A){c(A)});n()}function c(y){switch(y){case"statusBehavior":s[y].val(l.statusBehavior()=="No"?"No":"");return;case"statusContextStop":s[y].val(l.statusContextStop()=="Yes"?"Yes":"");return;default:s[y].val(l[y]());return}}var v={ContextLimit:"0",ContextPriceCoef:100,statusBehavior:"",statusContextStop:""};e.bind("click",m);l.bind("change.DoShow",x);function x(){u.toggleClass("g-hidden",l.DoShow)}function n(){var y=l.ContextLimit();var B=l.ContextPriceCoef()||100;var z=l.statusBehavior();var A=l.statusContextStop();var C="";if(y==254){C=iget("Показы запрещены.")+'<a href="#" class="b-campaign-form__context-limit__set-auto">'+iget("Включить показы на тематических площадках")+"</a>"}else{if(y==0){C=iget("Ограничение расхода не задано.")}else{if(y==255){C=iget("Ограничение расхода отключено.")}else{C=iget("Расход в пределах %s% от общего расхода кампании.").replace(/%s/,y)}}if(B!=100){C+="<br>"+iget("Максимальная цена за клик %s% от максимальной цены на поиске.").replace(/%s/,B)}if(z=="No"){C+="<br>"+iget("Предпочтения пользователей не учитываются.")}if(A=="Yes"){C+="<br>"+iget("Показы останавливаются при отключении фраз на поиске.")}}g.html(C);g.find(".b-campaign-form__context-limit__set-auto").bind("click",j)}function w(){return{ContextLimit:l.ContextLimit(),ContextPriceCoef:l.ContextPriceCoef(),statusBehavior:l.statusBehavior()}}function m(y){y.preventDefault();if(d.data("api").visible()){d.data("api").close()}else{b(document).trigger("b-window_close-all");d.removeClass("g-hidden").data("api").open()}}function j(y){if(y){y.preventDefault()}l.update(v)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__disabled-ips"]=function(o){var v=b(this),x=o.value,q=o.model,s=o.emptyValue,e=o.url,d=v.find(".b-disabled-ips-add"),h=v.find(".b-disabled-ips-cancel"),g=v.find(".b-disabled-ips-div"),l=v.find(".b-disabled-ips-hidden"),y=v.find(".b-disabled-ips-cancel-block"),w=v.find(".b-disabled-ips-hidden-old");d.click(u);h.click(c);n(x);q.bind("change.disabled_ips",j);function j(){n(q.disabledIps()||"")}function u(z){z.preventDefault();OpenWindow(e+"&disabledIps="+escape(l.val()),550,500,"popupdisabledIps")}function c(z){z.preventDefault();q.update({common:{disabledIps:""}},v)}function n(D){var z=D.split(/[ ,]+/);var B="";var C="";if(z.length){for(var A=0;A<z.length;A++){if(z[A]){B+='<input tabindex="1" name="chk_disabledIps" type=checkbox value="'+b.escapeHTML(z[A])+'" checked class="b-disabled-ips-checkbox">'+b.escapeHTML(z[A])+"<br>";C+=C?", "+z[A]:z[A]}}}B=(C)?B:s;g.html(B);g.find(".b-disabled-ips-checkbox").click(m);l.val(C);y.toggleClass("g-hidden",!C)}function m(){var z="";b.each(g.find(".b-disabled-ips-checkbox"),function(A,B){if(b(B).attr("checked")){z+=(z)?", "+b(B).val():b(B).val()}});l.val(z)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__autobudget-media-form"]=function(h){var n=this,e=h.date,j=h.model,c=n.find(".b-autobudget-media-form-calendar-block"),o=n.find(".b-autobudget-media-form-span"),l=n.find(".b-autobudget-media-form-checkbox");l.click(q);j.bind("change.autobudget",d);var g=m();q();function d(s){l.attr("checked",(j.autobudget()=="Yes"));g.update_date(j.autobudget_date().replace(/^0000-00-00.*/,e))}function m(){var s=new clite(e);s.addField("autobudget_date","%Y-%M-%D");s.appendToPlace(c[0]);return s}function q(){var s=l.attr("checked");o.toggleClass("disabled",!s);b("#calButton"+g.rnd).attr("disabled",!s);b("#calInput"+g.rnd).attr("disabled",!s)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__broadmatch-form"]=function(e){var l=this,g=e.model,m=l.find(".b-broadmatch-form-span"),o=l.find(".b-broadmatch-form-select"),h=l.find(".b-broadmatch-form-checkbox");g.bind("change.broad_match",j);h.bind("click",d);o.change(n);function d(){var q=h.attr("checked");c(!q);g.update({common:{broad_match_flag:q}},l)}function n(){g.update({common:{broad_match_limit:o.val()}},l)}function c(q){m.toggleClass("disabled",q);o.attr("disabled",q)}function j(q){if(q.source==l){return}h.attr("checked",g.broad_match_flag()?1:0);o.val(g.broad_match_limit());c(!g.broad_match_flag())}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__metrica-control"]=function(x){var j=b(this),e=x.model,m=x.message,h=x.count||0,n=j.find(".b-metrica-control-checkbox"),u=j.find(".b-metrica-control-checkbox-notify"),y=j.find(".b-metrica-control-help"),c=j.find(".b-metrica-control-help2"),q=j.find(".b-metrica-control-label-notify");n.click(z);u.click(g);e.bind("change.sms_notification",v);e.bind("change.statusMetricaControl",w);function v(A){if(A.source==j){return}u.attr("checked",e.sms_flags().notify_metrica_control_sms)}function w(A){if(A.source==j){return}n.attr("checked",e.statusMetricaControl()=="Yes"?1:0);d();u.attr("checked",e.sms_flags().notify_metrica_control_sms);s(A)}function g(A){b(document).trigger("b-window_close-all");e.update({common:{sms_flags:{active_orders_money_out_sms:e.sms_flags().active_orders_money_out_sms,notify_order_money_in_sms:e.sms_flags().notify_order_money_in_sms,moderate_result_sms:e.sms_flags().moderate_result_sms,notify_metrica_control_sms:this.checked}}},j)}function s(A){if(A.source==j){return}o()}function o(){var B=!(e.sms_phone()&&n.attr("checked"));var C=B?0:u.attr("checked");u.attr("disabled",B);u.attr("checked",C);var A=(B)?"gray":"black";q.css("color",A)}function d(){y.toggleClass("g-hidden",!n.attr("checked"));c.toggleClass("g-hidden",n.attr("checked"))}function l(){d();if(n.attr("checked")){if(h==0){alert(m)}}}function z(A){if(e.sms_phone()){o();l()}else{l()}b(document).trigger("b-window_close-all");e.update({statusMetricaControl:this.checked?"Yes":"No",sms_flags:{active_orders_money_out_sms:e.sms_flags().active_orders_money_out_sms,notify_order_money_in_sms:e.sms_flags().notify_order_money_in_sms,moderate_result_sms:e.sms_flags().moderate_result_sms,notify_metrica_control_sms:this.checked?e.sms_flags().notify_metrica_control_sms:0}},j)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__minus-words"]=function(e){var l=this,h=e.model,m=l.find(".b-campaign-form__minus-words__link"),n=l.find(".b-campaign-form__minus-words__textarea"),j=l.find(".b-campaign-form__minus-words__count");m.bind("click",d);h.bind("change.minus_words",c);n.change(g);function d(){n.toggleClass("g-hidden");j.toggleClass("g-hidden")}function g(){h.update({common:{minus_words:n.val()}})}function c(){var o=h.minus_words();n.val(o);n.toggleClass("g-hidden",!o);n.triggerHandler("change");j.toggleClass("g-hidden",!o)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__status-openstat"]=function(l){var j=b(this),d=l.model,g=l.message,h=j.find(".b-status-openstat-checkbox");h.click(e);d.bind("change.statusOpenStat",c);function c(){h.attr("checked",(d.statusOpenStat()=="Yes"))}function e(){if(h.attr("checked")){alert(g)}}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__campaign-switcher"]=function(x){var n=b(this),l=x.model,e=x.hash,j=x.operator,d=x.agenciesHash,B=n.find(".b-campaign-switcher-select"),g=n.find(".b-campaign-switcher-agency-select"),A=n.find(".b-campaign-switcher-existing-radio"),m=n.find(".b-campaign-switcher-new-radio");var o=null,v;m.bind("click",u);A.bind("click",u);B.bind("change",h);g.bind("change",w);b(window).load(y);function y(){if(g.length>0){w(null,true)}else{s()}if(e){c()}else{C()}}function u(){if(v&&m.attr("checked")){return}if(!v&&A.attr("checked")){return}c()}function s(){var D="$self$";b.each(d,function(G){D=G;return false});var F=x.agenciesInfo[D]||{};var E={agency:D=="$self$"?"":D,my_pages:d[D]};if(D!="$self$"||d["$self"]){E.email=j.email||F.email||""}l.update(E,n)}function w(F,H){var D=g.val()||"$self$",E=x.agenciesInfo[D]||{},G=d[D]||[];l.update({agency:D=="$self$"?"":D,my_pages:G,email:E.email||""},n);if(!H&&x.storeSelection){direct.UserOptions.set("new_camp_agency",D=="$self$"?"":D)}}function c(){b(document).trigger("b-window_close-all");q();h()}function h(){if(v){if(o){l.update(o,n);l.fixInitState()}}else{var D=b.extend({},e[B.attr("selectedIndex")]);optionStr="old:"+D.cid;D.agency="";D.isNewCamp=v;l.update(b.extend(D,{vcard:b.extend((new direct.formsedit.VCardModel()).getData(),D.vcard),timetarget:b.extend((new direct.formsedit.Timetargeting()).getData(),D)}),n);l.fixInitState()}l.saveState();l.trigger("switcher.change_data",m.attr("checked"))}function q(){v=m.attr("checked");B.attr("disabled",m.attr("checked"));g.attr("disabled",!m.attr("checked"));l.trigger("switcher.switch_campaign_type",v);if(!m.attr("checked")){o=l.getData()}}function C(){l.trigger("switcher.init_new_campaign")}function z(){B.attr("disabled",(A.attr("checked"))?0:1);l.trigger("switcher.change",(!e||m.attr("checked")))}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__validate"]=function(v){var h=b(this),d=v.model,l=v.submitMessages||{},n=v.isMedia,u=window.ulogin,c=h.find(".b-validate-submit"),j=h.find(".b-validate-show_ci_flag"),x=h.find(".b-validate-strategy"),z=h.find(".b-validate-autobudget-sum"),e=h.find(".b-validate-autobudget-bid"),m=h.find(".b-validator__minus-words__count");d.bind("change.submit_disable",s);d.bind("submit_continue",q);c.click(y);var w=d.minus_words();function o(){if(x.val()=="autobudget"){z.val(z.val().replace(/,/g,"."));if(!z.val().match(/^\s*\d+(\.\d*)?\s*$/)){alert(iget("Неверно указана сумма недельного бюджета"));z.focus();return false}if(1*z.val()<10){alert(iget("Недельный бюджет не может быть меньше 10 у.е."));z.focus();return false}else{if(1*z.val()>MAX_AUTOBUDGET){alert(iget("Указан слишком большой недельный бюджет"));z.focus();return false}}if(e&&!e.val().match(/^\s*$/)){e.val(e.val().replace(/,/g,"."));if(!e.val().match(/^\s*\d+(\.\d*)?\s*$/)){alert(iget("Неверно указана максимальная ставка"));e.focus();return false}else{if(1*z.val()<10){alert(iget("Недельный бюджет не может быть меньше 10 у.е."));z.focus();return false}else{if(1*e.val()<MIN_AUTOBUDGET_BID){alert(iget("Указана ставка меньше минимальной цены клика"));e.focus();return false}else{if(1*e.val()>=1*z.val()){alert(iget("Недельный бюджет должен быть больше максимальной ставки"));z.focus();return false}else{if(1*e.val()>MAX_AUTOBUDGET_BID){alert(iget("Указана ставка больше %s у.е.").replace("%s",MAX_AUTOBUDGET_BID));e.focus();return false}}}}}}}return true}function g(){if(m.html()<0){alert(minuswordsMessage);return false}return true}function s(){if(d.submit_disable()){c.attr("disabled",true);c.after('<span class="b-campaign-form__minus-words__progress">'+iget("Идёт проверка единых минус-слов")+"</span>")}else{c.attr("disabled",false);b(".b-campaign-form__minus-words__progress").remove()}}function q(){if(d.minus_words_error()){if(confirm(d.minus_words_error())){h.submit()}}else{h.submit()}}function y(){if(!n){var B=d.getModel("vcard");var F=B.isEmpty();j.val(F?0:1);if(!F){var A=B.getErrorsMessage(),C="";if(A){C+=A}if(C!=""){alert(C);return false}if(!d.isNewCamp()){var D=!B.staticData||B.staticData&&!B.isEqual(B.staticData,true,true);if(D){if(!confirm(iget("Вы изменили контактную информацию! При сохранении установленная ЕДИНАЯ контактная информация будет у всех объявлений одинаковой, активные объявления будут отправлены на модерацию. Сохранить?"))){return false}}}}}if(!g()){return false}if(!o()){return false}if(!n&&!d.isNewCamp()&&!b.isEqual(d.staticData.common.geo,d.geo())){if(!confirm(l.compared.geo)){return false}}var E=v.cid||d.cid();if(E){if(w!=d.minus_words()){d.check_minus_words(E,u);return false}}return true}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__servicing"]=function(g){var e=b(this),d=g.model,h=e.find(".b-servicing-checkbox");h.click(c);function c(){d.update({common:{is_serviced:this.checked}},e)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__my-pages"]=function(e){var l=b(this),g=e.model,n=l.find(".b-campaign-form__my-pages-my-span"),h=l.find(".b-campaign-form__my-pages-radio-ya"),j=l.find(".b-campaign-form__my-pages-radio-my"),c=l.find(".b-campaign-form__my-pages-hidden");h.click(m);j.click(m);g.bind("switcher.change_data",d);g.bind("change.agency",d);c.val(g.DoShow());function m(){var o=j.attr("checked")==1;h.toggleClass("selected-radio",!o);j.toggleClass("selected-radio",o);g.update({common:{DoShow:(o)?j.val():""}},l);c.val(g.DoShow())}function d(q){if(q.source==l){return}if(!g.my_pages()||g.my_pages().length==0){l.addClass("g-hidden")}else{l.removeClass("g-hidden")}c.val(g.DoShow());var o=g.DoShow()?g.DoShow().split(","):[];h.attr("checked",!o.length);j.attr("checked",b.inArray("1005",o)!=-1)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form"]=function(ac){var z=b(this),d=ac.model,O=ac.messages||{},ab=z.find(".b-campaign-form-start-calendar"),A=z.find(".b-campaign-form-name"),V=z.find(".b-campaign-form-autooptimization"),h=z.find(".b-campaign-form-time-target"),U=z.find(".b-campaign-form-fio"),g=z.find(".b-campaign-form-first-step"),K=z.find(".b-campaign-form-pay-empty-label"),y=z.find(".b-campaign-form-pay-empty"),X=z.find(".b-campaign-form-servicing-label"),v=z.find(".b-campaign-form-servicing-post-label"),T=z.find(".b-campaign-form-rf"),G=z.find(".b-campaign-form-rfReset"),o=z.find(".b-servicing-checkbox"),S=z.find(".b-campaign-form-description"),I=z.find(".b-campaign-form-favorite"),Z=z.find(".b-campaign-form-fairAuction"),m=null;var E,l,D,Q;d.bind("switcher.change_data",w);d.bind("switcher.init_new_campaign",c);d.bind("switcher.switch_campaign_type",q);var C={name:J,start_date:H,FIO:e,autoOptimization:L,rf:N,rfReset:j,camp_description:F,favorite_camp:u,fairAuction:M,agency:s,AgencyUID:s,ManagerUID:s,is_serviced:s};for(var aa=0;aa<d.listenedFieldsTypes.other.length;aa++){if(C[d.listenedFieldsTypes.other[aa]]){d.bind("change."+d.listenedFieldsTypes.other[aa],C[d.listenedFieldsTypes.other[aa]])}}Y();W();function W(){A.blur(n);U.blur(P);E.change(ad)}function J(){A.val(d.name())}function x(ae){ae=!!ae;o.attr("disabled",ae);X.toggleClass("disabled",ae);v.toggleClass("disabled",ae);if(ae){o.attr("checked",false)}}function ad(ag,ae){if(ae==z){return}var af=l.val()+"-"+D.val()+"-"+Q.val();d.update({start_date:af},z)}function P(af,ae){if(ae==z){return}d.update({FIO:U.val()},z)}function n(af,ae){if(ae==z){return}d.update({name:A.val()},z)}function L(){V.attr("checked",(d.autoOptimization()=="Yes")?1:0)}function M(af,ae){Z.attr("checked",d.fairAuction())}function H(){m.update_date(d.start_date())}function s(){x(d.AgencyUID()||d.ManagerUID()||d.agency()||d.orig_is_serviced())}function e(){U.val(d.FIO())}function N(){T.val(d.rf())}function j(){G.attr("selectedIndex",((d.rfReset()||28)==28)?0:1)}function F(){S.html(b.escapeHTML(d.camp_description()))}function u(){I.attr("checked",d.favorite_camp())}function q(ae){b(document).triggerHandler("timetargeing:swicth",d.getData());g.html((ae)?O.firstStep[0]:O.firstStep[1]);if(!ae){R()}else{B()}}function c(){B()}function B(){y.attr("disabled",false);K.removeClass("disabled");s()}function R(){y.attr("disabled",1);y.attr("checked",0);K.addClass("disabled")}function w(ae){if(!ae){s()}}function Y(){m=new clite(d.start_date());m.addField("yyyy","%Y");m.addField("mm","%M");m.addField("dd","%D");m.appendToPlace(ab[0]);E=ab.find(".calendar-input");l=ab.find(".calendar-yyyy");D=ab.find(".calendar-mm");Q=ab.find(".calendar-dd");s()}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__context-limit__popup"]=function(g){var m=this,h=g.model,c=m.find(".b-window"),e=m.find(".b-campaign-form__context-limit_can-disabled");var q={ContextLimit:m.find(".b-campaign-form__context-limit__popup__select"),ContextPriceCoef:m.find(".b-campaign-form__context-limit__popup__price-coef-select"),statusContextStop:m.find(".b-campaign-form__context-limit__popup__status-context-stop-checkbox"),statusBehavior:m.find(".b-campaign-form__context-limit__popup__status-behavior-checkbox")};var d=q.ContextLimit.val();h.bind("change.context_limit",l);c.bind("b-window_submit",j);c.bind("b-window_open",l);function l(s){if(s.source==m){return}b.each(h.listenedFieldsTypes.context_limit,function(u,v){o(s,v)});n(s,true)}q.ContextLimit.bind("change",n);function o(u,s){if(u.source==m){return}switch(s){case"statusBehavior":q[s].attr("checked",h[s]()=="No"?1:0);break;case"statusContextStop":q[s].attr("checked",h[s]()=="Yes"?1:0);break;default:q[s].val(h[s]())}}function n(w,u){var s=q.ContextLimit.val();var v=(s==254);if(s==254){if(!u&&(d!=254)&&!confirm(iget('Расход в пределах "0%" означает, что вы ПОЛНОСТЬЮ отключаете показы на тематических площадках.')+"\n\n"+iget("Обратите внимание: отключая показы на тематических площадках, вы можете лишиться целевых посетителей. Если показы не отключены, в разделе статистики будут предоставлены данные по каждой площадке и возможность отключения показов на каждой площадке выборочно.")+"\n\n"+iget("Отключить показы объявлений на тематических площадках Рекламной сети Яндекса?"))){q.ContextLimit.val(d);return false}else{d=s}}else{d=s}b.each(["ContextPriceCoef","statusBehavior","statusContextStop"],function(y,x){q[x].attr("disabled",v)});e.toggleClass("disabled",v)}function j(){h.update({ContextLimit:q.ContextLimit.val(),ContextPriceCoef:q.ContextPriceCoef.val(),statusBehavior:q.statusBehavior.attr("checked")?"No":"",statusContextStop:q.statusContextStop.attr("checked")?"Yes":""},m)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__optimize__ready"]=function(e){var d=b(this),j=e.id,h=e.cid,c=d.find(".b-campaigninfo-show__optimize__ready__close");c.click(g);function g(l){l.preventDefault();b.getJSON("/registered/main.pl",{cmd:"ajaxPostponeOptimize",cid:h,optimize_request_id:j});d.addClass("g-hidden");return false}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__optimize__text"]=function(h){var g=b(this),c=g.find(".expand-link"),e=g.find(".collapse-link");c.bind("click",{collapse:0},d);e.bind("click",{collapse:1},d);function d(j){var l=j.data.collapse;b(document).trigger("b-window_close-all");g.toggleClass("b-campaigninfo-show__optimize__text-collapsed",l);g.toggleClass("b-campaigninfo-show__optimize__text-expanded",!l)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__optimize__accept"]=function(u){var n=b(this),s=u.models||{},x=u.phraseModels||{},g=u.easy,C=u.position,v=u.retpath,j=n.find(".accept-form"),m=n.find(".accept__accept-button"),o=n.find(".accept__reject-button"),z=n.find(".accept__postpone-button"),w=n.find(".b-campaigninfo-show__optimize__accept__phids"),y=n.find(".b-campaigninfo-show__optimize__accept__bids"),h=n.find(".b-campaigninfo-show__optimize__accept__bid");if(g){n.bind("b-campaigninfo-show__optimize__accept__submitAccept",c)}else{n.bind("b-campaigninfo-show__optimize__accept__submitAccept",B)}m.click(l);o.click(e);z.click(q);n.bind("b-campaigninfo-show__optimize__accept__submitReject",A);function q(){d({cmd:"ajaxPostponeOptimize",retpath:v});j.submit()}function A(D,E){d(E);j.submit()}function d(E){var F="";for(var D in E){F+='<input type="hidden" name="'+D+'" value = "'+E[D]+'"></input>'}j.append(F)}function B(G,H){var F=0,I=[],E=[],D;b.each(s,function(L,K){var J=0;if(K.selected()){F+=1;I.push(L)}for(var N in x[L]){var M=x[L][N];if(M.checked()){if(M.numword()>0){J+=1}E.push(N)}}if(J==0&&(K.selected()||H.acceptType=="all")){alert(iget("Ни одна фраза для баннера № П-%s не выбрана!",L));D=true;return}});if(D){return}if(F==0&&H.acceptType!="all"){alert(iget("Ни один баннер не выбран!"));n.bind("b-campaigninfo-show__optimize__accept__submitAccept",B);return}w.val(E.join(","));y.val(I.join(","));h.val(I.join(","));d(H);if(direct.CampOptions.get("banners_selected")){direct.CampOptions.remove("banners_selected",function(){j.submit()})}else{j.submit()}}function c(D,E){d(E);j.submit()}function l(){b(document).trigger("b-window_close-all");b(document).trigger("b-campaigninfo-show__optimize__accept_openAccept",{id:n.attr("id"),position:C})}function e(){b(document).trigger("b-window_close-all");b(document).trigger("b-campaigninfo-show__optimize__accept_openReject",{id:n.attr("id"),position:C})}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__optimize__accept__accept-popup"]=function(j){var u=b(this),s=j.easy,g=u.find(".accept-popup__stop-old"),o=u.find(".accept-popup__arch-old"),d=u.find(".b-campaigninfo-show__optimize__accept__accept-popup__popup"),q=u.find(".b-campaigninfo-show__optimize__accept__accept-popup__type"),w=u.find(".b-campaigninfo-show__optimize__accept__accept-popup__type-all"),v=u.find(".b-campaigninfo-show__optimize__accept__accept-popup__type-selected");var l;g.click(m);o.click(c);b(document).bind("b-campaigninfo-show__optimize__accept_openAccept",e);d.bind("b-window_submit",n);function n(){var x=h();b("#"+l).trigger("b-campaigninfo-show__optimize__accept__submitAccept",x)}function h(){var x={};x.cmd=(s)?"acceptOptimize_step2":"acceptOptimize";x.acceptType=(w.attr("checked"))?"all":"selected";x.stopOld=(g.attr("checked"))?"Yes":"";x.archOld=(o.attr("checked"))?"Yes":"";return x}function e(y,z){l=z.id;var x=(z.position=="top")?"right":"right top";d.removeClass("g-hidden").data("api").attach(b("#"+l)[0],x);d.data("api").show();return false}function m(y){var x=y.target.checked?o.attr("checked"):false;o.attr("checked",x)}function c(y){var x=!y.target.checked?g.attr("checked"):true;g.attr("checked",x)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__optimize__accept__reject-popup"]=function(h){var g=b(this),d=g.find(".b-campaigninfo-show__optimize__accept__reject-popup__popup"),m=g.find(".b-campaigninfo-show__optimize__accept__reject-popup__comment");b(document).bind("b-campaigninfo-show__optimize__accept_openReject",c);var l;d.bind("b-window_submit",j);function c(o,q){l=q.id;var n=(q.position=="top")?"right":"right top";d.removeClass("g-hidden").data("api").attach(b("#"+l)[0],n);d.data("api").show();return false}function e(){return{optType:"rejectOptimize",cmd:"rejectOptimize",reject_comment:m.val()}}function j(n){if(!confirm(iget("Вы действительно отказаться от рекомендаций?"))){return}b("#"+l).trigger("b-campaigninfo-show__optimize__accept__submitReject",e())}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__bannerinfo"]=function(h){var g=b(this),d=h.model,e=g.find(".b-campaigninfo-show__bannerinfo__checkbox"),c={};e.click(function(j){d.selected(j.target.checked)});setTimeout(function(){d.selected(e.attr("checked"))},1)}})(jQuery,window.Lego);(function(e,b){var d=[],h=[],g=parseInt,a;function j(l){var m=e(l!="INPUT"?'<input type="text" />':"<textarea></textarea>")[0];return typeof(m.placeholder)=="string"}function c(){for(var n=0,m=d.length;n<m;n++){if(d[n].val()){h[n].hide()}}}b.block["b-placeholder"]=function(o){var m=e(this),n=m.attr("placeholder");if(j(m[0].tagName)){return}var l=e("<label>"+n+"</label>");l.css({position:"absolute",left:m[0].offsetLeft+g(m.css("borderLeftWidth"))+"px",top:m[0].offsetTop+g(m.css("borderTopWidth"))+"px",padding:m.css("padding"),display:"block",cursor:"text",color:"#999",fontFamily:m.css("fontFamily"),lineHeight:m.css("lineHeight"),width:o.width||m.css("width")});if(m.parent().css("position")=="static"){m.parent().css("position","relative")}m.after(l);d.push(m);h.push(l);l.click(function(){m.focus()});m.focus(function(){l.hide()});m.blur(function(){if(!m.val()){l.show()}});if(!a){a=true;setInterval(c,100)}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__popups__link"]=function(h){var e=b(this),g=h.mode,d=e.find("a");d.click(c);function c(){b(document).trigger("b-window_close-all");b(document).trigger("b-campaigninfo-show__popups__"+g+"_open");return false}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__popups__banners-filter__popup"]=function(l){var n=["cid","ulogin","has_floated_off","has_ctr","has_phrases_count","has_one_word_phrase","has_one_word_phrase","has_absent_phrases","has_forecast","ctr_value","phrases_count_value","forecast_value"];var o=b(this),d=o.find(".b-campaigninfo-show__popups__banners-filter__popup__popup-container"),s=d.find(".b-campaigninfo-show__popups__banners-filter__popup__cancel"),c=d.find(".b-campaigninfo-show__popups__banners-filter__popup__submit");b(document).bind("b-campaigninfo-show__popups__banners-filter_open",h);d.bind("b-window_close",e);s.click(u);c.click(m);b("#ctr_value").bind("click",{type:"ctr"},g);b("#phrases_count_value").bind("click",{type:"phrases_count"},g);b("#forecast_value").bind("click",{type:"forecast"},g);function g(w){var v=w.data.type;if(v){b("#has_"+v).attr("checked",1)}}function h(){d.removeClass("g-hidden").data("api").show();return false}function e(){b("#ctr_value").val(1);b("#phrases_count_value").val(25);b("#forecast_value").val(500);b("#has_floated_off").attr("checked",0);b("#has_ctr").attr("checked",0);b("#has_phrases_count").attr("checked",0);b("#has_one_word_phrase").attr("checked",0);b("#has_absent_phrases").attr("checked",0);b("#has_forecast").attr("checked",0)}function j(){var w={cmd:"ajaxGetFilteredBanners"},v;b.each(n,function(x,y){v=o.find("[name="+y+"]");w[y]=(v.attr("type").toLowerCase()=="checkbox")?v.attr("checked")?1:0:v.val()});return w}function u(){d.data("api").close();e()}function m(){var v=j();b.getJSON("/registered/main.pl",v,q);return false}function q(v){if(v.count==0){alert(iget("Не найдено ни одного объявления"))}else{var w=v.count+" "+common.inflector.pluralizeWord([iget("объявление"),iget("объявления"),iget("объявлений")],v.count);if(confirm(iget("%s будет скопировано в медиаплан",w))){b(document).trigger("banners-filter:copyToMediaplan",{bids:v.bids})}}}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__popups__banners-search__popup"]=function(x){var l=b(this),n=x.cid+x.uidUrl,d=l.find(".b-campaigninfo-show__popups__banners-search__popup__popup-container"),h=l.find(".banners-search__popup__form"),u=l.find(".banners-search__popup__input"),v=l.find(".banners-search__popup__text"),s=l.find(".banners-search__popup__radio"),o=d.find(".b-campaigninfo-show__popups__banners-search__popup__cancel"),g=d.find(".b-campaigninfo-show__popups__banners-search__popup__submit");var C={prev:"num",vals:{}},e={num:iget("Номер&nbsp;объявления:&nbsp;М-")+"&nbsp;",context:iget("Текст:")+"&nbsp;",phrase:iget("Фраза:")+"&nbsp;"};b(document).bind("b-campaigninfo-show__popups__banners-search_open",w);d.bind("b-window_close",z);o.click(q);g.click(B);s.click(j);function j(E){var F=b(E.target);if(F.attr("checked")){var D=F.val();v.html(e[D]);C.vals[C.prev]=u.val();C.prev=D;u.val(C.vals[D]==null?"":C.vals[D]);u.focus()}}function w(){d.removeClass("g-hidden").data("api").show();return false}function z(){u.val("")}function y(){var D=s.filter(":checked").val(),E=u.val();if(D=="num"&&!E.match(/\d+/)){alert(iget("Вы должны ввести номер объявления как число"));return false}else{if((D=="context"||D=="phrase")&&!E.match(/.+/)){alert(iget("Вы должны ввести текст"));return false}}return true}function q(){d.data("api").close();z()}function c(){var D={cmd:"ajaxGetBannersCount",cid:n,search_by:s.filter(":checked").val(),search_banner:u.val()};var E=h.find("[name=ulogin]");if(E.length>0){D.ulogin=E.val()}return D}function B(E){E.preventDefault();if(!y()){return false}var D=c();b.getJSON("/registered/main.pl",D,m);return false}function m(D){if(D!=0){h.submit()}else{A()}}function A(){if(!confirm(iget("Ничего не найдено, продолжать поиск ?"))){u.val("");b(s.get(0)).attr("checked","checked");j({target:s.get(0)});b(document).trigger("b-window_close-all")}}}})(jQuery,window.Lego);if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(b,a){a.block["b-campaigninfo-show"]=function(z){var o=b(this),x=z.models,C=z.phraseModels,q=z.save_selected,e=o.find(".b-campaigninfo-show__bid-checkbox"),G=o.find(".b-campaigninfo-show__select-all"),u=o.find(".b-campaigninfo-show__action-select"),c=o.find(".b-campaigninfo-show__action-submit"),n=b(".b-campaigninfo-show__action-form"),I=n.find(".b-campaigninfo-show__action-form__cmd"),A=n.find(".b-campaigninfo-show__action-form__bids"),d=n.find(".b-campaigninfo-show__action-form__bid"),v=n.find(".b-campaigninfo-show__action-form__is-copy");var h=["sendOptimize","copyBannersToMediaplan","multieditMediaplan","multicopyMediaplan"];var H={edit:"showCampMultiEdit","delete":"delBanner",copy:"showCampMultiEdit",stop:"stopBanner",resume:"resumeBanner",sendBK:"admSendBK",sendMD:"admSendMD",archive:"archiveBanner",unarchive:"unarchiveBanner"};if(q){if(direct.CampOptions.get("banners_selected")){direct.banners_selected=JSON.parse(direct.CampOptions.get("banners_selected"))}else{direct.banners_selected={}}}b(document).bind("banners-filter:copyToMediaplan",B);c.click(g);G.click(y);e.click(F);if(q){for(var w in direct.banners_selected){b("#checkbox-"+w).attr("checked",true);if(x[w]){x[w].selected(true)}}for(var E in C){for(var s in C[E]){C[E][s].bind("change.checked",function(J,K){return function(L){m(L,J,K)}}(E,s))}}e.click(D)}function m(M,J,L){if(M.source==o){return}var K=C[J][L];if(K.checked()){if(!direct.banners_selected[J]||b.inArray(L,direct.banners_selected[J])==-1){return}direct.banners_selected[J].splice(b.inArray(L,direct.banners_selected[J]),1)}else{if(direct.banners_selected[J]&&b.inArray(L,direct.banners_selected[J])!=-1){return}if(!direct.banners_selected[J]){direct.banners_selected[J]=[]}direct.banners_selected[J].push(L)}l()}function D(K){var L=b(this);var J=L.attr("value");if(L.attr("checked")){direct.banners_selected[J]=[]}else{b.each(direct.banners_selected[J],function(M,O){var N=C[J][O];N.update({checked:1},o)});delete direct.banners_selected[L.attr("value")]}l()}function l(){if(JSON.stringify(direct.banners_selected)!="{}"){direct.CampOptions.set("banners_selected",JSON.stringify(direct.banners_selected))}else{direct.CampOptions.remove("banners_selected")}}function y(){var J=G.attr("type")=="checkbox"?!G.attr("checked"):G.html()==iget("Снять отметку с объявлений");e.each(function(K,L){L.checked=!J});if(G.attr("type")!="checkbox"){j(!J);return false}}function j(J){if(G.attr("type")=="checkbox"){G.attr("checked",J)}else{G.html(!J?iget("Отметить все объявления"):iget("Снять отметку с объявлений"))}}function F(){j(!e.is(":not(:checked)"))}function B(K,J){I.val("copyBannersToMediaplan");d.val(J.bids);n.submit()}function g(){var K=[],J=u.val();var L=(H[J])?H[J]:J;b.each(e,function(M,N){if(N.checked){K.push(N.value)}});if(K.length==0){alert(iget("Ни один баннер не выбран."));return}else{A.val(K.join(","));d.val(K.join(","))}I.val(L);if(J=="delete"){if(!confirm(iget("Вы действительно хотите удалить объявления?"))){return}}else{if(J=="copy"){v.val(1)}else{if(J=="multidelMediaplan"){if(!confirm(iget("Вы действительно хотите удалить блок?"))){return}}else{if(J=="sendMD"){if(!confirm(iget("Вы действительно хотите отправить выбранные объявления заново на модерацию?"))){return}}else{if(J=="sendModerate"){if(!confirm(iget("Вы действительно хотите отправить выбранные объявления на модерацию?"))){return}}else{if(J=="clientSendModerate"){if(!confirm(iget("Вы действительно хотите отправить выбранные объявления на модерацию?"))){return}}else{if(J=="moderateAccept"){if(!confirm(iget("Вы действительно хотите ПРИНЯТЬ объявления БЕЗ модерации?"))){return}}}}}}}}if(b.inArray(J,h)!=-1){n.attr("target","_blank")}n.submit()}}})(jQuery,window.Lego);direct.banners_selected={};(function(b,a){a.block["b-strategy-select"]=function(h){var o=b(this),l=h.model,u=b(".b-ss__select",o),g=b(".b-ss__min-price__option input",o),n=b(".b-ss__autobudget__bid",o),q=b(".b-ss__autobudget__sum",o),m=null,d=b([u[0],n[0],q[0]].concat(b.makeArray(g)));u.change(v);n.bind("keyup blur click change",s);d.bind("change blur click",e);l.bind("change.autobudget",function(w){if(w.source!=o){c()}});function j(z){o.toggleClass("b-ss__min-price__disabled",!z);var x=u[0];if(z&&m){x.appendChild(m);m=null}else{if(!z&&!m){for(var w=0;w<x.childNodes.length;w++){var y=x.childNodes[w];if(!y.tagName){continue}if(y.value=="min-price"){m=y;x.removeChild(y);break}}}}}function v(){o.toggleClass("b-strategy-select_default",u.val()=="default");o.toggleClass("b-strategy-select_min-price",u.val()=="min-price");o.toggleClass("b-strategy-select_autobudget",u.val()=="autobudget")}function s(){n.parent().toggleClass("b-ss_disabled",!n.val().match(/\S/))}function e(){var w=direct.formsedit.campaignModel.strategyToModel({strategy:u.val(),strategyScope:g.filter(":checked").val(),autobudget_bid:n.val()&&common.parse.number(n.val()),autobudget_sum:q.val()&&common.parse.number(q.val())});l.update(w,o)}function c(){var w=direct.formsedit.campaignModel.modelToStrategy(l);j(h.min_price_create||w.strategy=="min-price");g.attr("disabled",w.strategy=="min-price"&&!h.min_price_update);u.val(w.strategy);if(w.strategyScope){g.filter("[value="+w.strategyScope+"]").attr("checked",true)}else{g.eq(0).attr("checked",true)}n.val(w.autobudget_bid?common.format.number(w.autobudget_bid,2):"");q.val(w.autobudget_sum?common.format.number(w.autobudget_sum,2):"");s();v()}c()}})(jQuery,window.Lego);(function(b,a){a.block["b-strategy-select__hidden"]=function(g){var e=b(this),c=g.model,d={};b("[class^=b-ss__hidden__]",e).each(function(l,j){d[j.className.match(/b-ss__hidden__(\S+)/)[1]]=j});c.bind("change.autobudget",h);function h(){d["min-price-guarantee"].value=c.min_price_guarantee()||"";d["min-price-premium"].value=c.min_price_premium()||"";d.autobudget.value=c.autobudget()||""}h()}})(jQuery,window.Lego);(function(b,a){a.block["b-strategy-select__ajax"]=function(d){var j=b(this),h=b(".b-ss__save",j),m=b(".b-ss__cancel",j),g=d.model,e=h.val(),o=g.getData();h.attr("disabled",false);m.attr("disabled",false);h.click(function(){if(c()){l(true);b.ajax({url:SCRIPT,data:b.extend(n(),{cid:d.cid,cmd:"ajaxSaveAutobudget",ulogin:d.ulogin}),complete:function(q){if(q.responseText){alert(q.responseText);l(false)}else{location.reload()}}})}});j.data("api",{cancel:function(){g.update(o);j.toggle()},toggle:function(){if(j.is(":visible")){j.data("api").cancel()}else{j.toggle()}}});m.click(j.data("api").cancel);function n(){var q=direct.formsedit.campaignModel.modelToStrategy(g).strategy;if(q!="autobudget"&&q!="min-price"){return{"default":1}}return{autobudget:g.autobudget()?"1":"",autobudget_sum:g.autobudget_sum(),autobudget_bid:g.autobudget_bid(),min_price_guarantee:g.min_price_guarantee(),min_price_premium:g.min_price_premium()}}function l(q){h.val(q?iget("Сохранение..."):e);h.attr("disabled",q);m.attr("disabled",q)}function c(){if(g.autobudget()){if(!g.autobudget_sum()){alert(iget("Неверно указана сумма недельного бюджета"));b(".b-ss__ajax__autobudget__sum",j).focus();return false}if(g.autobudget_sum()<10){alert(iget("Недельный бюджет не может быть меньше 10 у.е."));b(".b-ss__ajax__autobudget__sum",j).focus();return false}if(isNaN(g.autobudget_bid())){alert(iget("Неверно указана максимальная ставка"));b(".b-ss__ajax__autobudget__bid",j).focus();return false}if(g.autobudget_bid()&&g.autobudget_bid()>=g.autobudget_sum()){alert(iget("Недельный бюджет должен быть больше максимальной ставки"));b(".b-ss__ajax__autobudget__bid",j).focus();return false}if(g.autobudget_bid()&&g.autobudget_bid()>MAX_AUTOBUDGET_BID){alert(iget("Указана ставка больше %s у.е.").replace("%s",MAX_AUTOBUDGET_BID));b(".b-ss__ajax__autobudget__bid",j).focus();return false}}return true}}})(jQuery,window.Lego);(function(b,a){a.block["b-dropdown-select"]=function(l){a.block["b-dropdown"].call(this,l);var j=b(this),m=j.prev(),e=b(".b-dd-select__option",j),h=b(".b-dd-select__current",j),g=[h.html()].concat(b.map(e,function(n){return n.innerHTML})),c=b(".b-dd-select__hidden",j);j.data("selectedIndex",0);if(l.values){j.data("value",l.values[0])}e.click(function(){var q=this.innerHTML;h.html(this.innerHTML);for(var o=0,n=0;o<g.length;o++){if(g[o]==q){j.data("selectedIndex",o)}else{e[n++].innerHTML=g[o]}}if(l.values){j.data("value",l.values[j.data("selectedIndex")])}j.trigger("popupsClose.lego");j.trigger("change");c.val((l.values||g)[j.data("selectedIndex")])});if(c){var d=b.inArray(c.val(),l.values||g);if(d>0){e[d-1].triggerHandler("click")}}}})(jQuery,window.Lego);(function(b,a){a.block["b-time-targeting"]=function(g){var n=b(this),l=g.timetargetModel,d=b(".b-tmg__window"),q=n.find(".b-time-targeting-tabs"),e=n.find(".b-time-targeting-tab-table"),c=n.find(".b-time-targeting-tab-timezone"),m=n.find(".table-button-ok"),s=n.find(".table-button-cancel");b(document).bind("close.allPopups",function(){b("#timetarget-window").data("api").close()});q.bind("b-tabs.changed",o);n.bind("submitWindow.timezone",function(){e.click()});n.bind("openWindow.timezone",j);n.bind("cancelWindow.timezone",function(){e.click()});b("#timetarget-window").bind("b-window_open",function(){n.triggerHandler("show.timetable");e.click()});m.click(h);s.click(u);function h(){if(l.counter()<40){alert(common.inflector.pluralize(iget("Кампания должна быть включена не менее %d {час|часа|часов} в рабочие дни"),40))}else{l.updater();b("#timetarget-window").data("api").close()}}function u(){b("#timetarget-window").data("api").close()}function j(){n.trigger("windowOpened.timezone");c.click()}function o(v,w){if(w.selectedIndex==1){n.trigger("windowOpened.timezone")}d.toggleClass("b-tmg__window_table",w.selectedIndex==0);d.toggleClass("b-tmg__window_timezone",w.selectedIndex==1)}}})(jQuery,window.Lego);var dayNamesSelectFrom=(iget("понедельника")+" "+iget("вторника")+" "+iget("среды")+" "+iget("четверга")+" "+iget("пятницы")+" "+iget("субботы")+" "+iget("воскресенья")).split(" ");var dayNamesSelectTo=(iget("понедельник")+" "+iget("вторник")+" "+iget("среду")+" "+iget("четверг")+" "+iget("пятницу")+" "+iget("субботу")+" "+iget("воскресенье")).split(" ");function utils_add0(b){return b<10?"0"+b:b}function utils_fillDaySelects(d,b){if(d.find("options").length==0){for(var c=0,a=dayNamesSelectFrom.length;c<a;c++){d.append($('<option value = "'+(c+1)+'">'+dayNamesSelectFrom[c]+"</option>"))}}utils_updateDaySelects(d,b)}function utils_updateDaySelects(e,c){var d,b;var g=e.val()*1||0;var a=c.val();a=(a&&a>=g)?a:g;c.empty();for(d=g-1,b=dayNamesSelectTo.length;d<b;d++){c.append($('<option value = "'+(d+1)+'">'+dayNamesSelectTo[d]+"</option>"))}c.val(a);c.change()}function utils_fillHourSelects(c,a,e,d){if(c.find("option").length==0){for(var b=0;b<24;b++){c.append($('<option value="'+b+'">'+utils_add0(b)+":00</option>"))}c.val(e)}utils_updateHourSelects(c,a,e,d)}function utils_updateHourSelects(d,b,h,e){var g=h*1||d.val()*1||0;var a=e||b.val();a=(a&&a>g)?a:g+1;b.empty();for(var c=g+1;c<=24;c++){b.append($('<option value="'+c+'">'+utils_add0(c)+":00</option>"))}b.val(a);b.change()}(function(b,a){a.block["b-time-targeting__table"]=function(X){var u=b(this),Z=X.isEasy,E=X.initOnLoad,K=X.timetargetModel;var q=(new Date()).getTime();var L=b(".b-time-targeting");var O=b(".b-time-targeting-counter-container");var g=b(".b-time-targeting-counter");var d,z,Y;var v=new RegExp("^"+q+"_d_(\\d)_h_(\\d*)$");var B,M={},A={};var N="ABCDEFGHIJKLMNOPQRSTUVWX".split("");var w="";var H='<col class="fixed-width-col"></col><col class="fixed-width-col"></col>';for(var V=0;V<24;V++){w+='<td><div id="${prefix}_d_${day_number}_h_'+V+'" class="td-content">−</td>';H+='<col class="fixed-width-col"></col>'}var o=["x",iget("Пн."),iget("Вт."),iget("Ср."),iget("Чт."),iget("Пт."),iget(" Сб."),iget("Вс.")];var R='<tr class="tr_d_${day_number}"><th class="d${day_number}" id="th_d_${day_number}_label"><label class="day-label" for="${prefix}_d_${day_number}">${day_name}</label></th><th id="th_d_${day_number}"><input type="checkbox" id="${prefix}_d_${day_number}"></th>'+w+"</tr>";var D=(Z)?('<div class="select-all" title="'+iget("Выбрать все")+'"></div>'):"";var y='<table cellpadding="0" cellspacing="0" class="timetable">'+H+"<tbody>${rows}</tbody><tfoot><tr><th></th><th>"+D+'</th>${checkboxes}</tr><tr><th></th><th class="axis-label"><div class="axis-label-c"></div></th>${labels}</tr></tfoot></table>';var j='<th id="th_h_${hour_number}"><input type="checkbox" id="${prefix}_h_${hour_number}"></th>';var C='<th id="th_h_${hour_number}_label" class=" h${hour_number}"><label class="hour-label" for="${prefix}_h_${hour_number}">${hour_name}</label></th>';L.bind("show.timetable",aa);b(document).bind("external_change.timeTarget",function(ae){if(B){h(K.timeTarget())}});if(E){aa()}function aa(){if(!B){ac()}h(K.timeTarget())}function ac(){var af={rows:"",checkboxes:"",labels:"",prefix:q};for(var ae=1;ae<8;ae++){af.rows+=common.template.evaluate(R,{day_number:ae,day_name:iget(o[ae]),prefix:q})}for(ae=0;ae<24;ae++){var ag={prefix:q,hour_number:ae,hour_value:N[ae],hour_name:utils_add0(ae)+":00&mdash;"+utils_add0((ae+1)%24)+":00"};af.checkboxes+=common.template.evaluate(j,ag);af.labels+=common.template.evaluate(C,ag)}u.html(common.template.evaluate(y,af));B=u.find("table");d=u.find(".select-all");S();if(b.browser.msie){B.bind("selectstart",function(){return false})}d.click(W);B.bind("mouseover mouseout",c);B.bind("mouseup",ad);B.bind("mousedown",U);B.click(e)}function S(){z={};var ae=B.children("tbody").children("tr");ae.each(function(){var af=b(this).children("td");af.each(function(aj){var ak=b(this).children(".td-content");var ai=ak[0].id.match(v);var ah=ai[1];var ag=ai[2];z[ak[0].id]={daysThs:[b("#th_d_"+ah)[0],b("#th_d_"+ah+"_label")[0]],hourThs:[b("#th_h_"+ag)[0],b("#th_h_"+ag+"_label")[0]],parent:ak[0].parentNode}})})}function ad(ae){Y=null}function U(ag){var af=ag.target||ag.srcElement;if(af.tagName.toLowerCase()=="div"&&af.className.indexOf("td-content")!=-1){var ae=z[af.id].parent.className.indexOf("on")==-1;n(af,ae);Y=ae?"on":"off";return false}}function c(ag){var ae=ag.target||ag.srcElement;if(ae.tagName.toLowerCase()=="div"&&ae.className.indexOf("td-content")!=-1){if(ae.className.indexOf("td-content-hover")==-1&&(ag.type!="mouseout")){if(!z[ae.id]){return}ae.className+=" td-content-hover";for(var af=0;af<2;af++){z[ae.id].hourThs[af].className+=" hover";z[ae.id].daysThs[af].className+=" hover"}}if(ae.className.indexOf("td-content-hover")!=-1&&(ag.type=="mouseout")){if(!z[ae.id]){return}ae.className=ae.className.replace("td-content-hover","");for(var af=0;af<2;af++){z[ae.id].hourThs[af].className=z[ae.id].hourThs[af].className.replace("hover","")}for(var af=0;af<2;af++){z[ae.id].daysThs[af].className=z[ae.id].daysThs[af].className.replace("hover","")}}if(ag.type=="mouseover"&&Y){if(!z[ae.id]){return}n(ae,Y=="on")}}}function e(af){var ag=af.originalTarget||af.srcElement;if(!ag){return}var ae=ag.tagName.toUpperCase();switch(ag.tagName.toUpperCase()){case"INPUT":I(b(ag));return}}function W(ae){if(d.hasClass("select-all-disabled")){return}d.addClass("select-all-disabled");s(B.find(".td-content"),1);m(0,0,1);J();Q()}function I(ah){var ag=ah.attr("id").match(/d_(\d)/);var af=ah.attr("id").match(/h_(\d{1,2})/);var ae=ah.attr("checked");if(ag){G(ag[1],ae)}else{if(af){T(af[1],ae)}}}function G(ae,ag){var af=B.find(".td-content[id^="+q+"_d_"+ae+"]");m(ae,0,ag);s(af,ag);J(ae);Q(ae,0);l()}function T(ae,ag){var af=B.find(".td-content[id$=h_"+ae+"]");m(0,ae,ag);J(0,ae);s(af,ag);Q(0,ae);l()}function s(ag,ae){if(ae){for(var af=0;af<ag.length;af++){ag[af].innerHTML="+";if(z[ag[af].id].parent.className.indexOf("on")==-1){z[ag[af].id].parent.className+=" on"}}}else{for(var af=0;af<ag.length;af++){ag[af].innerHTML="−";z[ag[af].id].parent.className=z[ag[af].id].parent.className.replace("on","")}}}function n(ag,ae){var af=ag.id.match(v);m(af[1],af[2],ae);s([ag],ae);J(af[1],af[2]);Q(af[1],af[2]);l()}function m(aj,ae,ah){P(aj,ae,ah);var ai="";for(var ag=1;ag<8;ag++){if(M[ag].count!=0){ai+=ag;for(var af=0;af<24;af++){if(M[ag][af]){ai+=N[af]}}}}K.update({timeTarget:ai},u);ab()}function ab(){var ae=F();g.html(ae);K.update({counter:ae},u);O.toggleClass("counter-error",ae<40)}function F(){var af=0;for(var ae=1;ae<6;ae++){af+=M[ae].count*1}return af}function P(aj,ae,ai){if(aj&&ae){if(M[aj][ae]!=ai){M[aj][ae]=ai;M[aj].count=(ai)?M[aj].count+1:M[aj].count-1;A[ae][aj]=ai;A[ae].count=(ai)?A[ae].count+1:A[ae].count-1}}if(!aj&&ae){A[ae].count=(ai)?7:0;for(var ah=1;ah<8;ah++){A[ae][ah]=ai;if(ai&&!M[ah][ae]){M[ah].count+=1}if(!ai&&M[ah][ae]){M[ah].count-=1}M[ah][ae]=ai}}if(!ae&&aj){M[aj].count=(ai)?24:0;for(var ah=0;ah<24;ah++){M[aj][ah]=ai;if(ai&&!A[ah][aj]){A[ah].count+=1}if(!ai&&A[ah][aj]){A[ah].count-=1}A[ah][aj]=ai}}if(!aj&&!ae){for(var ag=1;ag<8;ag++){M[ag].count=0;for(var af=0;af<24;af++){M[ag][af]=ai;if(ai){M[ag].count+=1}}}for(var af=0;af<24;af++){A[af].count=0;for(var ag=1;ag<8;ag++){A[af][ag]=ai;if(ai){A[af].count+=1}}}}}function x(){for(var af=1;af<=7;af++){M[af]={count:0};for(var ae=0;ae<24;ae++){M[af][ae]=0;M[af].count=0}}for(var ae=0;ae<24;ae++){A[ae]={count:0};for(var af=1;af<=7;af++){A[ae][af]=0;A[ae].count=0}}}function h(al){x();var af=al.match(/\d/g);var ae=al.split(/\d/);if(!af||!ae||al.indexOf("-")!=-1||af.length>7||ae.length>24){B.find("td").addClass("on").find(".td-content").text("+");P(null,null,1)}else{B.find("td").removeClass("on").find(".td-content").text("−");if(!b.browser.msie){ae=ae.slice(1)}var am,ah,ag,ak;for(var aj=0;aj<af.length;aj++){am=af[aj]*1;ak=ae[aj].split("");for(var ai=0;ai<ak.length;ai++){ah=N.indexOf(ak[ai]);M[am][ah]=1;M[am].count+=1;A[ah][am]=1;A[ah].count+=1;var an=b("#"+q+"_d_"+am+"_h_"+ah);s(an,1)}}}J();Q();l();ab()}function l(){var ae=true;for(var af=1;af<8;af++){ae=ae&&(M[af].count==24)}d.toggleClass("select-all-disabled",ae)}function J(af,ae){if(af){b("#"+q+"_d_"+af).attr("checked",M[af].count==24)}else{for(var ag=1;ag<=7;ag++){b("#"+q+"_d_"+ag).attr("checked",M[ag].count==24)}}if(ae){b("#"+q+"_h_"+ae).attr("checked",A[ae].count==7)}else{for(var ag=0;ag<24;ag++){b("#"+q+"_h_"+ag).attr("checked",A[ag].count==7)}}}function Q(af,ae){if(af){b("label[for="+q+"_d_"+af+"]").toggleClass("day-disabled",M[af].count==0)}else{for(var ag=1;ag<=7;ag++){b("label[for="+q+"_d_"+ag+"]").toggleClass("day-disabled",M[ag].count==0)}}if(ae){b("label[for="+q+"_h_"+ae+"]").toggleClass("hour-disabled",A[ae].count==0)}else{for(var ag=0;ag<24;ag++){b("label[for="+q+"_h_"+ag+"]").toggleClass("hour-disabled",A[ag].count==0)}}}}})(jQuery,window.Lego);(function(b,a){a.block["b-time-targeting__timezone"]=function(e){var n=b(this),o=e.data,m=e.timetargetModel,u=b(".b-time-targeting"),j=n.find(".timezone-select"),w=n.find(".timezone-gropus-select");var h=b(".timezone-button-ok");var s=b(".timezone-button-cancel");w.change(g);h.click(c);s.click(q);u.bind("windowOpened.timezone",v);function v(){var x=l();if(w.attr("selectedIndex")!=x[0]||j.find("option").length==0){w.attr("selectedIndex",x[0]);d(x[0])}j.attr("selectedIndex",x[1])}function q(){u.triggerHandler("cancelWindow.timezone")}function l(){if(!m.timezone_id()){return[0,0]}for(var y in o){for(var x=0;x<o[y].length;x++){if(m.timezone_id()==o[y][x].id){return[y,x]}}}return[0,0]}function c(y){var x=j.find("option:selected");m.update({timezone_id:x.val(),timezone_text:x.text()},n);u.triggerHandler("submitWindow.timezone")}function g(){var x=w.val();d(x)}function d(y){j.empty();if(!o[y]){return}for(var x=0;x<o[y].length;x++){j.append(b('<option value="'+o[y][x].id+'">'+o[y][x].name+"</option>"))}j.val(o[y][0].id)}}})(jQuery,window.Lego);(function(b,a){a.block["b-time-targeting__timezone-link"]=function(l){var h=b(this),c=l.timetargetModel,d=b(".b-time-targeting"),g=h.find(".timezone-link-text");c.bind("change.timezone",e);g.click(j);function e(m){g.html(c.timezone_text())}function j(){d.trigger("openWindow.timezone")}}})(jQuery,window.Lego);(function(b,a){a.block["b-time-targeting__holidays"]=function(d){var h=b(this),g=d.timetargetModel,l=h.find(".time-holidays-controls");var m=b(".b-time-targeting");n();g.bind("change.holiday",function(o){if(o.source==h){return}b("#holiday_show").attr("checked",!g.time_target_holiday_dont_show());b("#holiday_dontshow").attr("checked",g.time_target_holiday_dont_show());b("#holiday_time_from").val(g.time_target_holiday_from());utils_updateHourSelects(b("#holiday_time_from"),b("#holiday_time_to"),g.time_target_holiday_from(),g.time_target_holiday_to());b("#holidays").attr("checked",g.time_target_holiday());j(g.time_target_holiday_dont_show());h.toggleClass("b-time-targeting__holidays-show",g.time_target_holiday()==1)});b("#holiday_show").click(function(o){j(false);g.update({time_target_holiday_dont_show:0},h);return true});b("#holiday_dontshow").click(function(){j(true);g.update({time_target_holiday_dont_show:1},h);return true});b("#holiday_time_from").change(function(){g.update({time_target_holiday_from:b(this).val()},h);utils_updateHourSelects(b("#holiday_time_from"),b("#holiday_time_to"))});b("#holiday_time_to").change(function(){g.update({time_target_holiday_to:b(this).val()},h)});b("#holidays").click(c);function n(){if(b("#holiday_time_from").find("option").length>0){b("#holiday_time_from").val(g.time_target_holiday_from());b("#holiday_time_to").val(g.time_target_holiday_to())}else{utils_fillHourSelects(b("#holiday_time_from"),b("#holiday_time_to"),g.time_target_holiday_from(),g.time_target_holiday_to());j(g.time_target_holiday_dont_show())}}function j(o){b("#holiday_time_from").attr("disabled",o);b("#holiday_time_to").attr("disabled",o)}function c(o){g.update({time_target_holiday:this.checked?1:0},h);h.toggleClass("b-time-targeting__holidays-show",this.checked)}function e(){b("#holiday_time_from").val(g.time_target_holiday_from());b("#holiday_time_to").val(g.time_target_holiday_to());utils_updateHourSelects(b("#holiday_time_from"),b("#holiday_time_to"))}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaign-form__timetargeting"]=function(A){var s=b(this),d=A.timetargetModel,g=s.find(".timetargeting-text"),q=s.find(".timetargeting-reset"),e=s.find(".timetargeting-open"),j=s.find(".b-time-targeting-result"),w=s.find(".b-time-targeting-holiday"),B=s.find(".b-time-targeting-holiday-dont-show"),n=s.find(".b-time-targeting-holiday-from"),z=s.find(".b-time-targeting-holiday-to"),D=s.find(".b-time-targeting-timezone-hidden"),y=s.find(".b-time-targeting-timezone-hidden-text");var m=b(".b-campaign-form");g.val(d.calculateText());d.bind("update.all",c);d.bind("fix-init-state",u);b(document).bind("timetargeing:init",function(E){E.preventDefault();d.saveState();o();g.val(d.calculateText())});e.click(x);q.click(function(E){E.preventDefault();h()});function o(){w.val(d.time_target_holiday());B.val(d.time_target_holiday_dont_show());n.val(d.time_target_holiday_from());z.val(d.time_target_holiday_to());D.val(d.timezone_id());y.val(d.timezone_text());j.val(d.timeTarget())}function l(){return{time_target_holiday:w.val(),time_target_holiday_dont_show:B.val(),time_target_holiday_from:n.val(),time_target_holiday_to:z.val(),timezone_id:D.val(),timezone_text:y.val(),timeTarget:j.val()}}function c(){o();q.removeClass("g-hidden");g.val(d.calculateText())}function x(E){E.preventDefault();if(b("#timetarget-window").data("api").visible()){b("#timetarget-window").data("api").close()}else{b(document).trigger("b-window_close-all");var F=l();d.update(F,s);b("#timetarget-window").data("api").attach(b("#set_time_target")[0],"t_equal")}}function v(E){var F=d.getData();h(F)}function C(){g.val(d.calculateText());q.removeClass("g-hidden")}function u(){q.addClass("g-hidden");o();g.val(d.calculateText());d.staticData=d.getData()}function h(E){if(E){d.update(E,s);d.saveState()}else{d.update(d.staticData)}q.addClass("g-hidden");o();g.val(d.calculateText())}}})(jQuery,window.Lego);(function(b,a){a.block["b-modify-user"]=function(j){var u=b(this),s=j.isSuper,h=u.find(".b-modify-user-city"),e=u.find(".b-modify-user-geoId"),d=u.find(".b-modify-user-submit"),l=u.find(".b-modify-user-api-units-factor"),v=u.find(".b-modify-user-fio"),o=u.find(".b-modify-user-phone"),q=u.find(".b-modify-user-email"),g=u.find(".b-modify-user-my-pages");var c={};n();d.click(m);function n(){c.myPages=g.attr("checked")}function m(){var w=g.attr("checked");if(w!=c.myPages){if(!confirm(w?iget("Вы дали агентству право размещать кампании только на собственных отдельных площадках: tut.by. Сохранить?"):iget("Вы отменили агентству право размещать кампании только на собственных отдельных площадках: tut.by. При сохрании все кампании субклиентов, показывающиеся только на tut.by, будут показываться на всех площадках Яндекса и РСЯ. Сохранить?"))){return false}}if(j.isSuper){if(b.isEmpty(h.val())){alert(iget("Введите название города!"));h.focus();return false}else{if(b.isEmpty(e.val())){alert(iget("Неправильно введено название города!"));h.focus();return false}}}if(l.length){if(!l.val().match(/^\d+(\.\d+)?$/)){alert(iget("Неверно указан коэффициент для баллов в АПИ"));l.focus();return false}}if(!v.val()){alert(iget("Введите имя"));v.focus();return false}if(o.attr("type")=="text"&&!o.val()){alert(iget("Введите телефон"));o.focus();return false}if(!q.val()||!direct.utils.validateEmail(q.val())){alert(iget("Введите корректный e-mail"));q.focus();return false}u.submit()}}})(jQuery,window.Lego);Lego.block["b-minus-words"]=function(params){var $this=$(this),model=params.model;words=$(".b-minus-words__textarea"),submit=$(".b-minus-words__submit");submit.click(function(e){e.preventDefault();if(words.attr("value")!=model.minus_words()){submit.attr("disabled",true);$.ajax({url:"/registered/main.pl",type:"POST",data:{cmd:"ajaxCheckCampMinusWords",minus_words:words.val(),cid:params.cid,ulogin:window.ulogin,on_success_save:1},success:function(string,code,xhr){var data;try{data=eval("("+string+")")}catch(e){}if(data&&data.error){if(confirm(data.error)){$.ajax({url:"/registered/main.pl",type:"POST",data:{cmd:"ajaxCheckCampMinusWords",minus_words:words.val(),cid:params.cid,ulogin:window.ulogin,force_save:1},success:function(string){location.reload()},error:function(xhr,code,e){alert(iget("Ошибка запроса. Попробуйте ещё раз."));submit.attr("disabled",false)}})}submit.attr("disabled",false)}else{location.reload()}},error:function(xhr,code,e){alert(iget("Ошибка запроса. Попробуйте ещё раз."));submit.attr("disabled",false)}})}else{$(document).trigger("b-window_close-all")}})};(function(b,a){a.block["b-pay-button"]=function(h){var m=b(this),o=m.find(".b-pay-button-pay-type"),n=m.find(".b-pay-button-payment-coupon"),c=m.find(".b-pay-button-ya-money-button"),e=m.find(".b-pay-button-button"),j=m.find(".b-pay-button-sum");c.click(l);e.click(g);function q(){var v=["carefree","self"];var u;var s=false;for(var w=0;w<j.length;w++){var B=b(j[w]).parents(".b-campaign-list__searchable");if(B&&B[0].style.display=="none"){continue}var x=j[w].className.match(/sum_(\d+)/);var z=x[1];x=j[w].className.match(/grop-\d*_(\S+)/);var A=x&&x[1]||"-",y=common.parse.number(j[w].value);if(!j[w].value){continue}else{if(u&&u!=A&&(b.inArray(A,v)==-1||b.inArray(u,v)==-1)){alert(iget("Вы не можете одновременно оплачивать кампании с разным типом обслуживания"));j[w].focus();return false}else{if(y==0||isNaN(y)){alert(iget("Неправильно указана сумма в кампании №")+z);j[w].focus();return false}else{s=true}}}u=A}if(!s){alert(iget("Не указана сумма к оплате"));return false}if(n.length>0&&!validate_coupon()){alert(iget("Неверный промо-код"));n.focus();return false}return true}function d(){try{yaCounter191494.reachGoal("PAY-PROF")}catch(s){}m.submit()}function l(){o.attr("name","yamoney_camps");if(q()){d();return true}}function g(){o.attr("name","money_type");if(q()){d();return true}}}})(jQuery,window.Lego);(function(b,a){a.block["b-phrases-form"]=function(g){var e=b(this),d=null,c=null;e.click(function(j){var h=b(j.target);if(h.hasClass("b-pf__action")){h.addClass("b-pf__action_state_loading");if(d){d.removeClass("b-pf__action_state_loading")}d=h;common.loader.load(["g_uki","refineMinusWords"],function(){d.removeClass("b-pf__action_state_loading");if(d==c){return}c=d;var l=d.parents(".b-pf__action-c:eq(0)").find(".b-pf__action__input");direct.controller.refineMinusWords(l,(g.model?g.model.geo():b("[name=geo]").val()),function(m){l.val(m).trigger("change")})})}})}})(jQuery,window.Lego);(function($,Lego){var charsLimit=4096,url="/registered/main.pl",inputNames=["request_count","nonempty_answers","clear_count","add_one_phrase_count","add_all_count","added_phrases_count","refine_count"],confirmClearMessage=iget("Вы действительно хотите удалить все ключевые фразы?"),cache={};Lego.block["b-word-suggestions"]=function(params){var $this=$(this),bid=params.bid,model=params.model,elements={},parentTable=$this.parents("table:eq(0)"),splitted=params.splitted&&$(params.splitted),hiddenInputs={},iteration=0,lastUpdateText,upTimeout,tipsTimeout,loadedTips,lastUrlPhrases;render();parse();attachThisControlToOldPhrases();createHiddenInuts();bindEvents();restoreHiddenState();$this.addClass("b-word-suggestions_tips_no").addClass("b-word-suggestions_loaded_no");if(params.loadOnInit){loadTips();onTextUpdate()}else{elements["tips-load"].show();onTextUpdate(true)}updateModel();$this.data("api",{addAllPhrases:addAllPhrases,getAllPhrases:getAllPhrases,getLength:getLength,getCharsLeft:getCharsLeft,addPhrase:addPhrase,update:onUpdate});function attachThisControlToOldPhrases(){elements["old-phrases"].data("wordSuggestionsBlock",$this)}function appendPhrase(text){var rawValue=$.trim(elements.phrases.val());if(text&&rawValue&&!elements.phrases.val().match(/(\n|,)\s*$/)){text=", "+text}elements.phrases.val(elements.phrases.val()+text)}function addPhrase(text){text=$.trim(text);if(getAllPhrases().indexOf(text)!=-1){return}appendPhrase(text);incHidden("added_phrases_count");incHidden("add_one_phrase_count");onTextUpdate();updateModel()}function addAllPhrases(phrases){var phrasesToAdd=[],allPhrases=getAllPhrases();for(var i=0,l=phrases.length;i<l;i++){if(allPhrases.indexOf(phrases[i])==-1){phrasesToAdd.push(phrases[i]);incHidden("added_phrases_count")}}appendPhrase(phrasesToAdd.join(", "));incHidden("add_all_count");onTextUpdate();updateModel()}function getUnsplittedPhrases(){var phrases=$.trim(elements.phrases.val());if(phrases){return $.grep($.map(phrases.split(/\s*(?:\,|\r?\n)[\,\r\n\s]*/),$.trim),function(item){return item.length>0})}else{return[]}}function getPhrases(){var result=getUnsplittedPhrases();if(splitted){result=result.concat(splitted.data("api").getAllPhrases())}return result}function getOldPhrases(){var result=[];elements["old-phrases"].each(function(i,input){var phrase=$.trim(input.value.replace(/,/,""));if(!$.isEmpty(phrase)){result.push(phrase)}});if(typeof(phrases)!="undefined"){for(var i=0;i<phrases.length;i++){if(phrases[i].enable){result.push(phrases[i].phrase)}}}return result}function getAllPhrases(){return getOldPhrases().concat(getPhrases())}function getLength(){var phrases=getAllPhrases();return phrases.join(",").length}function getCharsLeft(){var charsLeft=charsLimit-getLength();return charsLeft}function setTipsTimeout(){clearTipsTimeout();tipsTimeout=setTimeout(function(){if(lastUpdateText!=getAllPhrases().join(",")){}iteration=0;loadTips()},1000)}function clearTipsTimeout(){if(tipsTimeout){clearTimeout(tipsTimeout)}}function updatePhrasesCounter(){var length=getCharsLeft();elements["word-counter"].toggleClass("b-word-suggestions_counter_overflow",length<0).html(length)}function parse(){$.each("successful-url-suggest phrases phrases-container label label-splitted tips refine-link tips-container order-link clear-link more-link before-link open-link close-link add-all-link word-counter old-phrases tips-list tips-message tips-load tips-load-link".split(" "),function(){elements[this]=$(".b-word-suggestions__"+this,$this)});elements["old-phrases"]=$(params.oldPhrases||elements["old-phrases"]);elements["open-link"]=$(params.openLink||elements["open-link"]);elements.label=$(params.normalLabel||elements.label);elements["label-splitted"]=$(params.splittedLabel||elements["label-splitted"])}function updateModel(){if(model){model.update({all_phrases:getAllPhrases()})}$this.trigger("b-word-suggestions_change")}function setUrlPhrasesTimeout(){if(upTimeout){clearTimeout(upTimeout)}upTimeout=setTimeout(function(){onUrlChanged({url:model.href().href()})},500)}function loadTips(){$this.removeClass("b-word-suggestions_loaded_no");onTipsUpdated({phrases:[],is_something_after:"",is_something_before:""});var phrases=getAllPhrases();lastUpdateText=phrases.join(",");elements["tips-list"].html("");if(phrases.length>0){elements["tips-container"].addClass("b-word-suggestions_tips_loading");$.cachedAjax({cacheKey:generateId(phrases),url:SCRIPT,type:"POST",dataType:"text",data:{cmd:"ajaxGetSuggestion",srcPhrases:phrases.join(","),n:8,brief:"yes",iteration:iteration},success:function(data){var result=eval("("+data+")");processNewTips({phrases:result.phrases||[],is_something_after:result.is_something_after,is_something_before:result.is_something_before})},error:function(){processNewTips({phrases:[],is_something_before:"",is_something_after:""})}});incHidden("request_count")}else{showMessage(iget("Укажите одну или несколько ключевых фраз&hellip;"));setInstructionHidden(true)}}function onTextUpdate(skipSchedule){skipSchedule||setTipsTimeout();updatePhrasesCounter();$this.toggleClass("b-word-suggestions_phrases_no",getUnsplittedPhrases().length==0);$this.toggleClass("b-word-suggestions_all_phrases_no",getAllPhrases().length==0);if(hiddenInputs.value){hiddenInputs.value.val(getPhrases())}}function bindEvents(){elements["clear-link"].click(function(){if(params.confirmClear&&!confirm(confirmClearMessage)){return}elements.phrases.val("");incHidden("clear_count");onTextUpdate();updateModel()});elements["more-link"].click(function(){iteration+=1;clearTipsTimeout();loadTips()});elements["before-link"].click(function(){iteration=0;clearTipsTimeout();loadTips()});elements["order-link"].click(function(){var phrases=unique(getPhrases());phrases.sort();elements.phrases.val(phrases.join(",\n"))});elements["refine-link"].click(onSplit);elements["add-all-link"].click(function(){addAllPhrases(loadedTips);onTextUpdate()});elements["close-link"].click(function(){setHidden(true)});elements["open-link"].click(function(){setHidden(false)});elements["tips-load-link"].click(function(){if(getAllPhrases().length){elements["tips-load"].hide();loadTips()}});if(splitted){splitted.bind("b-word-suggestions__splitted_keyup",onTextUpdateByKey);splitted.bind("b-word-suggestions__splitted_change",onUpdate);splitted.bind("b-word-suggestions__splitted_remove",updateSplitted)}elements.phrases.bind("keyup",onTextUpdateByKey);elements.phrases.bind("change blur",onUpdate);elements["old-phrases"].bind("keyup",onTextUpdateByKey);elements["old-phrases"].bind("change blur",onUpdate);if(model){model.href().bind("finishEditing.url",setUrlPhrasesTimeout)}}function onTextUpdateByKey(){onTextUpdate(false)}function updateSplitted(){var phrases=splitted.data("api").getAllPhrases();elements.label.toggle(!phrases.length);elements["label-splitted"].toggle(!!phrases.length)}function onSplitComplete(result){var error=$(result).find("error");if(error.length>0){var errorCode=error.text();alert(errorCode)}else{var phrases=$.map($(result).find("phrase"),function(p){return $(p).text()}),index={};$.each(splitted.data("api").getAllPhrases().concat(getOldPhrases()),function(){index[stripMinusWords(this)]=true});phrases=$.grep(phrases,function(p){return !index[stripMinusWords(p)]});$.each(phrases,function(i,phrase){splitted.data("api").addPhrase(phrase,$this)});elements.phrases.val("");onTextUpdate();updateSplitted()}}function onSplit(){var index={};$.ajax({url:"/registered/main.pl",dataType:"xml",data:{cmd:"ajaxTestPhrases",phrases:unique(getUnsplittedPhrases()).join(",")},type:"POST",success:onSplitComplete});incHidden("refine_count")}function onUpdate(){onTextUpdate();updateModel()}function incHidden(name){hiddenInputs[name].val(hiddenInputs[name].val()*1+1)}function restoreHiddenState(){if(!bid){return}var c=direct.UserOptions.get("word_suggestions");if(c&&c!="false"){setHidden(true)}}function processNewTips(result){onTipsUpdated(result,true);var tips=result.phrases||[];if(tips.length!=0){renderTips(tips);incHidden("nonempty_answers");hideMessage();setInstructionHidden(false)}else{showMessage(iget("Нет подсказок для данного набора ключевых фраз"));setInstructionHidden(true)}elements["tips-container"].removeClass("b-word-suggestions_tips_loading")}function onTipsUpdated(result,addObseverer){elements["more-link"].toggle(!!result.is_something_after);elements["before-link"].toggle(!!result.is_something_before&&!result.is_something_after);var tips=result.phrases||[];loadedTips=tips;$this.toggleClass("b-word-suggestions_tips_no",tips.length==0)}function renderTips(tips){elements["tips-list"].html("");for(var i=0,l=tips.length;i<l;i++){var node=$('<li class="b-word-suggestions__tip"><span class="b-word-suggestions__tip-link">'+$.escapeHTML(tips[i])+"</span></li>").data("word",tips[i]);$("span",node).click(function(){addPhrase($(this).parent().data("word"));onTextUpdate()});elements["tips-list"].append(node)}}function showMessage(text){elements["tips-message"].html(text).show()}function hideMessage(){elements["tips-message"].hide()}function setHidden(state){$this.toggleClass("b-word-suggestions_hidden_tips",state);elements["open-link"].toggle(state);direct.UserOptions.set("word_suggestions",state+"");elements["tips-container"].toggle(!state);setInstructionHidden(state||loadedTips.length==0)}function setInstructionHidden(state){state=state||elements["tips-container"].is(":hidden");if(params.instruction){$(params.instruction).toggle(!state)}}function onUrlChanged(params){var url=params.url;if(getAllPhrases().length!=0||!$.validateHref(url)){return}lastUrlPhrases=url.replace(/\+/g,"%20");$.ajax({type:"get",dataType:"text",url:SCRIPT,success:function(data){var result=eval("("+data+")");if(result.url!=lastUrlPhrases||getAllPhrases().length!=0){return}elements["successful-url-suggest"].val(1);addAllPhrases(result.phrases)},data:{cmd:"ajaxGetUrlPhrases",detail:0,url:params.url}})}function createHiddenInuts(){var suffix=bid?"_"+bid:"";$.each(inputNames,function(){hiddenInputs[this]=$('<input type="hidden" name="suggest_'+this+'" value="0">');hiddenInputs[this].appendTo($this)});if(params.saveToHidden){hiddenInputs.value=$('<input type="hidden" class="b-word-suggestions__hidden" name="'+params.saveToHidden+'" value="">');hiddenInputs.value.appendTo($this).bind("change",updateFromHidden)}}function updateFromHidden(){var index={};$.each(getAllPhrases(),function(){index[stripMinusWords(this)]=true});var newPhrases=$.grep(hiddenInputs.value.val().split(/\s*,\s*/),function(phrase){return !index[stripMinusWords(phrase)]});if(newPhrases.length){appendPhrase(newPhrases.join(", "))}onTextUpdate()}function render(){var textarea=$("textarea",$this).addClass("b-word-suggestions__phrases"),urlSuggestionSuccess=params.isNew?'<input type="hidden" value="0" name="suggest_by_url_successful" class="b-word-suggestions__successful-url-suggest"></input>':"";hideLink=params.openLink?'<span class="b-word-suggestions__close-link"><span class="b-pseudo-link">'+iget("скрыть")+"</span></span>":"",html='<table class="b-word-suggestions__table"><tr><td class="b-word-suggestions__td b-word-suggestions__phrases-container"><textarea>'+$.escapeHTML(params.value)+"</textarea>"+urlSuggestionSuccess+'<div class="b-word-suggestions__toolbar"><div class="b-word-suggestions__clear-link"><span class="b-pseudo-link">'+iget("очистить")+"</span></div>"+(!params.splitted?'<div class="b-word-suggestions__order-link"><span class="b-pseudo-link">'+iget("упорядочить")+"</span></div>":"")+(params.splitted?'<div class="b-word-suggestions__refine-link"><span class="b-pseudo-link">'+iget("упорядочить и уточнить")+"</span></div>":"")+'<div class="b-word-suggestions__word-counter">'+charsLimit+'</div></div></td><td class="b-word-suggestions__td b-word-suggestions__tips-container"><div class="b-word-suggestions__toolbar-header"><h3 class="b-word-suggestions__toolbar-header-title">'+iget("Подсказки")+" "+hideLink+'</h3></div><div class="b-word-suggestions__tips"><p class="b-word-suggestions__tips-message">'+iget("Укажите одну или несколько ключевых фраз…")+'</p><ul class="b-word-suggestions__tips-list"></ul><p class="b-word-suggestions__tips-load" style="dispaly: none"><span class="b-pseudo-link b-word-suggestions__tips-load-link">'+iget("Загрузить подсказки")+'</span></p></div><div class="b-word-suggestions__toolbar-more"><div class="b-word-suggestions__before-link"><span class="b-pseudo-link"><span>'+iget("в начало")+'</span></span></div><div class="b-word-suggestions__more-link"><span class="b-pseudo-link"><span>'+iget("еще")+'</span></span></div></div><div class="b-word-suggestions__toolbar"><div class="b-word-suggestions__add-all-link"><span class="b-pseudo-link"><span>'+iget("все подходят")+'</span></span></div></div><div class="b-word-suggestions__tips-spacer"></div></td></tr></table>',element=$(html);$("textarea",element).replaceWith(textarea);$this.append(element)}function generateId(phrases){return phrases.sort().join(",")+"&"+iteration}function unique(array){var ret=[],done={};for(var i=0,length=array.length;i<length;i++){var id=stripMinusWords(array[i]);if(!done[id]){done[id]=true;ret.push(array[i])}}return ret}var stripRE=/\s+-.*/;function stripMinusWords(phrase){return phrase.replace(stripRE,"")}}})(jQuery,window.Lego);(function(b,a){a.block["b-word-suggestions__splitted"]=function(l){var j=b(this),g=j.parents(".b-word-suggestions__splitted-container:eq(0)");j.data("api",{addPhrase:h,getAllPhrases:d});function h(q,m){g.show();var n='<table class="b-pf__action-c"><tr><td class="b-pf__action__input-c"><input value="'+b.escapeHTML(q)+'" tabindex="1" class="b-word-suggestions__splitted__input b-pf__input b-pf__action__input" /></td><td class="b-pf__action__action-c"><span class="b-pf__action">'+iget("уточнить")+"</span></td></tr></table>",o=b(n);j.append(o);b(".b-word-suggestions__splitted__input",o).bind("keyup",e).bind("blur change",c).blur(function(){if(!this.value.match(/\S/)){o.remove()}j.trigger("b-word-suggestions__splitted_remove");g.toggle(!!b(".b-word-suggestions__splitted__input",j).length)}).data("wordSuggestionsBlock",m?m:{})}function d(){return b.grep(b.map(b(".b-word-suggestions__splitted__input",j),function(m){return b.trim(m.value)}),function(m){return !!m})}function e(){j.trigger("b-word-suggestions__splitted_keyup")}function c(){j.trigger("b-word-suggestions__splitted_change")}}})(jQuery,window.Lego);(function(b,a){a.block["b-phrases-popup-loader"]=function(d){var c=b(this);c.click(function(){c.addClass("b-phrases-popup-loader_state_loading");common.loader.load(["g_uki","phrasesPopup"],function(){c.removeClass("b-phrases-popup-loader_state_loading");direct.controller.phrasesPopup(c[0],c.parents("table:eq(0)").find(".b-word-suggestions").data("api").getAllPhrases().join(", "))})})}})(jQuery,window.Lego);(function(c,b){var e=new RegExp("["+KAZ_LETTERS+"]"),a=new RegExp("["+UKR_NATIVE_LETTERS+"]"),d=/(www\.)?(.*)/;b.block["b-banner"]=function(E){var w=c(this),o=E.model,S=w.find(".b-banner__title__link"),z=w.find(".b-banner__body"),B=w.find(".b-banner__domain"),D=w.find(".b-banner__domain__text"),O=w.find(".b-banner__vcard"),m=w.find(".b-banner__warnings"),Q=w.find(".b-banner__domain__template-warning"),L=w.find(".b-banner__sitelinks"),j=w.find(""),y=E.href_default_value||iget("домен"),R=E.title_default_value||iget("Заголовок объявления"),P=E.body_default_value||iget("Текст вашего объявления о рекламе услуги или товара."),q={domainWarning:iget("Ссылка с заголовка ведёт на другой домен"),formatWarning:iget("Неправильный формат ссылки"),ukranianWarning:iget("Пожалуйста, убедитесь, что географический таргетинг настроен на Украину."),lengthWarning:iget("При показе на поиске Яндекса домен будет отображен в сокращенном виде (только 35 символов)"),kazakhWarning:iget("Пожалуйста, убедитесь, что выбран только один регион - «Казахстан».")},J=[],I={common:["title","body"],href:["href","domain"],vcard:["city","country","name","street","house","build","apart","country_code","city_code","phone","ext","contactperson","im_login","im_client","extra_message","contact_email","worktime","manual_bounds","manual_point","auto_bounds","auto_point","auto_precision"]};o.bind("change.with_href",N);o.bind("change.with_ci",v);o.bind("change.with_sitelinks",g);o.href().bind("change",A);o.bind("change.title",F);o.bind("change.body",M);o.sitelinks().bind("change",K);S[0].onclick=O[0].onclick=null;S.click(H).attr("href","javascript:void(0)");O.click(n).attr("href","javascript:void(0)");L.click(G);g();N();v();A();F();M();K();function N(){B[0].style.display=o.with_href()?"":"none";g();s();l()}function v(){O.toggle(!!o.with_ci());g()}function A(){var T=x();if(T.length>35){T="..."+T.substr(T.length-35,T.length)}u(D,T);s();l()}function F(){u(S,o.title()||R);s()}function M(){u(z,o.body()||P);s()}function K(){var W=[];for(var V=0;V<SITELINKS_NUMBER;V++){var U=o.sitelinks()["href"+V]()||"#",X=!o.sitelinks()["title"+V]().match(/\S/),Y=X?iget("Текст ссылки № ")+(V+1):o.sitelinks()["title"+V](),T="b-banner__sitelink";if(V==0){T+=" b-banner__sitelink_first"}if(V==SITELINKS_NUMBER-1){T+=" b-banner__sitelink_last"}if(!o.sitelinks().isEmpty()&&X){T+=" b-banner__sitelink_empty"}W.push('<a href="http://'+c.escapeHTML(U)+'" target="_blank" class="'+T+'">'+c.escapeHTML(Y)+"</a>")}L.html(W.join("<i> </i>"));s()}function u(T,U){U=c.addWbrs(U,null,"\u0003");U=U.replace(/(#[^#]*#)/g,"\u0001$1\u0002");U=c.escapeHTML(U);U=U.replace(/\u0001/g,'<span class="b-banner__template">').replace(/\u0002/g,"</span>").replace(/\u0003/g,"<wbr />");T.html(U)}function g(){var T=o.with_href()&&(o.with_sitelinks()||!o.sitelinks().isEmpty());w.toggleClass("b-banner_with_sitlinks",!!T);L.toggle(!!T);if(T){K()}s()}function s(){if(!E.updatableWarnings){return}var T=[],U=C(o.body()+o.title()+(o.with_sitelinks()?o.sitelinks().title0()+o.sitelinks().title1()+o.sitelinks().title2():""));Q.toggle(!!o.href().href().match(/\#([^\#]*?)\#/));if(U=="ua"){T.push("ukranianWarning")}if(U=="kz"){T.push("kazakhWarning")}if(o.with_href()&&o.href().domain()&&!c.validateHref(o.href().domain())){T.push("formatWarning")}if(o.with_href()&&o.href().domain()&&!h(o.href().domain_calc(),o.href().domain())){T.push("domainWarning")}if(o.with_href()&&x().length>35){T.push("lengthWarning")}if(o.with_href()&&o.href().domain_error()){T.push(o.href().domain_error())}if(J.length!=T.length||c.grep(J,function(V,W){return T[W]!=V}).length){m.toggle(!!T.length);m.html(c.map(T,function(V){return'<li class="b-banner__warning">'+c.escapeHTML(q[V]||V)+"</li>"}).join(""));J=T}}function C(T){if(T.match(e)){return"kz"}else{if(T.match(a)){return"ua"}else{return""}}}function x(){return o.href().domain()||o.href().domain_calc()||y}function h(U,T){if(!U||!T){return false}return U.match(d)[2].toLowerCase()==T.match(d)[2].toLowerCase()}function l(){if(o.with_href()&&o.href().href()&&c.validateHref(o.href().href())){if(c.browser.msie&&parseInt(c.browser.version,10)<7){S[0].href="/registered/redirect_idn.pl?url="+encodeURIComponent("http://"+o.href().href())+"&yauid="+yagetCookie("yandexuid")}else{S[0].href="http://"+o.href().href()}}else{S[0].href="javascript:void(0)";return false}return true}function H(T){if(o.with_href()){if(!l()){alert(iget("Адрес сайта не указан или указан неверно"));return false}}else{n(T)}return true}function n(X){X.preventDefault();var W=c('<form action="/registered/main.pl" method="POST" target="ContactInfoPopup"></form>');W.append(c('<input type="hidden" name="cmd" value="showContactInfo"></input>'));W.append(c('<input type="hidden" name="from" value="edit"></input>'));W.append(c('<input type="hidden" name="bid" value="0"></input>'));for(var V in I){if(V=="vcard"&&!o.with_ci()){continue}if(V=="href"&&!o.with_href()){continue}var T=(V=="common")?o:o[V]();for(var U=0;U<I[V].length;U++){var Y=I[V][U];W.append(c('<input type="hidden" name="'+Y+'" value="'+c.escapeHTML(T[Y]())+'"></input>'))}}W.append(c('<input type="hidden" name="ogrn_num" value="'+c.escapeHTML(o.vcard().ogrn().ogrn_num())+'"></input>'));W.append(c('<input type="hidden" name="org_details_id" value="'+c.escapeHTML(o.vcard().ogrn().org_details_id())+'"></input>'));c("body").append(W);OpenWindow("","800","600","ContactInfoPopup");W.submit();W.remove()}function G(V){var W=c(V.target);if(W.hasClass("b-banner__sitelink")){var U=W.prevAll(".b-banner__sitelink").length,T=o.sitelinks()["href"+U]();if(!T||!c.validateHref(T)){alert(iget("Адрес сайта не указан или указан неверно"));return false}}}}})(jQuery,window.Lego);(function(b,a){a.block["b-banner-list__region"]=function(h){var e=b(this),d,g;e.click(function(){c();var l=d.data("api");if(l.visible()&&l.attachment()==e[0]){l.close()}else{var j=e.parents(".b-banner-list__layout_type_wide").length?"bottom right":"bottom center";l.attach(e[0],j,true);g.html(h.text)}});function c(){if(d){return}d=b(".b-banner-list__region__window");g=b(".b-banner-list__region__text",d)}}})(jQuery,window.Lego);(function(b,a){a.block["b-region-selector"]=function(x){var m=b(this),w=x.path,s=m.find(".b-region-selector-text-string"),D=m.find(".b-region-selector-geo-hidden"),C=m.find(".b-region-selector-geo-warning"),n=m.find(".b-region-selector-geo-hidden-text"),B=m.find(".b-region-selector-clear-geo"),y=m.find(".b-region-selector-change-geo"),j=x.model,z=x.bid,o=x.changeGeoCounter,A=x.myId;var h={};v();c();b(document).bind("change-geo",d);if(j){j.bind("fix-init-state",q)}B.click(g);y.click(e);function v(){h.text=s.text();h.geo=D.val()}function c(){B.toggleClass("g-hidden",h.geo==D.val());C.toggleClass("g-hidden",0!=D.val())}function q(){D.val(j.geo());n.val(j.geo_text());s.text(j.geo_text());v();c()}function d(E,G){if(G.bid&&z&&G.bid!=z){return}var F=G.regions_id.match(/(.*),$/);F=F?F[1]:G.regions_id;D.val(F);n.val(G.regions_name);s.text(G.regions_name);c();u(G.bid,F,G.regions_name);D.change()}function u(F,G,E){if(j){j.update({common:{geo:G,geo_text:E}})}}function g(E){E.preventDefault();D.val(h.geo);n.val(h.text);s.text(h.text);D.change();c();b(document).triggerHandler("clear-geo")}function e(F){F.preventDefault();var E=w+"?cmd=showgeo&media=&geo="+encodeURIComponent(D.val())+"&bid="+z+"&my_id="+A;if(o){try{yaCounter292098.reachGoal("DIR-REF-REGION")}catch(G){}}l(E,700,530,"geo");return false}function l(I,G,J,F,E){var H=window.open(I,F,"width="+G+",height="+J+",status=yes,menubar=no,resizable=yes,scrollbars=1");if(E){H.focus()}return false}}})(jQuery,window.Lego);Lego.block["b-banner-user"]=function(e){var c=$(this),h=e.cid,b=e.bid,g=e.pos,d;c.click(function(){if(d){if(d.data("api").visible()){d.data("api").close()}else{$(document).trigger("b-window_close-all");d.data("api").show()}return}else{d="loading";$.ajax({url:"/registered/main.pl",type:"GET",data:{cmd:"ajaxGetBannerUserVersion",cid:h,bid:b},success:function(j){$("body").append(j);d=$(".b-banner-user__popup:last");$(document).trigger("b-window_close-all");Lego.block["b-window"].call(d,{name:"b-window",attachment:c,position:g,openOnLoad:true});a()},error:function(){alert(iget("Ошибка запроса. Попробуйте ещё раз."))}})}});function a(){$(".b-banner-user__popup__noshow .b-pseudo-link",d).click(function(){$.ajax({url:"/registered/main.pl",type:"GET",data:{cmd:"ajaxDontShowModEditNotice",bid:b}});c.hide();d.hide()})}};(function(b,a){a.block["b-phrases-list__phrase"]=function(B){var m=b(this),G=B.isFirstAid,h=B.model,o=B.cid,e=m.find("tr"),u=m.find(".b-phrases-list__phrase__radio"),g=m.find(".b-phrases-list__phrase__status-checkbox"),y=m.find(".b-phrases-list__phrase__place-info"),A=m.find(".b-phrases-list__phrase__group-checkbox"),F=["p_","fp_",""],J=["clicks","budget"],M=["clicks_price","ctr"],l={},v={};var n=["p_budget","fp_budget","budget"];var x=0;b.each(J,function(P,O){for(var N=0;N<F.length;N++){var Q=F[N]+O;l[F[N]+O]=m.find(".b-phrases-list__phrase__"+Q)}l.shows=m.find(".b-phrases-list__phrase__shows")});b.each(M,function(P,O){for(var N=0;N<F.length;N++){var Q=F[N]+O;v[F[N]+O]=m.find(".b-phrases-list__phrase__"+Q)}});u.click(s);A.click(K);h.bind("change.place",E);h.bind("change.checked",c);h.bind("change.group_checked",d);b(document).bind("b-forecast-switcher_switch",q);if(G){g.click(D);if(g.length>0){setTimeout(function(){var N;if(direct.banners_selected[h.mbid()]){N=b.inArray(h.id(),direct.banners_selected[h.mbid()])!=-1?0:1}else{N=g.attr("checked")?1:0}L(N);h.update({checked:N})},1)}}else{g.click(w)}function c(N){if(N.source==m){return}g.attr("checked",h.checked());L(h.checked())}function d(N){A.attr("checked",h.group_checked())}function K(N){if(N.source==m){return}h.update({group_checked:N.target.checked},m)}function w(){if(!x){x=1;b.post("/registered/main.pl",{cmd:"ajaxChangeStatusPhrase",dec_id:h.id(),mbid:h.mbid(),cid:o},z)}}function D(N){h.update({checked:N.target.checked},m);L(N.target.checked)}function L(N){m.toggleClass("b-phrases-list_state_disabled",!N);g.attr("checked",N);g.attr("title",(N)?iget("Выключить фразу"):iget("Включить фразу"))}function z(N){x=0;if(N=="declined"){L(0);h.update({declined:1},m)}else{if(N=="new"){L(1);h.update({declined:0},m)}else{alert(iget("Ошибка! Статус фразы не изменен."))}}}function E(){var N=h.place();b.each(u,function(P,O){var Q=O.value==N;b(O).attr("checked",Q)});I(N)}function q(Q,O){var P;for(var N in l){P=(O=="month")?h[N]():h[N]()/4.1;if(b.inArray(N,n)!=-1){P=common.format.number(P,2)}else{P=common.format.number(P,0)}l[N].html(P)}}function I(N){b.each(y,function(R,Q){var P=j(R);b(Q).toggleClass("b-phrases-list__current-place",P==N);var O=H(P);b.each(["budget","clicks"],function(T,S){l[O+S].toggleClass("b-phrases-list__current-place",P==N)});b.each(["clicks_price","ctr"],function(T,S){v[O+S].toggleClass("b-phrases-list__current-place",P==N)})})}function H(N){switch(N){case 3:return"p_";case 2:return"fp_";case 1:return""}}function j(N){switch(N){case 0:return 3;case 1:return 2;case 2:return 1}}function s(O){var N=O.target.value;I(N);C(N)}function C(N){h.update({place:N})}}})(jQuery,window.Lego);(function(b,a){a.block["b-phrases-list__total"]=function(v){var m=b(this),q=v.mode,B=m.find(".b-phrases-list__total__month"),x=m.find(".b-phrases-list__total__week"),D=v.kurs_ye,l=v.currencyName,u=v.models;var w,g;var j=["ctr","shows","budget"];var A={};b.each(j,function(F,E){A[E]=m.find(".b-phrases-list__total__"+E)});var n=["budget"];b(document).bind("b-forecast-switcher_switch",d);for(var y in u){for(var e in u[y]){u[y][e].bind("change.place",h);u[y][e].bind("change.declined",z)}}z();function h(){if(!g){g=setTimeout(z,10)}}function d(F,E){w=E;B.toggleClass("g-hidden",E=="week");x.toggleClass("g-hidden",E!="week");z()}function z(){g=0;o();s();c()}function o(){var F=0,I=0;for(var H in u){for(var E in u[H]){if(u[H][E].declined()){continue}I+=u[H][E].current_ctr();F+=1}}var G=F?(Math.ceil((I/F)*100))/100:0;A.ctr.html(common.format.number(G,2))}function s(){var I=0;for(var H in u){for(var F in u[H]){if(u[H][F].declined()){continue}I+=u[H][F].current_budget()}}if(q=="all"){b(document).trigger("b-phrases-list__total_change-budget",I)}I=C(I,"budget");var E=Math.round(I*D);var G=I+"<br/>(&nbsp;"+E+l+"&nbsp;)";A.budget.html(G)}function c(){var G=0;for(var F in u){for(var E in u[F]){if(u[F][E].declined()){continue}G=G+u[F][E].shows()}}G=C(G,"shows");A.shows.html(G)}function C(G,E){var F=(w=="week")?G/4.1:G;if(b.inArray(E,n)!=-1){return common.format.number(F,2)}else{return common.format.number(F,0)}}}})(jQuery,window.Lego);(function(b,a){a.block["b-phrases-list__group-operations"]=function(j){var e=b(this),d=j.models,h=e.find(".b-phrases-list__group-operation__spect"),g=e.find(".b-phrases-list__group-operation__first"),l=e.find(".b-phrases-list__group-operation__garant");h.bind("click",{place:3},c);g.bind("click",{place:2},c);l.bind("click",{place:1},c);function c(q){var n=q.data.place;for(var o in d){for(var m in d[o]){d[o][m].update({place:n})}}return false}}})(jQuery,window.Lego);(function(b,a){a.block["b-phrases-list__header_mode_mediaplan"]=function(h){var g=b(this),e=h.phraseModels,j=g.find(".b-phrases-list__header_select-all-group");j.click(c);b.each(e,function(m,l){l.bind("change.group_checked",d)});function c(){var l=this.checked;b.each(e,function(n,m){m.update({group_checked:l},g)})}function d(m){if(m.source==g){return}var l=1;b.each(e,function(o,n){l=l&&n.group_checked()});j.attr("checked",l)}}})(jQuery,window.Lego);(function(b,a){a.block["b-forecast-switcher"]=function(d){var m=b(this),c=m.find(".b-forecast-switcher__week"),h=m.find(".b-forecast-switcher__month"),n=d.isClient;var g=n?direct.CampOptions.get("forecast_switcher_pos")||"week":"month";e(g,true);h.bind("click",{type:"month"},j);c.bind("click",{type:"week"},j);b(document).bind("b-forecast-switcher_switch",l);function l(s,q){if(q==g){return}g=q;o(q)}function e(q,s){if(q==g&&!s){return}g=q;o(q);b(document).trigger("b-forecast-switcher_switch",q)}function j(s){var q=s.data.type;if(q==g){return}if(n){direct.CampOptions.set("forecast_switcher_pos",q)}e(q)}function o(q){h.toggleClass("b-pseudo-link",q!="month");c.toggleClass("b-pseudo-link",q=="month")}}})(jQuery,window.Lego);(function(b,a){a.block["b-campaigninfo-show__submit-phrases"]=function(h){var n=b(this),l=h.models,m=h.phraseModels,c=n.find(".b-campaigninfo-show__submit-phrases__ids"),e=n.find(".b-campaigninfo-show__submit-phrases__cmd"),g=n.find(".b-campaigninfo-show__submit-phrases__action"),d=n.find(".b-campaigninfo-show__submit-phrases__submit");d.click(j);function j(){var q=g.val();if(q!=""){if(q=="delPhrases"){if(!confirm(iget("Вы действительно хотите удалить выбранные фразы?"))){return false}e.val("delMediaplanPhrases")}var s=new Array();for(var v in m){for(var o in m[v]){var u=m[v][o];if(u.group_checked()){if(q!="delPhrases"){nw=":"+u.numword()}else{nw=""}s[s.length]=u.id()+nw}}}if(s.join(",")==""){alert(iget("Выберите фразы для данного действия"));return false}c.val(s.join(","));n.submit()}else{alert(iget("Выберите действие с выделенными объектами"));return false}}}})(jQuery,window.Lego);direct.mobile={isMobile:function(){return !!navigator.userAgent.match(/iphone|ipod|ipad|android|palm/i)}};(function($,Lego){var WORD_SEPARATOR="^a-zа-яA-ZА-Я0-9-",ERROR_RE=/b-spell-checker__error/,SKIP_TAGS=/^(SCRIPT|STYLE|NOSCRIPT)$/,BLOCK_TAGS=/(P|BR|DIV)/,EMPTY_HTML=$.browser.msie?"":"<br />";function SPAN_ALT(){return _contextMenuEventSupported?iget("Возможно, в слове содержится опечатка. Исправить ошибку можно по клику на правую кнопку мыши"):iget("Возможно, в слове содержится опечатка. Исправить ошибку можно по клику на левую кнопку мыши")}var _pasteSupported,_appearenceSupported,_appearenceAddsBorderOffset,_contentEditableSupported,_minHeightSupported,_contextMenuEventSupported,_initalized=false,_timerCallbacks=[],skipped={},errorsHash={},_menu;function menu(){return _menu||(_menu=Lego.block["b-spell-checker__menu"].create())}function initalize(){if(_initalized){return}_initalized=true;var probe=document.createElement("div");_pasteSupported=("onpaste" in probe);if(!_pasteSupported){probe.setAttribute("onpaste","return;");_pasteSupported=typeof(probe.onpaste)=="function"}_contextMenuEventSupported=("oncontextmenu" in probe);if(!_contextMenuEventSupported){probe.setAttribute("oncontextmenu","return;");_contextMenuEventSupported=typeof(probe.oncontextmenu)=="function"}_contentEditableSupported=probe.contentEditable!==undefined;if($.browser.opera&&$.browser.version<10){_contentEditableSupported=false}_appearenceSupported=probe.style.MozAppearance!==undefined||probe.style.WebkitAppearance!==undefined||probe.style.appearance!==undefined;probe.style.cssText+=";position:absolute;left:-100px;min-height:100px;-moz-appearance:textfield;-webkit-appearance:textfield;appearance:textfield;0;";document.body.appendChild(probe);_minHeightSupported=probe.offsetHeight>=100;_appearenceAddsBorderOffset=parseInt($(probe).css("borderTopWidth")||"0",10)!=0;document.body.removeChild(probe);setInterval(function(){for(var i=0;i<_timerCallbacks.length;i++){_timerCallbacks[i]()}},300)}Lego.block["b-spell-checker"]=function(params){initalize();if(!_contentEditableSupported||direct.mobile.isMobile()){return false}var $this=$(this),input=$("input[type=text],textarea",$this).eq(0),frame=$('<div class="b-spell-checker__frame" contentEditable="true">x</div>'),multiline=input[0].tagName=="TEXTAREA",prevHTML;var api={text:function(text){if(text===undefined){return input.val()}if(_contentEditableSupported){text=$.escapeHTML(text);if(multiline){text=text.replace(/\r?\n/g,"<br/>")}frame.html(text||EMPTY_HTML);onTextChange()}else{input.val(text)}return this}};if(_appearenceSupported){$.each("Left Right Top Bottom".split(" "),function(){frame.css("padding"+this,(_appearenceAddsBorderOffset?0:parseInt(input.css("padding"+this),10)+parseInt(input.css("border"+this+"Width"),10))+"px")})}else{frame.css("padding",input.css("padding"));frame.addClass("b-spell-checker__frame_native_no")}frame.attr("tabIndex",input.attr("tabIndex"));if(multiline){frame.addClass("b-spell-checker__frame_multiline_yes")}$this.append(frame);if(_minHeightSupported){frame.css("minHeight",Math.max((_appearenceSupported?frame[0].clientHeight:frame[0].offsetHeight),input[0].clientHeight)+"px")}else{if(multiline){frame.css("height",input[0].clientHeight+"px")}}api.text(input.val());prevHTML=frame[0].innerHTML;$(".b-form-input",$this).hide();frame.attr("contentEditable",true);if(params.errors){highlightErrors(params.errors)}_timerCallbacks.push(onTextChange);frame.bind("keyup",onDomChangeEvent);frame.bind("blur",check);if(!multiline){frame.bind("keydown",preventEnter)}input.bind("change",function(){api.text(this.value)});input.bind("b-spell-checker__check",check);frame.bind(_contextMenuEventSupported?"contextmenu":"click",function(e){var span=e.target,$target=$(span);if($target.hasClass("b-spell-checker__error")){setTimeout(function(){var text=$target.html(),words=errorsHash[text]||[],contents=$.map(words,function(w){return{title:w,value:w}}).concat(words.length?{title:iget("пропустить"),value:"__skip",separator:1}:{title:iget("подсказок нет"),separator:1});menu().unbind("action").bind("action",function(e,data){useSuggestion(data,text,span)});menu().data("api").contents(contents).attach($target).show()},1);e.preventDefault();e.stopPropagation();return false}});if(_pasteSupported){frame.bind("paste",function(e){var data=e.originalEvent.clipboardData||window.clipboardData,text=data&&(data.getData("text/plain")||data.getData("Text")),complete=false;if(text){var html=$.escapeHTML(text);if(multiline){html=html.replace(/\r?\n/g,"<br/>")}try{var sel=getSelection(),range=getSelectionRange();if(range.pasteHTML){if(range.item){document.execCommand("Delete",false,null);range=t.getRange()}range.pasteHTML(html);complete=true}else{range.deleteContents();if(multiline){range.insertNode(range.createContextualFragment(html))}else{range.insertNode(document.createTextNode(text))}range.collapse(false);sel.removeAllRanges();sel.addRange(range);complete=true}}catch(e){}}if(complete){e.preventDefault();onTextChange()}else{setTimeout(onTextChange,1)}})}function check(){if($this.hasClass("b-spell-checker_loading_yes")){return}var text=api.text();if(!text.match(/\S/)){return}$this.addClass("b-spell-checker_loading_yes");$.cachedAjax({cacheKey:text,url:"/registered/main.pl",type:"post",data:{cmd:"ajaxSpellCheck",lang:window.Direct_lang||"ru",text:text},complete:function(xhr,status){$this.removeClass("b-spell-checker_loading_yes");if(status=="success"){var array=eval("("+xhr.responseText+")");highlightErrors(array)}}})}var lastHightlighHtml;function highlightErrors(array){if(array&&array.length>0&&lastHightlighHtml!=frame[0].innerHTML){var errorsStr=[];for(var i=0;i<array.length;i++){if(!skipped[array[i].w]){errorsStr.push(array[i].w);errorsHash[array[i].w]=array[i].s}}if(!errorsStr.length){return}clean();var html=frame[0].innerHTML;html=html.replace(/<.?span[^>]*>/ig,"");var regexp=new RegExp("(["+WORD_SEPARATOR+"]|^)("+errorsStr.join("|")+")(?!</span>)(?=["+WORD_SEPARATOR+"]|$)","ig");html=html.replace(regexp,'$1<span class=b-spell-checker__error title="'+SPAN_ALT()+'">$2</span>');frame[0].innerHTML=html;lastHightlighHtml=prevHTML=frame[0].innerHTML}}function preventEnter(e){if(e.keyCode==13){e.preventDefault()}}function clearCurrentError(e){var range=getSelectionRange(),parentNode=range&&(range.startContainer||range.parentElement());if(parentNode&&parentNode.nodeType==3){parentNode=parentNode.parentNode}if(parentNode&&parentNode.className&&ERROR_RE.test(parentNode.className)){parentNode.className="b-spell-checker__error-placeholder"}}function onDomChangeEvent(e){if(onTextChange()){clearCurrentError(e)}}function onTextChange(){if(frame[0].innerHTML==prevHTML){return false}clean();prevHTML=frame[0].innerHTML;input.val(getTextRecursive(frame[0])).trigger("b-spell-checker-change");return true}function getSelection(){return window.getSelection?window.getSelection():document.selection}function getSelectionRange(){try{var selection=getSelection();return selection.rangeCount>0&&selection.getRangeAt(0)}catch(e){}return null}function getTextRecursive(node){if(!node==null){return""}var result="",children=node.childNodes,i=0,child;while(i<children.length){child=children[i];switch(child.nodeType){case 1:case 5:if(!SKIP_TAGS.test(child.tagName)){if(multiline&&BLOCK_TAGS.test(child.tagName)&&i<children.length-1){result+=" "}result+=getTextRecursive(child)}break;case 3:case 2:case 4:result+=child.nodeValue;break}i++}return result}function clearTextWithing(node){if(!node==null){return}var result="",children=$.makeArray(node.children),child;for(var i=0;i<children.length;i++){child=children[i];switch(child.nodeType){case 1:case 5:if(SKIP_TAGS.test(child.tagName)){node.removeChild(child)}else{if(ERROR_RE.test(child.className)){clearTextWithing(child)}else{if(multiline&&BLOCK_TAGS.test(child.tagName)){clearTextWithing(child);child.className="";child.style.cssText=""}else{if(child.tagName=="BR"&&i==children.length-1){clearTextWithing(child)}else{clearTextWithing(child);var subchildren=$.makeArray(child.childNodes);for(var j=0;j<subchildren.length;j++){node.insertBefore(subchildren[j],child)}node.removeChild(child)}}}}break}}}function useSuggestion(data,text,span){if(data.value=="__skip"){skipped[text]=true;$this.find(".b-spell-checker__error").each(function(){this.parentNode.replaceChild(document.createTextNode(this.innerHTML),this)});prevHTML=frame[0].innerHTML}else{span.parentNode.replaceChild(document.createTextNode(data.value),span);onTextChange()}menu().data("api").hide()}function clean(){clearTextWithing(frame[0])}}})(jQuery,window.Lego);(function(b,a){a.block["b-spell-checker__menu"]=function(l){var h=b(this),e,j,c;var g={contents:function(n){e=n;var m=b.map(n,function(o){return'<li class="b-spell-checker__menu__row'+(o.separator?" b-spell-checker__menu__separator":"")+'">'+(o.value?'<span class="b-pseudo-link">'+b.escapeHTML(o.title)+"</span>":o.title)+"</li>"});h.html(m.join(""));return this},attach:function(m){j=b(m);d();return this},show:function(){h.removeClass("g-hidden");d();return this},hide:function(){h.addClass("g-hidden");return this}};h.data("api",g);b(document).bind("mousedown",function(m){if(!h.hasClass("g-hidden")&&b(m.target).parents(".b-spell-checker__menu")[0]!=h[0]){g.hide()}});h.click(function(n){var m=b(n.target);if(m.hasClass("b-pseudo-link")){var o=m.parents("li:eq(0)").prevAll("li").length;h.triggerHandler("action",{index:o,row:e[o],value:e[o].value})}});b(window).bind("resize",function(){if(c){return}c=true;setTimeout(function(){c=false;d()},5)});function d(){if(h.hasClass("g-hidden")){return}var o=j.offset(),m=b(document.body).offset(),n={};o.left-=m.left;o.top-=m.top;n.left=o.left+"px";n.top=o.top+j.height()+"px";h.css(n)}};a.block["b-spell-checker__menu"].create=function(d){var c=b('<ul class="b-spell-checker__menu g-hidden"></ul>').appendTo(document.body);d=d||{};d.name="b-spell-checker__menu";a.block["b-spell-checker__menu"].call(c[0],d);return c}})(jQuery,window.Lego);(function(b,a){a.block["b-comment-form-template"]=function(o){var u=b(this),m=o.groupTitles||[],n=o.beforeText||"",w=o.afterText||"",g=u.find(".b-comment-form-template__groups"),v=g.find(".b-comment-form-template__group"),e=u.find(".b-comment-form-template__textarea"),s=[];x();function x(){j();h();b(document).bind("b-comment-form-template_open",l);d()}function l(){var y=document.compatMode=="BackCompat"?0:-4;if(g[0].offsetHeight){e[0].style.height=(g[0].offsetHeight-18-10+y)+"px"}}function h(){b.each(s,function(A,B){for(var z=0,y=B.templates.length;z<y;z++){c(B.templates[z]).bind("click",d)}})}function d(){var z=[],y="";b.each(s,function(A,B){z[A]=[];b.each(B.templates,function(D,C){if(C.input.attr("checked")){z[A].push(C.text)}})});b.each(z,function(C,D){if(D.length){if(m[C]){y+=m[C]+"\n"}}if(D.length>1){for(var B=0,A=z[C].length;B<A;B++){D[B]=(B+1)+". "+D[B]}}y+=D.join("\n\n")+"\n\n\n";e.val(n+y+w)})}function j(){v.each(function(z,y){var A=b(y);var B={templates:[]};A.find("dl").each(function(D,C){B.templates.push(q(C))});B.name=A.find("h3").text();B.element=A;s.push(B)})}function q(z){var y={},A=b(z);y.nameElement=A.find("dt");y.textElement=A.find("dd");y.name=y.nameElement.text();y.text=y.textElement.html();y.element=A;return y}function c(z){var B=direct.utils.generateId(),y=b("<input type='checkbox' class='checkbox-old' id='"+B+"'></input>"),A=b("<label for='"+B+"'>"+z.name+"</label>");z.nameElement.empty().append(y).append(A);z.input=y;return y}}})(jQuery,window.Lego);(function(b,a){a.block["b-campinfo__optimize"]=function(q){var d=b(this),u=q.formName,s=q.barId,m=q.acceptPopupId,v=q.acceptCommentId,e=q.declineCommentId,g=q.declinePopupId,z=q.posAccept,l=q.posDecline,o=b("#"+m),y=b("#"+g),n=d.find(".b-campinfo__optimize__accept-button"),x=d.find(".b-campinfo__optimize__decline-button");n.click(c);x.click(h);o.bind("b-window_submit",j);y.bind("b-window_submit",w);function j(B){if(confirm(iget("Вы действительно хотите закончить оптимизацию?"))){var A=b("[name="+u+"]")[0];A.optType.value="completeOptimizing";A.optimizationComment.value=b("#"+v).val();A.cmd.value="completeOptimizing";A.submit()}}function w(){if(confirm(iget("Вы действительно хотите закончить оптимизацию?"))){var A=b("[name="+u+"]")[0];A.optType.value="declineOptimizing";A.optimizationDeclineComment.value=b("#"+e).val();A.cmd.value="declineOptimizing";A.submit()}}function c(){b(document).trigger("b-window_close-all");o.removeClass("g-hidden").data("api").attach(b("#"+s)[0],z);o.data("api").show();b(document).trigger("b-comment-form-template_open")}function h(){b(document).trigger("b-window_close-all");y.removeClass("g-hidden").data("api").attach(b("#"+s)[0],l);y.data("api").show()}}})(jQuery,window.Lego);(function(b,a){a.block["b-campinfo__end-mediaplan"]=function(h){var m=b(this),g=h.endMediaplanCommentId,d=h.barId,l=h.error,o=h.endMediaplanFormId,n=b("#"+o),c=h.endMediaplanPopupId,s=b("#"+c),e=m.find(".b-campinfo__end-mediaplan__btn");e.click(q);s.bind("b-window_submit",j);function j(){if(confirm(iget("Вы действительно хотите закончить работу с медиапланом?"))){n[0].comment.value=b("#"+g).val();n.submit()}}function q(){if(l){alert(l);return}b(document).trigger("b-window_close-all");s.removeClass("g-hidden").data("api").attach(b("#"+d)[0],"top");s.data("api").show();b(document).trigger("b-comment-form-template_open")}}})(jQuery,window.Lego);(function(b,a){a.block["b-phone-number-parser"]=function(d){if(navigator.userAgent.match(/iphone|ipod|ipad|android|palm/i)){c()}function c(){b(".b-phone-number-parser__phone").each(function(g,h){var e=b(h).text().replace(/[\s()-]/g,"");b(h).empty().append('<a href="tel:'+e+'">'+e+"</a>")})}}})(jQuery,window.Lego);(function(b,a){a.block["b-statistics__form"]=function(q){var j=b(this),y=j.find(".b-statistics__form__calendar-from"),o=j.find(".b-statistics__form__calendar-to"),c=j.find(".b-statistics__form__submit"),w=j.find(".b-statistics__form__stat-periods"),s=j.find(".b_statistics__form__quick_date_select__period");var E,d;var C="y1 m1 d1".split(" "),l="y2 m2 d2".split(" ");var A=[];b(document).bind("b-statistics__form:updateToDate",h);b(document).bind("b-statistics__form:updateFromDate",x);s.each(function(F,H){var G=b(H).find(".b_statistics__form__quick_date_select__link");var J=z(b(H));var I=m(b(H));if(b(H).hasClass("b_statistics__form__quick_date_select__period")){A.push(J.join("-")+":"+I.join("-"))}G.bind("click",{from:J,to:I},n)});if(y[0]&&b.isFunction(y[0].onclick)){var u=y[0].onclick();d=new clite(u.y+"-"+u.m+"-"+u.d);d.addField("y1","%Y");d.addField("m1","%M");d.addField("d1","%D");d.appendToPlace(y[0])}if(o[0]&&b.isFunction(o[0].onclick)){var e=o[0].onclick();E=new clite(e.y+"-"+e.m+"-"+e.d);E.addField("y2","%Y");E.addField("m2","%M");E.addField("d2","%D");E.appendToPlace(o[0])}c.click(v);function z(F){var G=[];b.each(C,function(I,H){G[I]=F.find(".calendar-"+H).val()});return G}function m(F){var G=[];b.each(l,function(I,H){G[I]=F.find(".calendar-"+H).val()});return G}function n(F){var H=F.data.from,G=F.data.to;d.update_date(H.join("-"));E.update_date(G.join("-"))}function h(G,F){E.update_date(F)}function x(G,F){d.update_date(F)}function g(G,F){if(G[0]<F[0]){return true}if(G[0]>F[0]){return false}if(G[1]<F[1]){return true}if(G[1]>F[1]){return false}if(G[2]>F[2]){return false}return true}function D(G,F){if(G[0]<2000||F[0]<2000){return false}return true}function B(G,F){if(!g(G,F)){alert(iget("Дата начала периода должна быть раньше даты конца"));return false}if(!D(G,F)){alert(iget("Выбранный период должен начинаться не раньше 1 января 2000 года"));return false}return true}function v(){var J=z(y),I=m(o),G=J.join("-")+":"+I.join("-");if(!B(J,I)){return false}var F=direct.UserOptions.get("stat_periods")?direct.UserOptions.get("stat_periods").split(","):[];if(b.inArray(G,F)==-1&&b.inArray(G,A)==-1){F.unshift(G);if(F.length>3){F=F.slice(0,3)}var H=F.join(",");w.val(H)}}}})(jQuery,window.Lego);(function(b,a){a.block["b-statistics-data"]=function(d){var m=b(this),n=m.find(".b-statisctics-data__expander"),j=m.find(".b-statisctics-data__expand-container");var h={},g={};j.each(function(o,q){var s=q.onclick()||{};g[s.id]=b(q)});n.each(function(q,o){var s=o.onclick()||{};h[s.id]={containerId:s.containerId,href:o.href,opened:false,img:b(o).find(".b-statisctics-data__expander-img"),cache:""};b(o).bind("click",{id:s.id},e)});function e(q){q.preventDefault();var s=q.data.id;h[s].opened=!h[s].opened;var o=h[s].opened?"/i/hide.gif":"/i/show.gif";h[s].img.attr("src",o);if(!h[s].cache){l(s)}else{g[h[s].containerId].toggleClass("g-hidden")}return false}function l(o){b.get(h[o].href,function(q){c(q,o)})}function c(q,s){h[s].cache=b(q);var o=g[h[s].containerId];o.empty().append(b(q));g[h[s].containerId].toggleClass("g-hidden")}}})(jQuery,window.Lego);(function(b,a){a.block["b-time-targeting__quick-select"]=function(h){var g=b(this),e=h.value,c=h.model;g.click(d);function d(){c.update({timeTarget:e},g);b(document).trigger("external_change.timeTarget")}}})(jQuery,window.Lego);direct.ForecastUtils={getCurrency:function(){return pseudo_currency},calcSliderMark:function(c,d,h){var e=new Object;var a=c.left_lim>=c.right_lim;var b=a?MIN_BUDGET:c.left_lim;var l=a?SLIDER_MIN_UPPER_VALUE:c.right_lim;var g=c.money2clicks(b);var j=c.money2clicks(l);if(j<=g&&!a){j=g;l=b}e.sum=b;e.clicks=g;if(d!="pos"&&d!="clicks"&&d!="sum"){return e}if(d=="clicks"&&h<=g||d=="sum"&&h<=b||d=="pos"&&h<=0){e.pos=0;e.clicks=g;e.sum=b;return e}if(d=="clicks"&&h>=j||d=="sum"&&h>=l||d=="pos"&&h>=SLIDER_WIDTH){e.pos=SLIDER_WIDTH;e.clicks=j;e.sum=l;return e}e[d]=h;if(a){if(d=="sum"){e.pos=Math.round((e.sum-MIN_BUDGET)*SLIDER_WIDTH/(SLIDER_MIN_UPPER_VALUE-MIN_BUDGET))}if(d=="pos"){e.sum=MIN_BUDGET+Math.round(e.pos*(SLIDER_MIN_UPPER_VALUE-MIN_BUDGET)/SLIDER_WIDTH)}return e}if(d=="clicks"){e.sum=Math.max(c.clicks2money(e.clicks),b)}if(d=="clicks"||d=="sum"){e.pos=Math.round(SLIDER_WIDTH*(e.sum-b)/(l-b))}if(d=="pos"){e.sum=Math.round(b+(l-b)*e.pos/SLIDER_WIDTH)}if(d=="sum"||d=="pos"){e.clicks=c.money2clicks(e.sum)}e.phrases_cnt=c.money2phrases(e.sum);return e}};if(typeof(pseudo_currency)=="undefined"){pseudo_currency=window.Direct_pseudo_currency||{rate:1,name:"",id:""}}if(typeof(SLIDER_WIDTH)=="undefined"){SLIDER_WIDTH=500}if(typeof(SLIDER_MIN_UPPER_VALUE)=="undefined"){SLIDER_MIN_UPPER_VALUE=100*pseudo_currency.rate}if(typeof(MIN_BUDGET)=="undefined"){MIN_BUDGET=10*pseudo_currency.rate}(function(b,a){a.block["b-pay-easy"]=function(l){var j=b(this),d=l.daily_sum,h=j.find(".b-pay-easy__form"),c=j.find(".b-pay-easy__submit"),g=j.find(".b-pay-easy__input"),m=j.find(".b-pay-easy__days");g.keyup(e);e();function e(){var u=direct.ForecastUtils.getCurrency().rate;var s=common.parse.number(g.val())||0;s=Math.round(s);var q=s<u*10||s>1000000?1:0;c.attr("disabled",q);var n=Math.floor(s/(d*u));n=(n>0)?n:(s<300)?0:1;var o=common.inflector.pluralizeWord([iget("день"),iget("дня"),iget("дней")],n);m.html(n+"&nbsp;"+o)}}})(jQuery,window.Lego);